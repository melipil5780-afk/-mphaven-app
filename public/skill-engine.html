<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>Skill Engine ¬∑ MPHaven</title>
    <style>
        /* ==== STYLES (same as before, keep compact) ==== */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        html, body { height: 100%; width: 100%; overflow: hidden; position: fixed; background: #0f172a; color: #f1f5f9; }
        .container { width: 100%; height: 100vh; height: 100dvh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .app-wrapper { width: 100%; max-width: 28rem; height: 100%; margin: 0 auto; background: rgba(15,23,42,0.98); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px); display: flex; flex-direction: column; position: relative; border-left: 1px solid rgba(30,41,59,0.5); border-right: 1px solid rgba(30,41,59,0.5); }
        .bg-blur-1, .bg-blur-2 { position: absolute; border-radius: 50%; filter: blur(140px); pointer-events: none; z-index: 0; opacity: 0.6; }
        .bg-blur-1 { top: -10%; left: 50%; transform: translateX(-50%); width: 22rem; height: 22rem; background: rgba(14,116,144,0.08); }
        .bg-blur-2 { bottom: -10%; right: -10%; width: 18rem; height: 18rem; background: rgba(217,119,6,0.08); }
        .main-content { flex: 1; overflow-y: auto; overflow-x: hidden; position: relative; z-index: 1; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .main-content::-webkit-scrollbar { display: none; }
        .content-wrapper { padding: 1.5rem 1.25rem 2rem; padding-bottom: calc(2rem + env(safe-area-inset-bottom)); min-height: 100%; display: flex; flex-direction: column; }
        .progress-container { margin-bottom: 1.5rem; }
        .progress-dots { display: flex; gap: 0.25rem; margin-bottom: 0.5rem; }
        .progress-dot { flex: 1; height: 0.5rem; background: rgba(148,163,184,0.25); border-radius: 9999px; }
        .progress-dot.active { background: linear-gradient(135deg, #0e7490, #d97706); }
        .progress-text { display: flex; justify-content: space-between; align-items: center; color: #94a3b8; font-size: 0.8125rem; font-weight: 600; }
        .back-btn { background: none; border: none; color: #94a3b8; font-size: 1.5rem; cursor: pointer; padding: 0.25rem; }
        .skill-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; background: linear-gradient(135deg, rgba(30,41,59,0.8), rgba(15,23,42,0.8)); padding: 1.25rem; border-radius: 1.25rem; border: 1px solid rgba(51,65,85,0.4); }
        .skill-icon-large { width: 5rem; height: 5rem; border-radius: 1.5rem; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; flex-shrink: 0; background: rgba(14,116,144,0.15); }
        .skill-info { flex: 1; }
        .family-badge { display: inline-block; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.6875rem; font-weight: 700; text-transform: uppercase; margin-bottom: 0.5rem; }
        .skill-name { font-size: 1.75rem; font-weight: 800; line-height: 1.2; margin-bottom: 0.25rem; }
        .skill-tagline { color: #a5f3fc; font-size: 0.9375rem; }
        .card { background: linear-gradient(135deg, rgba(30,41,59,0.65), rgba(15,23,42,0.45)); border: 1px solid rgba(51,65,85,0.4); border-radius: 1.25rem; padding: 1.5rem; margin-bottom: 1rem; }
        .card-title { display: flex; align-items: center; gap: 0.5rem; color: #f1f5f9; font-size: 1.125rem; font-weight: 700; margin-bottom: 1rem; }
        .card-text { color: #cbd5e1; font-size: 0.9375rem; line-height: 1.6; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin: 1rem 0; }
        .checkbox-label { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: rgba(30,41,59,0.5); border: 1px solid rgba(51,65,85,0.4); border-radius: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .checkbox-label.checked { border-color: rgba(14,116,144,0.6); background: rgba(14,116,144,0.18); }
        .checkbox-label input { width: 1.25rem; height: 1.25rem; accent-color: #0e7490; }
        textarea, input[type="text"] { width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid rgba(51,65,85,0.4); background: rgba(30,41,59,0.5); color: white; font-size: 1rem; margin-top: 0.5rem; resize: vertical; }
        .char-counter { color: #94a3b8; font-size: 0.8125rem; text-align: right; margin-top: 0.5rem; }
        .char-counter.active { color: #a5f3fc; font-weight: 600; }
        .rating-container { background: rgba(15,23,42,0.6); border-radius: 1rem; padding: 1.25rem; margin: 1.5rem 0; }
        input[type=range] { width: 100%; height: 6px; -webkit-appearance: none; background: rgba(51,65,85,0.4); border-radius: 3px; outline: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 1.5rem; height: 1.5rem; background: linear-gradient(135deg, #0e7490, #d97706); border-radius: 50%; cursor: pointer; box-shadow: 0 0 15px rgba(14,116,144,0.3); }
        .rating-display { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; }
        .rating-value { background: rgba(14,116,144,0.2); padding: 0.5rem 1.25rem; border-radius: 0.75rem; display: flex; align-items: center; gap: 0.75rem; }
        .rating-number { color: #a5f3fc; font-weight: 700; font-size: 1.5rem; }
        .rating-emoji { font-size: 1.75rem; }
        .btn { width: 100%; padding: 1rem; border: none; border-radius: 0.75rem; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.2s; margin-bottom: 0.75rem; }
        .btn-primary { background: linear-gradient(135deg, #0e7490, #d97706); color: white; box-shadow: 0 4px 16px rgba(14,116,144,0.2); }
        .btn-primary:active { transform: scale(0.98); }
        .btn-secondary { background: rgba(30,41,59,0.5); border: 1px solid rgba(51,65,85,0.4); color: #94a3b8; }
        .btn-secondary:active { transform: scale(0.98); background: rgba(30,41,59,0.7); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }
        .summary-block { background: rgba(14,116,144,0.08); border-left: 4px solid #0e7490; padding: 1.25rem; border-radius: 0.75rem; margin: 1rem 0; }
        .toast { position: fixed; bottom: max(6rem, env(safe-area-inset-bottom)+4rem); left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(30,41,59,0.95); border: 1px solid rgba(14,116,144,0.3); border-radius: 0.75rem; padding: 0.875rem 1.25rem; color: white; font-weight: 600; z-index: 10000; opacity: 0; transition: all 0.3s; backdrop-filter: blur(10px); max-width: calc(100vw - 2rem); text-align: center; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-wrapper">
            <div class="bg-blur-1"></div>
            <div class="bg-blur-2"></div>
            <div id="mainContent" class="main-content"></div>
        </div>
    </div>
    <div id="toast" class="toast"></div>
    <script>
        // ==================== FAMILY META ====================
        const FAMILY_META = {
            refocus: { name: 'REFOCUS', icon: 'üéØ', color: '#0e7490' },
            comfort: { name: 'COMFORT', icon: 'ü´Ç', color: '#7c3aed' },
            weighit: { name: 'WEIGH IT', icon: '‚öñÔ∏è', color: '#d97706' },
            pause: { name: 'PAUSE', icon: 'üõë', color: '#0891b2' }
        };

        // ==================== ALL SKILLS ‚Äî COMPLETE, 19 SKILLS, FULLY LOADED ====================
        const ALL_SKILLS = {
            // ------------------------------------------------------------
            // 1. REFOCUS ‚Äî 7 skills
            // ------------------------------------------------------------
            refocus: [
                // ---------- GET BUSY ----------
                {
                    id: 'getbusy', name: 'GET BUSY', icon: 'üèÉ', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Do something to occupy your mind', duration: 60, quick: 'Count 10 things you can see',
                    intro: {
                        concept: 'When your thoughts are stuck in a loop, doing almost anything else can interrupt the pattern.',
                        example: { situation: 'You‚Äôre lying in bed, unable to sleep, replaying an awkward conversation.', action: 'Get up, walk to the window, and count the cars parked outside.', result: 'The mental loop breaks, and you feel a moment of space.' }
                    },
                    explore: {
                        prompt: 'Think of a recent time when you were stuck in a thought loop:',
                        checkboxes: ['Ruminating about a mistake', 'Replaying a conversation', 'Worrying about the future', 'Analyzing what someone meant', 'Going over a ‚Äúwhat if‚Äù scenario'],
                        textareaPlaceholder: 'Describe what it felt like...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'The brain has limited attention. Activating a different neural pathway‚Äîthrough movement, counting, or a task‚Äîdisrupts the rumination loop. It‚Äôs not about solving the problem; it‚Äôs about giving your brain a break so you can think clearly later.',
                        comparison: { left: 'Rumination loop', leftIcon: 'üîÑ', right: 'Interruption', rightIcon: '‚ö°', result: 'You regain control' }
                    },
                    rules: [
                        { number: '1', title: 'Notice the loop', description: 'Realize you are stuck in repetitive thoughts.', example: '‚ÄúI‚Äôve been thinking about this for 10 minutes.‚Äù' },
                        { number: '2', title: 'Choose a simple, neutral task', description: 'Pick something that requires just enough focus.', example: 'Count 10 things you can see.' },
                        { number: '3', title: 'Do it for 1-3 minutes', description: 'Give yourself permission to pause.', example: 'Set a timer if it helps.' },
                        { number: '4', title: 'Return when ready', description: 'If the thought comes back, repeat.', example: 'The loop will lose power.' }
                    ],
                    practice: {
                        goalPrompt: 'What is your REAL goal in this moment?', goalPlaceholder: 'e.g., calm down, focus, sleep...',
                        actionPrompt: 'What ACTION can you take right now to occupy your mind?', actionPlaceholder: 'e.g., count cars, tidy desk, name 5 sounds...'
                    },
                    tool: {
                        title: 'Your ‚ÄúGet Busy‚Äù Tool', description: 'When rumination strikes, interrupt the loop with a neutral task.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat can I do right now, for just one minute, to shift my attention?‚Äù'
                    }
                },
                // ---------- LEND A HAND ----------
                {
                    id: 'lendahand', name: 'LEND A HAND', icon: 'ü§ù', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Do something for someone else', duration: 60, quick: 'Send someone a genuine compliment',
                    intro: {
                        concept: 'Shifting focus outward can shrink problems inward. Small acts create distance.',
                        example: { situation: 'You feel worthless and isolated, scrolling social media.', action: 'Send a genuine compliment to a friend.', result: 'Your focus shifts from your own pain to someone else‚Äôs happiness.' }
                    },
                    explore: {
                        prompt: 'Think of a moment when you felt stuck in self-focus:',
                        checkboxes: ['Feeling sorry for myself', 'Jealous of others', 'Overanalyzing my flaws', 'Isolating from friends', 'Feeling like a burden'],
                        textareaPlaceholder: 'What was that like?'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Altruistic behavior activates reward centers in the brain and shifts attention away from self-focused rumination. It‚Äôs a double win: you feel better and someone else benefits.',
                        comparison: { left: 'Self-focus', leftIcon: 'üòî', right: 'Outward action', rightIcon: 'ü§ù', result: 'Mood lift + connection' }
                    },
                    rules: [
                        { number: '1', title: 'Think of one person', description: 'A friend, family, coworker, or even a stranger.', example: 'Your mom, a colleague, the barista.' },
                        { number: '2', title: 'Do one small thing', description: 'It doesn‚Äôt have to be big.', example: 'Send a text, hold the door, give a compliment.' },
                        { number: '3', title: 'Notice the shift', description: 'Observe how your attention moves outward.', example: 'You feel lighter, less alone.' }
                    ],
                    practice: {
                        goalPrompt: 'What do you truly want in this moment?', goalPlaceholder: 'e.g., feel connected, stop feeling worthless...',
                        actionPrompt: 'Who could you help right now, and with what?', actionPlaceholder: 'e.g., text my sister ‚Äúthinking of you‚Äù'
                    },
                    tool: {
                        title: 'Your ‚ÄúLend a Hand‚Äù Tool', description: 'When self-focus becomes a trap, lend a hand. Small acts of kindness are powerful anchors.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWho could use a kind word or gesture right now?‚Äù'
                    }
                },
                // ---------- LOOK BACK ----------
                {
                    id: 'lookback', name: 'LOOK BACK', icon: 'üìÖ', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Remember what you‚Äôve survived', duration: 60, quick: 'Name one past challenge you survived',
                    intro: {
                        concept: 'Your brain forgets resilience. Actively recalling past struggles you made it through builds confidence.',
                        example: { situation: 'You feel hopeless, like you‚Äôve never coped.', action: 'Recall a specific time you got through something hard.', result: 'You realize you have more strength than you think.' }
                    },
                    explore: {
                        prompt: 'Think of a difficult moment you survived:',
                        checkboxes: ['A breakup', 'Job loss', 'Health scare', 'Financial crisis', 'Moving to a new city'],
                        textareaPlaceholder: 'What did you do to get through it?'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Memory is state-dependent. When you‚Äôre distressed, you can‚Äôt access memories of coping. Actively recalling past successes builds evidence that you can survive this too.',
                        comparison: { left: 'Hopelessness', leftIcon: 'üòû', right: 'Recall past strength', rightIcon: 'üí™', result: 'Self‚Äëefficacy' }
                    },
                    rules: [
                        { number: '1', title: 'Think of a past difficult situation', description: 'Pick one that felt overwhelming at the time.', example: 'A breakup, a failure, a scary diagnosis.' },
                        { number: '2', title: 'Remember how you got through it', description: 'What actions did you take? Who helped you?', example: 'I called a friend, took it day by day.' },
                        { number: '3', title: 'Name one strength you used', description: 'Identify the quality that helped you.', example: 'Patience, courage, asking for help.' }
                    ],
                    practice: {
                        goalPrompt: 'What do you need to remember right now?', goalPlaceholder: 'e.g., that I am resilient, that this will pass...',
                        actionPrompt: 'What past challenge will you recall?', actionPlaceholder: 'e.g., when I lost my job and found a better one'
                    },
                    tool: {
                        title: 'Your ‚ÄúLook Back‚Äù Tool', description: 'When hopelessness clouds your mind, deliberately remember: you have survived before.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat‚Äôs one hard thing I got through, and how did I do it?‚Äù'
                    }
                },
                // ---------- FLIP THE FEELING ----------
                {
                    id: 'flipfeeling', name: 'FLIP THE FEELING', icon: 'üé≠', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Change your emotional channel', duration: 120, quick: 'Watch something funny or look at cute animals',
                    intro: {
                        concept: 'You can‚Äôt always change the situation, but you can shift your emotional state. Give your brain something else to feel.',
                        example: { situation: 'You‚Äôre stuck in sadness after bad news.', action: 'Watch a 2‚Äëminute compilation of laughing babies.', result: 'Your mood lifts, even if just a little.' }
                    },
                    explore: {
                        prompt: 'What usually helps you shift your mood?',
                        checkboxes: ['Funny videos', 'Uplifting music', 'Cute animal photos', 'Inspiring quotes', 'Talking to an upbeat friend'],
                        textareaPlaceholder: 'Describe a time you successfully flipped your feeling...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Emotions are state‚Äëdependent. Comedy, cute animals, and uplifting music can trigger genuine emotional shifts by activating different neural circuits.',
                        comparison: { left: 'Negative emotion', leftIcon: 'üòû', right: 'Positive stimulus', rightIcon: 'üòÇ', result: 'Emotional shift' }
                    },
                    rules: [
                        { number: '1', title: 'Choose something that creates a different feeling', description: 'It can be funny, heartwarming, inspiring.', example: 'A stand‚Äëup clip, a kitten video.' },
                        { number: '2', title: 'Engage with it for 2‚Äë5 minutes', description: 'Give it your full attention.', example: 'Watch without multitasking.' },
                        { number: '3', title: 'Notice the shift', description: 'Observe how your body and mood change.', example: 'You might smile, breathe easier.' }
                    ],
                    practice: {
                        goalPrompt: 'What feeling do you want to move toward?', goalPlaceholder: 'e.g., lightness, hope, calm...',
                        actionPrompt: 'What specific video, song, or image will you use?', actionPlaceholder: 'e.g., cat compilation on YouTube'
                    },
                    tool: {
                        title: 'Your ‚ÄúFlip the Feeling‚Äù Tool', description: 'You have a remote control for your emotions‚Äîchange the channel.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat‚Äôs one thing I can watch or listen to that might shift my mood?‚Äù'
                    }
                },
                // ---------- SET IT DOWN ----------
                {
                    id: 'setitdown', name: 'SET IT DOWN', icon: 'üì¶', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Leave the problem for now', duration: 30, quick: 'Imagine putting it in a box on a high shelf',
                    intro: {
                        concept: 'You can come back to it later. Right now, give yourself permission to put it away.',
                        example: { situation: 'You‚Äôre anxious about a deadline, but you can‚Äôt work on it tonight.', action: 'Visualize placing the worry in a box and setting it on a shelf.', result: 'Your mind stops cycling, and you can rest.' }
                    },
                    explore: {
                        prompt: 'What kind of ‚Äúcontainer‚Äù feels right for you?',
                        checkboxes: ['A wooden box', 'A locked drawer', 'A cloud', 'A floating balloon', 'A file folder'],
                        textareaPlaceholder: 'Describe the container you imagine...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Imaginal containment reduces the brain‚Äôs urgency to keep a problem in working memory. It signals that the problem is stored, not lost.',
                        comparison: { left: 'Mental load', leftIcon: 'üìö', right: 'Containment', rightIcon: 'üì¶', result: 'Reduced anxiety' }
                    },
                    rules: [
                        { number: '1', title: 'Imagine a container', description: 'A box, drawer, locker, cloud‚Äîanything.', example: 'A sturdy wooden chest.' },
                        { number: '2', title: 'Place the worry inside', description: 'Put the entire problem into the container.', example: 'Seal it shut.' },
                        { number: '3', title: 'Set it aside for later', description: 'Put it on a shelf, in another room, or send it away.', example: '‚ÄúI‚Äôll deal with you tomorrow.‚Äù' }
                    ],
                    practice: {
                        goalPrompt: 'What do you need to set down right now?', goalPlaceholder: 'e.g., worry about the meeting...',
                        actionPrompt: 'What container will you use?', actionPlaceholder: 'e.g., a drawer, a cloud, a box'
                    },
                    tool: {
                        title: 'Your ‚ÄúSet It Down‚Äù Tool', description: 'You don‚Äôt have to carry everything at once. Store it for later.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúCan I put this problem in a container and come back to it?‚Äù'
                    }
                },
                // ---------- SWAP THE THOUGHT ----------
                {
                    id: 'swapthought', name: 'SWAP THE THOUGHT', icon: 'üîÑ', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Replace it with another', duration: 40, quick: 'What would a friend say?',
                    intro: {
                        concept: 'You don‚Äôt have to believe every thought. Try swapping it for a different one.',
                        example: { situation: 'You think, ‚ÄúI always mess things up.‚Äù', action: 'Swap with: ‚ÄúI‚Äôve made mistakes, and I‚Äôve also succeeded many times.‚Äù', result: 'The thought loses its grip.' }
                    },
                    explore: {
                        prompt: 'Which unhelpful thoughts often loop for you?',
                        checkboxes: ['‚ÄúI‚Äôm not good enough‚Äù', '‚ÄúEveryone is judging me‚Äù', '‚ÄúNothing ever works out‚Äù', '‚ÄúI‚Äôm a failure‚Äù', '‚ÄúI can‚Äôt handle this‚Äù'],
                        textareaPlaceholder: 'Write down one recurring negative thought...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Cognitive reappraisal weakens automatic negative thoughts. Deliberately replacing a thought creates a new neural pathway.',
                        comparison: { left: 'Automatic thought', leftIcon: 'üí≠', right: 'Deliberate swap', rightIcon: 'üîÑ', result: 'New perspective' }
                    },
                    rules: [
                        { number: '1', title: 'Notice the thought', description: 'Catch it when it appears.', example: '‚ÄúI‚Äôm thinking that I‚Äôm not good enough.‚Äù' },
                        { number: '2', title: 'Ask: Is this 100% true?', description: 'Challenge its accuracy.', example: '‚ÄúIs it really true that I always fail?‚Äù' },
                        { number: '3', title: 'Choose a more helpful thought', description: 'Swap it with something balanced.', example: '‚ÄúI have succeeded before, and I can learn from this.‚Äù' }
                    ],
                    practice: {
                        goalPrompt: 'What thought would you like to replace?', goalPlaceholder: 'e.g., ‚ÄúI‚Äôm going to mess up‚Äù',
                        actionPrompt: 'What is a more helpful thought?', actionPlaceholder: 'e.g., ‚ÄúI‚Äôll do my best and that‚Äôs enough‚Äù'
                    },
                    tool: {
                        title: 'Your ‚ÄúSwap the Thought‚Äù Tool', description: 'You are the editor of your own mind‚Äîrewrite the sentence.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat‚Äôs a kinder, more accurate thought I can swap in?‚Äù'
                    }
                },
                // ---------- FEEL SOMETHING ----------
                {
                    id: 'feelsomething', name: 'FEEL SOMETHING', icon: '‚ö°', familyId: 'refocus', familyName: 'REFOCUS', familyColor: '#0e7490',
                    tagline: 'Wake up your senses', duration: 15, quick: 'Splash cold water on your face',
                    intro: {
                        concept: 'When you feel numb or disconnected, strong sensations can bring you back to your body.',
                        example: { situation: 'You feel dissociated, unreal, like you‚Äôre watching a movie of yourself.', action: 'Hold an ice cube in your hand.', result: 'The sharp cold pulls you back into the present.' }
                    },
                    explore: {
                        prompt: 'What sensations help you feel real?',
                        checkboxes: ['Cold water', 'Ice cube', 'Sour candy', 'Loud music', 'Strong smell (peppermint, citrus)', 'Pinching your skin'],
                        textareaPlaceholder: 'Describe a time you used sensation to ground yourself...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Strong physical sensations activate the somatosensory cortex and interrupt dissociation. They force your brain to attend to your body.',
                        comparison: { left: 'Dissociation', leftIcon: 'üå´Ô∏è', right: 'Strong sensation', rightIcon: '‚ö°', result: 'Grounded presence' }
                    },
                    rules: [
                        { number: '1', title: 'Choose a strong sensation', description: 'Cold, sour, intense.', example: 'Splash cold water, suck on a lemon.' },
                        { number: '2', title: 'Apply it briefly', description: '15‚Äë30 seconds is enough.', example: 'Hold an ice cube until it starts to melt.' },
                        { number: '3', title: 'Notice the shift', description: 'Feel how your attention moves to your body.', example: 'You feel more solid, more ‚Äúhere‚Äù.' }
                    ],
                    practice: {
                        goalPrompt: 'What do you need right now‚Äîto feel more real?', goalPlaceholder: 'e.g., to stop feeling numb',
                        actionPrompt: 'What sensation will you use?', actionPlaceholder: 'e.g., splash cold water'
                    },
                    tool: {
                        title: 'Your ‚ÄúFeel Something‚Äù Tool', description: 'Your senses are an anchor to the present. Use them when you feel disconnected.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat‚Äôs one strong sensation I can create right now?‚Äù'
                    }
                }
            ],

            // ------------------------------------------------------------
            // 2. COMFORT ‚Äî 7 skills
            // ------------------------------------------------------------
            comfort: [
                // ---------- SAFE PLACE ----------
                {
                    id: 'safeplace', name: 'SAFE PLACE', icon: 'üèùÔ∏è', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Imagine somewhere calm', duration: 90, quick: 'Close your eyes and imagine your safe place',
                    intro: {
                        concept: 'Close your eyes and picture a place where you feel completely at ease. It can be real or imagined.',
                        example: { situation: 'You‚Äôre in a waiting room, heart racing.', action: 'Close your eyes and imagine a quiet beach at sunset.', result: 'Your breathing slows, tension drops.' }
                    },
                    explore: {
                        prompt: 'What would your safe place look like?',
                        checkboxes: ['A quiet beach', 'A peaceful forest', 'A cozy room', 'Mountains', 'Sunrise/sunset', 'A childhood home'],
                        textareaPlaceholder: 'Describe your safe place in detail...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Imaginal exposure to safety cues activates the parasympathetic nervous system. Your brain responds to vivid imagery as if it were real.',
                        comparison: { left: 'Anxiety', leftIcon: 'üò∞', right: 'Safe imagery', rightIcon: 'üèùÔ∏è', result: 'Calm' }
                    },
                    rules: [
                        { number: '1', title: 'Close your eyes', description: 'Eliminate visual distractions.', example: 'Find a quiet moment.' },
                        { number: '2', title: 'Imagine a place where you feel completely safe', description: 'Engage all your senses.', example: 'Feel the warm sand, hear the waves.' },
                        { number: '3', title: 'Stay there for 1‚Äë2 minutes', description: 'Let the feeling sink in.', example: 'Breathe slowly.' }
                    ],
                    practice: {
                        goalPrompt: 'What do you want to feel in your safe place?', goalPlaceholder: 'e.g., peace, security',
                        actionPrompt: 'Where will you go in your mind?', actionPlaceholder: 'e.g., my grandmother‚Äôs garden'
                    },
                    tool: {
                        title: 'Your ‚ÄúSafe Place‚Äù Tool', description: 'You carry a sanctuary inside you. Visit it anytime.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhere is my safe place, and what does it feel like?‚Äù'
                    }
                },
                // ---------- FIND THE LESSON ----------
                {
                    id: 'findlesson', name: 'FIND THE LESSON', icon: 'üìò', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Look for meaning', duration: 60, quick: 'What is one thing this could teach you?',
                    intro: {
                        concept: 'Hard moments can teach us something. Not because they should happen, but because we can grow from them.',
                        example: { situation: 'You got passed over for a promotion.', action: 'Ask: ‚ÄúWhat can I learn from this?‚Äù', result: 'You identify skills to develop.' }
                    },
                    explore: {
                        prompt: 'What difficult experience has taught you something?',
                        checkboxes: ['Rejection', 'Loss', 'Failure', 'Betrayal', 'Illness'],
                        textareaPlaceholder: 'What did you learn?'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Meaning‚Äëmaking transforms suffering into growth. Finding a lesson doesn‚Äôt justify the pain, but it reduces helplessness.',
                        comparison: { left: 'Pain', leftIcon: 'üòû', right: 'Meaning', rightIcon: 'üìò', result: 'Growth' }
                    },
                    rules: [
                        { number: '1', title: 'Acknowledge the pain', description: 'Don‚Äôt bypass it.', example: '‚ÄúThis really hurts.‚Äù' },
                        { number: '2', title: 'Ask: What might this teach me?', description: 'Stay open, even if no answer comes.', example: '‚ÄúMaybe I need to set better boundaries.‚Äù' },
                        { number: '3', title: 'Write down one insight', description: 'Even a small one counts.', example: '‚ÄúI‚Äôm stronger than I thought.‚Äù' }
                    ],
                    practice: {
                        goalPrompt: 'What situation are you trying to make sense of?', goalPlaceholder: 'e.g., a recent disappointment',
                        actionPrompt: 'What could it teach you?', actionPlaceholder: 'e.g., patience, self‚Äëcompassion'
                    },
                    tool: {
                        title: 'Your ‚ÄúFind the Lesson‚Äù Tool', description: 'Suffering can become wisdom. Ask what this moment is teaching you.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat might I learn from this?‚Äù'
                    }
                },
                // ---------- LET GO ----------
                {
                    id: 'letgo', name: 'LET GO', icon: 'üïäÔ∏è', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Release what you cannot control', duration: 30, quick: 'Say ‚ÄúI release this‚Äù and breathe out',
                    intro: {
                        concept: 'Some things are not yours to carry right now. Give yourself permission to put them down.',
                        example: { situation: 'You‚Äôre stewing over a rude comment.', action: 'Say silently: ‚ÄúI release this. It is not mine to hold.‚Äù', result: 'The grip loosens.' }
                    },
                    explore: {
                        prompt: 'What are you holding that you can‚Äôt control?',
                        checkboxes: ['Someone else‚Äôs opinion', 'The past', 'An outcome', 'Another person‚Äôs choices', 'A mistake you made'],
                        textareaPlaceholder: 'Describe what you‚Äôre gripping...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Radical acceptance reduces suffering. Letting go is an active process, not passive resignation. It frees mental energy.',
                        comparison: { left: 'Gripping', leftIcon: 'ü§≤', right: 'Releasing', rightIcon: 'üïäÔ∏è', result: 'Freedom' }
                    },
                    rules: [
                        { number: '1', title: 'Identify what you cannot control', description: 'Name it clearly.', example: '‚ÄúI can‚Äôt control whether he apologizes.‚Äù' },
                        { number: '2', title: 'Say ‚ÄúI release this‚Äù', description: 'Out loud or in your head.', example: '‚ÄúI let go of needing to be right.‚Äù' },
                        { number: '3', title: 'Imagine it floating away', description: 'Visualize it leaving you.', example: 'A balloon drifting upward.' }
                    ],
                    practice: {
                        goalPrompt: 'What do you need to release?', goalPlaceholder: 'e.g., anger at myself',
                        actionPrompt: 'How will you visualize letting go?', actionPlaceholder: 'e.g., writing it on paper and tearing it'
                    },
                    tool: {
                        title: 'Your ‚ÄúLet Go‚Äù Tool', description: 'You can‚Äôt control everything, but you can choose what to carry.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúIs this mine to hold right now?‚Äù'
                    }
                },
                // ---------- CALM DOWN ----------
                {
                    id: 'calmdown', name: 'CALM DOWN', icon: 'üßò', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Soothe your body', duration: 60, quick: 'Look at something beautiful or calming',
                    intro: {
                        concept: 'Your senses are a direct line to your nervous system. Feed them calm.',
                        example: { situation: 'You feel agitated after a stressful call.', action: 'Look at a photo of a peaceful forest.', result: 'Your heart rate slows.' }
                    },
                    explore: {
                        prompt: 'Which sense is easiest for you to soothe?',
                        checkboxes: ['Sight', 'Hearing', 'Smell', 'Taste', 'Touch'],
                        textareaPlaceholder: 'What specific images, sounds, scents calm you?'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Sensory soothing (soft textures, gentle sounds, calming scents) directly activates the parasympathetic nervous system.',
                        comparison: { left: 'Agitation', leftIcon: 'üò§', right: 'Sensory calm', rightIcon: 'üßò', result: 'Relaxation' }
                    },
                    rules: [
                        { number: '1', title: 'Choose one sense', description: 'Pick the sense that‚Äôs easiest to access.', example: 'Sight.' },
                        { number: '2', title: 'Find something calming for that sense', description: 'It can be anything.', example: 'A houseplant, a candle.' },
                        { number: '3', title: 'Focus on it for 1‚Äë3 minutes', description: 'Really notice it.', example: 'Observe the veins in the leaf.' }
                    ],
                    practice: {
                        goalPrompt: 'What sense do you want to soothe?', goalPlaceholder: 'e.g., hearing',
                        actionPrompt: 'What calming input will you use?', actionPlaceholder: 'e.g., rain sounds'
                    },
                    tool: {
                        title: 'Your ‚ÄúCalm Down‚Äù Tool', description: 'Your senses are a volume knob for stress. Turn it down.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat can I see, hear, smell, taste, or touch that soothes me?‚Äù'
                    }
                },
                // ---------- ONE THING ----------
                {
                    id: 'onething', name: 'ONE THING', icon: 'üéØ', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Focus on just this moment', duration: 40, quick: 'Count 5 breaths, from 1 to 5',
                    intro: {
                        concept: 'Your mind can only hold so much. For now, focus on one thing. Just this breath. Just this moment.',
                        example: { situation: 'You‚Äôre overwhelmed by a long to‚Äëdo list.', action: 'Pause and count 5 breaths.', result: 'The overwhelm shrinks to manageable size.' }
                    },
                    explore: {
                        prompt: 'What scatters your attention most?',
                        checkboxes: ['Too many tasks', 'Worry', 'Phone notifications', 'Noise', 'Internal chatter'],
                        textareaPlaceholder: 'Describe a time you felt scattered...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Mono‚Äëtasking reduces cognitive load and anxiety. The brain is not designed for multitasking.',
                        comparison: { left: 'Scattered', leftIcon: 'üåÄ', right: 'One thing', rightIcon: 'üéØ', result: 'Clarity' }
                    },
                    rules: [
                        { number: '1', title: 'Choose one thing', description: 'Just one.', example: 'Your breath, a sound, an object.' },
                        { number: '2', title: 'Focus all attention on it', description: 'If your mind wanders, gently return.', example: 'Count 1 on the inhale, 2 on the exhale...' },
                        { number: '3', title: 'Do this for 1‚Äë2 minutes', description: 'It‚Äôs a mini‚Äëmeditation.', example: 'Set a timer if helpful.' }
                    ],
                    practice: {
                        goalPrompt: 'What one thing can you focus on right now?', goalPlaceholder: 'e.g., my breath',
                        actionPrompt: 'How long will you focus?', actionPlaceholder: 'e.g., 2 minutes'
                    },
                    tool: {
                        title: 'Your ‚ÄúOne Thing‚Äù Tool', description: 'When everything is too much, choose one thing. Just this.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat‚Äôs the one thing I can focus on right now?‚Äù'
                    }
                },
                // ---------- STEP AWAY ----------
                {
                    id: 'stepaway', name: 'STEP AWAY', icon: 'üö∂', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Take a short break', duration: 300, quick: 'Step into another room for 5 minutes',
                    intro: {
                        concept: 'You don‚Äôt have to leave forever. Just 5‚Äë15 minutes away can change everything.',
                        example: { situation: 'An argument is escalating.', action: 'Say ‚ÄúI need a few minutes‚Äù and step outside.', result: 'You both cool down, the conversation becomes possible.' }
                    },
                    explore: {
                        prompt: 'When do you most need to step away?',
                        checkboxes: ['During arguments', 'When overwhelmed', 'Before making a decision', 'When angry', 'When anxious'],
                        textareaPlaceholder: 'Describe a situation where a break would have helped...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Time out interrupts the escalation cycle. It gives the nervous system time to down‚Äëregulate.',
                        comparison: { left: 'Escalation', leftIcon: 'üìà', right: 'Time out', rightIcon: '‚è∏Ô∏è', result: 'De‚Äëescalation' }
                    },
                    rules: [
                        { number: '1', title: 'Recognize you need a break', description: 'Notice the signs.', example: 'Racing heart, raised voice.' },
                        { number: '2', title: 'Step away physically', description: 'Leave the room, go outside.', example: 'Even a bathroom break helps.' },
                        { number: '3', title: 'Give yourself 5‚Äë15 minutes', description: 'Don‚Äôt rush back.', example: 'Take a short walk.' }
                    ],
                    practice: {
                        goalPrompt: 'What situation might require a break soon?', goalPlaceholder: 'e.g., a difficult meeting',
                        actionPrompt: 'Where could you step away to?', actionPlaceholder: 'e.g., the stairwell, outside'
                    },
                    tool: {
                        title: 'Your ‚ÄúStep Away‚Äù Tool', description: 'A short break is not an escape‚Äîit‚Äôs a strategic pause.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWould stepping away for 5 minutes help?‚Äù'
                    }
                },
                // ---------- BE YOUR OWN FRIEND ----------
                {
                    id: 'beownfriend', name: 'BE YOUR OWN FRIEND', icon: 'üíó', familyId: 'comfort', familyName: 'COMFORT', familyColor: '#7c3aed',
                    tagline: 'Talk to yourself with kindness', duration: 45, quick: 'Say ‚ÄúI am doing my best. This is temporary.‚Äù',
                    intro: {
                        concept: 'Would you say this to someone you love? If not, change the words.',
                        example: { situation: 'You made a mistake and you‚Äôre calling yourself an idiot.', action: 'Pause and say: ‚ÄúYou‚Äôre human. You‚Äôre learning.‚Äù', result: 'Shame loosens, motivation returns.' }
                    },
                    explore: {
                        prompt: 'What harsh things do you often say to yourself?',
                        checkboxes: ['‚ÄúI‚Äôm so stupid‚Äù', '‚ÄúI always mess up‚Äù', '‚ÄúI‚Äôm not good enough‚Äù', '‚ÄúNo one likes me‚Äù', '‚ÄúI deserve this‚Äù'],
                        textareaPlaceholder: 'Write down one self‚Äëcritical thought...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Self‚Äëcompassion activates care‚Äëgiving neural circuits and reduces threat responses. It‚Äôs a skill that can be learned.',
                        comparison: { left: 'Self‚Äëcriticism', leftIcon: 'üó£Ô∏è', right: 'Self‚Äëcompassion', rightIcon: 'üíó', result: 'Emotional safety' }
                    },
                    rules: [
                        { number: '1', title: 'Notice your self‚Äëtalk', description: 'Catch the critical voice.', example: '‚ÄúThere I go again.‚Äù' },
                        { number: '2', title: 'Imagine a friend in your situation', description: 'What would you say to them?', example: '‚ÄúYou did your best.‚Äù' },
                        { number: '3', title: 'Speak to yourself as you would to them', description: 'Use kind, encouraging words.', example: '‚ÄúIt‚Äôs okay to make mistakes.‚Äù' }
                    ],
                    practice: {
                        goalPrompt: 'What do you need to hear right now?', goalPlaceholder: 'e.g., ‚ÄúI‚Äôm doing enough‚Äù',
                        actionPrompt: 'What kind words will you say to yourself?', actionPlaceholder: 'e.g., ‚ÄúI am worthy of love‚Äù'
                    },
                    tool: {
                        title: 'Your ‚ÄúBe Your Own Friend‚Äù Tool', description: 'You have the capacity to be kind to yourself. Practice it daily.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat would I say to a dear friend who feels this way?‚Äù'
                    }
                }
            ],

            // ------------------------------------------------------------
            // 3. WEIGH IT ‚Äî 1 skill
            // ------------------------------------------------------------
            weighit: [
                {
                    id: 'listitout', name: 'LIST IT OUT', icon: 'üìã', familyId: 'weighit', familyName: 'WEIGH IT', familyColor: '#d97706',
                    tagline: 'Compare helping vs hurting', duration: 90, quick: 'Quick list: What helps? What hurts?',
                    intro: {
                        concept: 'When urges are strong, writing down the pros and cons can slow you down enough to choose wisely.',
                        example: { situation: 'You want to send an angry text.', action: 'Write ‚ÄúAct‚Äù vs ‚ÄúDon‚Äôt act‚Äù columns.', result: 'Seeing the cons of acting helps you pause.' }
                    },
                    explore: {
                        prompt: 'What impulsive decisions have you regretted?',
                        checkboxes: ['Sending an angry message', 'Quitting something abruptly', 'Spending money I didn‚Äôt have', 'Eating when stressed', 'Saying something hurtful'],
                        textareaPlaceholder: 'Describe a time you acted impulsively...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Urges are emotional, not logical. Writing pros and cons engages the prefrontal cortex and reduces impulsivity.',
                        comparison: { left: 'Impulse', leftIcon: '‚ö°', right: 'Written list', rightIcon: 'üìã', result: 'Wiser choice' }
                    },
                    rules: [
                        { number: '1', title: 'Draw a line down the paper', description: 'Or open a notes app.', example: 'Two columns.' },
                        { number: '2', title: 'Label: Act vs. Don‚Äôt act', description: 'One column for each option.', example: '‚ÄúSend text‚Äù vs ‚ÄúWait‚Äù' },
                        { number: '3', title: 'List pros and cons for each', description: 'Be honest.', example: '‚ÄúPro of acting: relief. Con: might damage relationship.‚Äù' }
                    ],
                    practice: {
                        goalPrompt: 'What decision are you facing right now?', goalPlaceholder: 'e.g., whether to confront someone',
                        actionPrompt: 'What are the pros and cons?', actionPlaceholder: 'e.g., pro: closure, con: conflict'
                    },
                    tool: {
                        title: 'Your ‚ÄúList It Out‚Äù Tool', description: 'A pros‚Äëand‚Äëcons list turns an emotional urge into a rational decision.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat would happen if I acted now? What if I waited?‚Äù'
                    }
                }
            ],

            // ------------------------------------------------------------
            // 4. PAUSE ‚Äî 4 skills
            // ------------------------------------------------------------
            pause: [
                // ---------- FREEZE ----------
                {
                    id: 'freeze', name: 'FREEZE', icon: '‚ùÑÔ∏è', familyId: 'pause', familyName: 'PAUSE', familyColor: '#0891b2',
                    tagline: 'Stop. Don‚Äôt move. Don‚Äôt react.', duration: 10, quick: 'Stop. Don‚Äôt move. Count to 5.',
                    intro: {
                        concept: 'The moment between urge and action is where your power lives. Just freeze for 5‚Äë10 seconds.',
                        example: { situation: 'You feel the urge to snap back.', action: 'Stop all movement. Count to 5.', result: 'The urge passes like a wave.' }
                    },
                    explore: {
                        prompt: 'When do you most need to freeze?',
                        checkboxes: ['When angry', 'When anxious', 'When about to interrupt', 'When reaching for something harmful', 'When saying something you‚Äôll regret'],
                        textareaPlaceholder: 'Describe a situation where freezing would have helped...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Freezing interrupts the automatic action chain. It creates space for choice.',
                        comparison: { left: 'Automatic reaction', leftIcon: '‚ö°', right: 'Freeze', rightIcon: '‚ùÑÔ∏è', result: 'Conscious choice' }
                    },
                    rules: [
                        { number: '1', title: 'Notice the urge to act', description: 'Catch it early.', example: '‚ÄúI want to say something sharp.‚Äù' },
                        { number: '2', title: 'Stop all movement', description: 'Freeze your body.', example: 'Hands still, mouth closed.' },
                        { number: '3', title: 'Count to 5', description: 'Or 10, or just breathe.', example: '1‚Ä¶2‚Ä¶3‚Ä¶4‚Ä¶5.' }
                    ],
                    practice: {
                        goalPrompt: 'What urge do you want to pause?', goalPlaceholder: 'e.g., urge to check my phone',
                        actionPrompt: 'How long will you freeze?', actionPlaceholder: 'e.g., 5 seconds'
                    },
                    tool: {
                        title: 'Your ‚ÄúFreeze‚Äù Tool', description: 'You can‚Äôt control the urge, but you can control whether you act on it.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúCan I freeze for five seconds before I react?‚Äù'
                    }
                },
                // ---------- STEP BACK ----------
                {
                    id: 'stepback', name: 'STEP BACK', icon: 'üë£', familyId: 'pause', familyName: 'PAUSE', familyColor: '#0891b2',
                    tagline: 'Create space between you and the urge', duration: 20, quick: 'Take one step back and breathe',
                    intro: {
                        concept: 'Take a breath. Step away from the situation. Even one step changes your perspective.',
                        example: { situation: 'You‚Äôre in a heated discussion.', action: 'Physically step back one step and take a breath.', result: 'You feel less trapped.' }
                    },
                    explore: {
                        prompt: 'What makes you feel emotionally flooded?',
                        checkboxes: ['Confrontation', 'Loud noises', 'Being pressured', 'Feeling misunderstood', 'Time pressure'],
                        textareaPlaceholder: 'Describe a moment you needed space...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Physical distance creates psychological distance. It signals safety to the brain.',
                        comparison: { left: 'Emotionally flooded', leftIcon: 'üåä', right: 'Step back', rightIcon: 'üë£', result: 'Perspective' }
                    },
                    rules: [
                        { number: '1', title: 'Take one deep breath', description: 'Inhale, exhale slowly.', example: 'Breathe in for 4, out for 6.' },
                        { number: '2', title: 'Physically step back', description: 'Even a few inches counts.', example: 'Move your chair back.' },
                        { number: '3', title: 'Pause and notice', description: 'What do you see now?', example: 'The situation looks different.' }
                    ],
                    practice: {
                        goalPrompt: 'What situation is too close right now?', goalPlaceholder: 'e.g., a heated email',
                        actionPrompt: 'How can you step back?', actionPlaceholder: 'e.g., close the laptop, stand up'
                    },
                    tool: {
                        title: 'Your ‚ÄúStep Back‚Äù Tool', description: 'Distance creates clarity. Step back before you step in.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat would this look like from a few steps away?‚Äù'
                    }
                },
                // ---------- NOTICE ----------
                {
                    id: 'notice', name: 'NOTICE', icon: 'üëì', familyId: 'pause', familyName: 'PAUSE', familyColor: '#0891b2',
                    tagline: 'Watch what‚Äôs happening inside', duration: 40, quick: 'Label your thought: ‚ÄúI notice I am thinking...‚Äù',
                    intro: {
                        concept: 'You are not your thoughts. You are the one noticing them. Just observe without judgment.',
                        example: { situation: 'You‚Äôre caught in a spiral of self‚Äëdoubt.', action: 'Say: ‚ÄúI notice I am having the thought that I‚Äôm not good enough.‚Äù', result: 'The thought loses its power.' }
                    },
                    explore: {
                        prompt: 'What thoughts hook you most often?',
                        checkboxes: ['Self‚Äëdoubt', 'Worry about the future', 'Rumination about the past', 'Comparison to others', 'Catastrophizing'],
                        textareaPlaceholder: 'Describe a thought that often hooks you...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'Cognitive defusion creates distance. You can‚Äôt stop thoughts, but you can change your relationship to them.',
                        comparison: { left: 'Fused with thought', leftIcon: 'üîó', right: 'Notice the thought', rightIcon: 'üëì', result: 'Freedom' }
                    },
                    rules: [
                        { number: '1', title: 'Notice the thought or feeling', description: 'Just acknowledge it.', example: '‚ÄúThere‚Äôs anxiety.‚Äù' },
                        { number: '2', title: 'Label it', description: '‚ÄúI notice I am thinking...‚Äù', example: '‚ÄúI notice I am worrying.‚Äù' },
                        { number: '3', title: 'Let it pass like a cloud', description: 'Don‚Äôt hold onto it.', example: 'Watch it drift by.' }
                    ],
                    practice: {
                        goalPrompt: 'What thought is here right now?', goalPlaceholder: 'e.g., ‚ÄúI‚Äôm going to fail‚Äù',
                        actionPrompt: 'How can you label it?', actionPlaceholder: 'e.g., ‚ÄúI notice I am having the thought that...‚Äù'
                    },
                    tool: {
                        title: 'Your ‚ÄúNotice‚Äù Tool', description: 'You are the sky; thoughts are the weather. You don‚Äôt have to control the weather.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúWhat thought is passing through right now?‚Äù'
                    }
                },
                // ---------- MOVE FORWARD ----------
                {
                    id: 'moveforward', name: 'MOVE FORWARD', icon: 'üéØ', familyId: 'pause', familyName: 'PAUSE', familyColor: '#0891b2',
                    tagline: 'Act with intention', duration: 30, quick: 'Take a breath. Ask: ‚ÄúWhat‚Äôs the wise thing to do?‚Äù',
                    intro: {
                        concept: 'Now that you‚Äôve paused, what‚Äôs the wise next step? Not perfect ‚Äî just wise.',
                        example: { situation: 'You‚Äôve paused and breathed after an upsetting email.', action: 'Ask: ‚ÄúWhat‚Äôs the most effective response?‚Äù', result: 'You reply calmly, preserving the relationship.' }
                    },
                    explore: {
                        prompt: 'What usually helps you make wise decisions?',
                        checkboxes: ['Taking time', 'Asking a trusted person', 'Listing options', 'Checking in with values', 'Sleeping on it'],
                        textareaPlaceholder: 'Describe a time you made a wise choice...'
                    },
                    why: {
                        title: 'üß† Why it works',
                        explanation: 'After pause, intention is key. Wise mind integrates emotion and reason.',
                        comparison: { left: 'Reaction', leftIcon: '‚ö°', right: 'Intention', rightIcon: 'üéØ', result: 'Wise action' }
                    },
                    rules: [
                        { number: '1', title: 'Acknowledge emotion', description: 'Recognize what you feel.', example: '‚ÄúI‚Äôm angry.‚Äù' },
                        { number: '2', title: 'Acknowledge logic', description: 'What are the facts?', example: '‚ÄúSending this won‚Äôt solve anything.‚Äù' },
                        { number: '3', title: 'Ask: What‚Äôs the wise thing to do?', description: 'The answer that integrates both.', example: '‚ÄúI‚Äôll respond tomorrow after I cool down.‚Äù' }
                    ],
                    practice: {
                        goalPrompt: 'What decision are you facing?', goalPlaceholder: 'e.g., whether to bring up an issue',
                        actionPrompt: 'What would be the wise next step?', actionPlaceholder: 'e.g., wait, then ask a neutral question'
                    },
                    tool: {
                        title: 'Your ‚ÄúMove Forward‚Äù Tool', description: 'Wisdom is knowing what to do with what you‚Äôve paused.',
                        question: 'Ask yourself:', questionHighlight: '‚ÄúNow that I‚Äôve paused, what‚Äôs the wise thing to do?‚Äù'
                    }
                }
            ]
        };

        // ==================== APP STATE ====================
        const AppState = {
            skill: null, currentStep: 1, timer: null, timerSeconds: 0, timerRunning: false,
            responses: { checkboxes: [], exploreText: '', goal: '', action: '', rating: 5 },
            
            loadSkill() {
                const urlParams = new URLSearchParams(window.location.search);
                const skillId = urlParams.get('skill');
                if (!skillId) { showToast('No skill selected'); setTimeout(() => window.location.href = 'academy.html', 1500); return; }
                for (const familyId in ALL_SKILLS) {
                    const found = ALL_SKILLS[familyId].find(s => s.id === skillId);
                    if (found) { this.skill = JSON.parse(JSON.stringify(found)); break; }
                }
                if (!this.skill) { showToast('Skill not found'); setTimeout(() => window.location.href = 'academy.html', 1500); return; }
                this.currentStep = 1;
                this.responses = { checkboxes: [], exploreText: '', goal: '', action: '', rating: 5 };
                this.timerSeconds = this.skill.duration || 45;
                this.render();
            },
            nextStep() { if (this.currentStep < 7) { this.currentStep++; this.render(); document.querySelector('.main-content')?.scrollTo({ top: 0, behavior: 'smooth' }); } },
            prevStep() { if (this.currentStep > 1) { this.currentStep--; this.render(); document.querySelector('.main-content')?.scrollTo({ top: 0, behavior: 'smooth' }); } },
            goBack() { this.currentStep > 1 ? this.prevStep() : window.location.href = `family.html?id=${this.skill.familyId}`; },
            toggleCheckbox(text, checked) {
                if (checked) { if (!this.responses.checkboxes.includes(text)) this.responses.checkboxes.push(text); }
                else { const i = this.responses.checkboxes.indexOf(text); if (i > -1) this.responses.checkboxes.splice(i, 1); }
            },
            setExploreText(v) { this.responses.exploreText = v; },
            setGoal(v) { this.responses.goal = v; this.render(); },
            setAction(v) { this.responses.action = v; this.render(); },
            setRating(v) { this.responses.rating = parseInt(v); this.render(); },
            canProceed() {
                if (this.currentStep === 2) return this.responses.exploreText.length >= 10;
                if (this.currentStep === 5) return this.responses.goal.trim().length > 0 && this.responses.action.trim().length > 0;
                return true;
            },
            addToToolkit() {
                const toolkit = JSON.parse(localStorage.getItem('mphaven_toolkit') || '{}');
                toolkit[this.skill.id] = { id: this.skill.id, name: this.skill.name, familyId: this.skill.familyId, icon: this.skill.icon, quick: this.skill.quick, savedAt: new Date().toISOString(), timesPracticed: (toolkit[this.skill.id]?.timesPracticed || 0) + 1 };
                localStorage.setItem('mphaven_toolkit', JSON.stringify(toolkit));
                showToast(`‚úì ${this.skill.name} added to toolkit`);
                this.render();
            },
            downloadNotes() {
                const s = this.skill, r = this.responses;
                const content = `üîπ SKILL: ${s.name} (${s.familyName})\nüìÖ ${new Date().toLocaleDateString()}\n\nüìå WHAT I LEARNED:\n${s.intro?.concept || ''}\n\nüß† WHY IT WORKS:\n${s.why?.explanation || ''}\n\n‚úèÔ∏è MY EXPLORATION:\nTrigger: ${r.exploreText || '[not entered]'}\nPatterns: ${r.checkboxes.join(', ') || 'none selected'}\n\nüéØ MY REAL GOAL:\n${r.goal || '[not set]'}\n\n‚úÖ MY WISE ACTION:\n${r.action || '[not set]'}\n\n‚ö° MY RATING:\nEffectiveness: ${r.rating}/10\n\nüí° REMEMBER:\n${s.tool?.questionHighlight || 'You can do this.'}\n\n‚Äî from MPHaven Survival Toolkit`;
                try {
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = `${s.id}-practice-${new Date().toISOString().split('T')[0]}.txt`;
                    a.style.display = 'none'; document.body.appendChild(a); a.click();
                    setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 100);
                    showToast('‚úÖ Practice notes downloaded!');
                } catch(e) { showToast('‚ùå Download failed'); }
            },
            tryQuickVersion() { window.location.href = `quick-use.html?skill=${this.skill.id}`; },
            goToToolkit() { window.location.href = 'my-toolkit.html'; },
            formatTime(s) { const m = Math.floor(s/60); const sec = s%60; return `${m}:${sec<10?'0':''}${sec}`; },
            startTimer() {
                if (this.timerRunning) return;
                this.timerRunning = true;
                this.timer = setInterval(() => {
                    this.timerSeconds--;
                    if (this.timerSeconds <= 0) { this.stopTimer(); showToast('Time‚Äôs up! üåä'); }
                    this.render();
                }, 1000);
                this.render();
            },
            stopTimer() { if (this.timer) clearInterval(this.timer); this.timer = null; this.timerRunning = false; this.render(); },
            skipTimer() { this.stopTimer(); this.nextStep(); },
            getRatingEmoji(r) { const e = ['üòû','üòï','üòê','üôÇ','üòä','üòÅ','ü§ù','üí™','‚ú®','üî•']; return e[Math.min(Math.max(0,r-1),9)]; },
            render() {
                if (!this.skill) return;
                const s = this.skill, step = this.currentStep, canProceed = this.canProceed();
                let html = `<div class="content-wrapper"><div class="progress-container"><div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;"><button class="back-btn" onclick="AppState.goBack()">‚Üê</button><div style="font-size:0.875rem; color:#94a3b8;">${step}/7</div></div><div class="progress-dots">${[1,2,3,4,5,6,7].map(i => `<div class="progress-dot ${i<=step?'active':''}"></div>`).join('')}</div></div>`;
                if (step === 1) {
                    html += `<div class="skill-header"><div class="skill-icon-large" style="background:${s.familyColor}20; color:${s.familyColor}">${s.icon}</div><div class="skill-info"><span class="family-badge" style="background:${s.familyColor}20; color:${s.familyColor}">${s.familyName}</span><div class="skill-name" style="color:${s.familyColor}">${s.name}</div><div class="skill-tagline">${s.tagline}</div></div></div>
                    <div class="card"><div class="card-title">üìò What it is</div><div class="card-text">${s.intro?.concept || ''}</div></div>
                    ${s.intro?.example ? `<div class="card" style="border-left:4px solid ${s.familyColor}; background:rgba(14,116,144,0.05);"><div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.75rem;"><span style="font-size:1.5rem;">üí°</span><h3 style="font-weight:600;">Example</h3></div><p style="color:#cbd5e1; margin-bottom:0.5rem;"><span style="color:white; font-weight:600;">Situation:</span> ${s.intro.example.situation}</p><p style="color:#cbd5e1; margin-bottom:0.5rem;"><span style="color:white; font-weight:600;">Action:</span> ${s.intro.example.action}</p><p style="color:#cbd5e1;"><span style="color:white; font-weight:600;">Result:</span> ${s.intro.example.result}</p></div>` : ''}
                    <button class="btn btn-primary" onclick="AppState.nextStep()">Start Learning ‚Üí</button>
                    <button class="btn btn-secondary" onclick="window.location.href='family.html?id=${s.familyId}'">‚Üê Back to skills</button>`;
                } else if (step === 2 && s.explore) {
                    html += `<div class="card" style="border-left:4px solid #d97706;"><div class="card-title">üîç Explore the moment</div><p style="color:#cbd5e1; margin-bottom:1.5rem;">${s.explore.prompt}</p>
                    <div class="checkbox-grid">${s.explore.checkboxes.map(t => `<label class="checkbox-label ${this.responses.checkboxes.includes(t)?'checked':''}"><input type="checkbox" ${this.responses.checkboxes.includes(t)?'checked':''} onchange="AppState.toggleCheckbox('${t.replace(/'/g, "\\'")}', this.checked)"><span style="color:#cbd5e1;">${t}</span></label>`).join('')}</div>
                    <p style="font-weight:600; margin-top:1.5rem;">Describe what it felt like:</p>
                    <textarea id="exploreText" placeholder="${s.explore.textareaPlaceholder}" oninput="AppState.setExploreText(this.value)">${this.responses.exploreText}</textarea>
                    <div class="char-counter ${this.responses.exploreText.length>=10?'active':''}">${this.responses.exploreText.length} characters (min 10)</div></div>
                    <button class="btn btn-primary" onclick="AppState.nextStep()" ${!canProceed?'disabled':''}>Continue ‚Üí</button>
                    <button class="btn btn-secondary" onclick="AppState.prevStep()">‚Üê Back</button>`;
                } else if (step === 3 && s.why) {
                    html += `<div class="card"><div class="card-title">üß† ${s.why.title || 'Why it works'}</div><div class="card-text">${s.why.explanation}</div>
                    ${s.why.comparison ? `<div style="display:flex; align-items:center; justify-content:space-around; margin-top:1.5rem; padding:1rem; background:rgba(0,0,0,0.2); border-radius:1rem;">
                        <div style="text-align:center;"><div style="font-size:2rem;">${s.why.comparison.leftIcon}</div><p style="color:#94a3b8;">${s.why.comparison.left}</p></div>
                        <div style="font-size:2rem;">‚Üí</div>
                        <div style="text-align:center;"><div style="font-size:2rem;">${s.why.comparison.rightIcon}</div><p style="color:#94a3b8;">${s.why.comparison.right}</p></div>
                        <div style="font-size:2rem;">‚Üí</div>
                        <div style="text-align:center;"><div style="font-size:2rem;">‚úÖ</div><p style="color:#a5f3fc;">${s.why.comparison.result}</p></div>
                    </div>` : ''}</div>
                    <button class="btn btn-primary" onclick="AppState.nextStep()">Continue ‚Üí</button>
                    <button class="btn btn-secondary" onclick="AppState.prevStep()">‚Üê Back</button>`;
                } else if (step === 4 && s.rules) {
                    html += `<div class="card"><div class="card-title">üìã Step by step</div><div style="display:flex; flex-direction:column; gap:1rem;">${s.rules.map(r => `<div style="display:flex; align-items:start; gap:1rem; background:rgba(14,116,144,0.05); padding:1rem; border-radius:0.75rem;"><div style="background:${s.familyColor}20; color:${s.familyColor}; width:2rem; height:2rem; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; flex-shrink:0;">${r.number}</div><div><h4 style="font-weight:600; margin-bottom:0.25rem;">${r.title}</h4><p style="color:#cbd5e1; font-size:0.875rem;">${r.description}</p><p style="color:${s.familyColor}; font-size:0.8125rem; margin-top:0.5rem;"><em>${r.example}</em></p></div></div>`).join('')}</div></div>
                    <button class="btn btn-primary" onclick="AppState.nextStep()">Practice ‚Üí</button>
                    <button class="btn btn-secondary" onclick="AppState.prevStep()">‚Üê Back</button>`;
                } else if (step === 5 && s.practice) {
                    html += `<div class="card"><div class="card-title">üéØ What do you truly want?</div><p style="color:#cbd5e1; margin-bottom:0.5rem;">${s.practice.goalPrompt}</p><input type="text" id="goalInput" placeholder="${s.practice.goalPlaceholder}" value="${this.responses.goal}" oninput="AppState.setGoal(this.value)"></div>
                    <div class="card"><div class="card-title">‚úÖ What action will you take?</div><p style="color:#cbd5e1; margin-bottom:0.5rem;">${s.practice.actionPrompt}</p><input type="text" id="actionInput" placeholder="${s.practice.actionPlaceholder}" value="${this.responses.action}" oninput="AppState.setAction(this.value)"></div>
                    <div class="rating-container"><p style="font-weight:600; margin-bottom:1rem;">‚ö° How effective do you think this will be?</p><input type="range" min="1" max="10" value="${this.responses.rating}" id="ratingSlider" oninput="AppState.setRating(this.value)"><div class="rating-display"><span style="color:#94a3b8;">Not effective</span><div class="rating-value"><span class="rating-number">${this.responses.rating}</span><span class="rating-emoji">${this.getRatingEmoji(this.responses.rating)}</span></div><span style="color:#94a3b8;">Very effective</span></div></div>
                    <button class="btn btn-primary" onclick="AppState.nextStep()" ${!canProceed?'disabled':''}>Continue ‚Üí</button>
                    <button class="btn btn-secondary" onclick="AppState.prevStep()">‚Üê Back</button>`;
                } else if (step === 6 && s.tool) {
                    html += `<div class="skill-header" style="margin-bottom:1rem;"><div class="skill-icon-large" style="background:${s.familyColor}20; color:${s.familyColor}">üõ†Ô∏è</div><div class="skill-info"><div class="skill-name" style="color:${s.familyColor}">${s.tool.title}</div></div></div>
                    <div class="card"><p style="color:#cbd5e1; line-height:1.6;">${s.tool.description}</p><div style="background:rgba(14,116,144,0.15); padding:1.25rem; border-radius:1rem; margin-top:1rem;"><p style="color:#94a3b8; margin-bottom:0.5rem;">${s.tool.question}</p><p style="color:${s.familyColor}; font-size:1.25rem; font-weight:700; text-align:center;">${s.tool.questionHighlight}</p></div></div>
                    <button class="btn btn-primary" onclick="AppState.nextStep()">Finish & Save ‚Üí</button>
                    <button class="btn btn-secondary" onclick="AppState.prevStep()">‚Üê Back</button>`;
                } else if (step === 7) {
                    html += `<div style="text-align:center; padding:1rem 0;"><div style="font-size:4rem; color:#4ade80; margin-bottom:1rem;">‚úì</div>
                    <h2 style="font-size:1.75rem; font-weight:800; margin-bottom:0.5rem;">Skill complete</h2><p style="color:#94a3b8; margin-bottom:2rem;">You practiced ${s.name}</p>
                    <div style="background:rgba(34,197,94,0.12); border:1px solid rgba(74,222,128,0.3); border-radius:1rem; padding:1.5rem; margin-bottom:2rem;">
                        <div style="display:flex; align-items:center; justify-content:center; gap:0.5rem; color:#4ade80; font-size:1.25rem; font-weight:700; margin-bottom:0.5rem;">‚¨áÔ∏è You rated this ${this.responses.rating}/10</div>
                        <span style="background:rgba(14,116,144,0.15); padding:0.5rem 1rem; border-radius:9999px; color:#a5f3fc; font-size:0.875rem; font-weight:600;">This tool can work for you</span>
                    </div>
                    <div style="display:grid; gap:0.75rem; margin-bottom:2rem;">
                        <button class="btn btn-primary" onclick="AppState.addToToolkit()">‚úÖ Add to my toolkit</button>
                        <button class="btn btn-secondary" onclick="AppState.downloadNotes()">üíæ Download my practice notes</button>
                        <button class="btn btn-secondary" onclick="AppState.tryQuickVersion()">‚ö° Try quick version</button>
                        <button class="btn btn-secondary" onclick="AppState.goToToolkit()">‚Üê Go to toolkit</button>
                    </div></div>`;
                }
                html += `</div>`;
                document.getElementById('mainContent').innerHTML = html;
            }
        };

        // ==================== GLOBALS ====================
        function showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }
        window.AppState = AppState; window.showToast = showToast;
        function init() { 
            document.addEventListener('touchstart', e => { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });
            if (!localStorage.getItem('mphaven_toolkit')) localStorage.setItem('mphaven_toolkit', '{}');
            AppState.loadSkill();
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
