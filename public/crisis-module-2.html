<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f172a">
<title>Module 2: Physical Reset ‚Äî Body to Brain</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    --bg-dark: #0f172a;
    --bg-card: rgba(15, 23, 42, 0.98);
    --bg-card-light: rgba(30, 41, 59, 0.65);
    --bg-card-dark: rgba(15, 23, 42, 0.45);
    --border-subtle: rgba(30, 41, 59, 0.5);
    --border-softer: rgba(51, 65, 85, 0.4);
    --primary-teal: #0e7490;
    --primary-teal-dark: #0c627a;
    --accent-amber: #d97706;
    --accent-amber-dark: #b45309;
    --text-primary: rgb(241, 245, 249);
    --text-secondary: rgb(203, 213, 225);
    --text-muted: rgb(148, 163, 184);
    --text-teal-light: rgb(165, 243, 252);
    --text-teal: rgb(94, 234, 212);
    --text-amber: rgb(251, 191, 36);
    --success-emerald: rgb(74, 222, 128);
    --success-bg: rgba(34, 197, 94, 0.12);
    --gradient-main: linear-gradient(135deg, #0e7490, #d97706);
    --gradient-subtle: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.10));
    --crisis-red: #dc2626;
    --crisis-red-dark: #b91c1c;
    --crisis-bg: rgba(220, 38, 38, 0.08);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    -webkit-tap-highlight-color: transparent;
    -webkit-font-smoothing: antialiased;
}

html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: var(--bg-dark);
    color: var(--text-primary);
}

.container {
    width: 100%;
    height: 100vh;
    height: -webkit-fill-available;
    display: flex;
    flex-direction: column;
}

.app-wrapper {
    width: 100%;
    max-width: 28rem;
    height: 100%;
    margin: 0 auto;
    background: var(--bg-card);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

.bg-blur-1, .bg-blur-2 {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
    opacity: 0.3;
}

.bg-blur-1 {
    top: -5%;
    left: 50%;
    transform: translateX(-50%);
    width: 22rem;
    height: 22rem;
    background: rgba(14, 116, 144, 0.15);
}

.bg-blur-2 {
    bottom: -5%;
    right: -5%;
    width: 18rem;
    height: 18rem;
    background: rgba(217, 119, 6, 0.15);
}

.main-content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    position: relative;
    z-index: 1;
}

.main-content::-webkit-scrollbar {
    display: none;
}

.content-wrapper {
    padding: 1.25rem;
    padding-bottom: calc(2rem + env(safe-area-inset-bottom));
    min-height: 100%;
    display: flex;
    flex-direction: column;
}

/* Crisis Banner */
.crisis-banner {
    background: var(--crisis-bg);
    border: 1px solid var(--crisis-red);
    border-radius: 0.875rem;
    padding: 1rem 1.25rem;
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.crisis-banner__text {
    color: #fca5a5;
    font-size: 0.875rem;
    font-weight: 600;
    flex: 1;
    min-width: 180px;
}

.crisis-banner__actions {
    display: flex;
    gap: 0.625rem;
}

.crisis-banner__link {
    color: white;
    background: var(--crisis-red);
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-size: 0.8125rem;
    font-weight: 700;
    transition: all 0.2s;
}

.crisis-banner__link:active {
    background: #b91c1c;
    transform: scale(0.97);
}

/* Header */
.header {
    background: linear-gradient(135deg, var(--bg-card-light), var(--bg-card-dark));
    border: 1px solid var(--border-softer);
    border-radius: 1rem;
    padding: 1.25rem;
    margin-bottom: 1.25rem;
}

.header__top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.back-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.25rem;
    line-height: 1;
    transition: all 0.2s;
}

.back-btn:active {
    transform: scale(0.9);
}

.step-indicator {
    color: var(--text-muted);
    font-size: 0.875rem;
    font-weight: 600;
}

.progress-dots {
    display: flex;
    gap: 0.375rem;
    margin-bottom: 1rem;
}

.progress-dot {
    flex: 1;
    height: 0.5rem;
    background: rgba(148, 163, 184, 0.2);
    border-radius: 1rem;
    transition: all 0.3s;
}

.progress-dot.active {
    background: var(--gradient-main);
}

.step-title {
    font-size: 1.5rem;
    font-weight: 700;
    background: var(--gradient-main);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.step-subtitle {
    color: var(--text-secondary);
    font-size: 0.9375rem;
}

/* Card */
.card {
    background: linear-gradient(135deg, var(--bg-card-light), var(--bg-card-dark));
    border: 1px solid var(--border-softer);
    border-radius: 1.25rem;
    padding: 1.75rem 1.5rem;
    margin-bottom: 1.25rem;
}

.card--highlight {
    background: var(--gradient-subtle);
    border: 1px solid rgba(14, 116, 144, 0.3);
}

.card__icon {
    font-size: 3rem;
    text-align: center;
    margin-bottom: 1rem;
    line-height: 1;
}

.card__title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.25rem;
    line-height: 1.3;
    display: flex;
    align-items: center;
    gap: 0.625rem;
}

.card__content {
    color: var(--text-secondary);
    line-height: 1.7;
    font-size: 1rem;
}

.card__content p {
    margin-bottom: 1.25rem;
}

.card__content p:last-child {
    margin-bottom: 0;
}

.card__content strong {
    color: var(--text-teal);
    font-weight: 600;
}

/* Section Header */
.section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-softer);
}

.section-icon {
    font-size: 1.75rem;
}

.section-title-text {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-teal-light);
}

/* Stats */
.technique-stats {
    display: flex;
    gap: 1rem;
    margin: 1rem 0;
    padding: 1rem;
    background: rgba(15,23,42,0.6);
    border-radius: 0.75rem;
}

.stat {
    flex: 1;
    text-align: center;
}

.stat-label {
    color: var(--text-muted);
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.stat-value {
    color: var(--text-teal);
    font-weight: 700;
    font-size: 1rem;
    margin-top: 0.25rem;
}

/* Instruction Box */
.instruction-box {
    background: rgba(15,23,42,0.6);
    border-left: 4px solid var(--primary-teal);
    border-radius: 0.75rem;
    padding: 1.25rem;
    margin: 1.25rem 0;
}

.instruction-list {
    list-style: none;
    counter-reset: step-counter;
}

.instruction-list li {
    counter-increment: step-counter;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
    line-height: 1.6;
}

.instruction-list li:before {
    content: counter(step-counter);
    background: var(--gradient-subtle);
    color: var(--text-teal-light);
    font-weight: 700;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    flex-shrink: 0;
}

/* Safety Note */
.safety-note {
    background: rgba(220,38,38,0.1);
    border-left: 4px solid var(--crisis-red);
    padding: 1rem;
    border-radius: 0.75rem;
    margin: 1rem 0;
    font-size: 0.8125rem;
    color: #fca5a5;
    line-height: 1.6;
}

/* Practice Card */
.practice-card {
    background: var(--gradient-subtle);
    border: 2px solid rgba(14,116,144,0.3);
    border-radius: 1rem;
    padding: 1.5rem;
    margin: 1.25rem 0;
}

.practice-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-teal-light);
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 1rem;
}

.practice-buttons {
    display: flex;
    gap: 0.75rem;
    margin: 1.25rem 0;
}

.btn-practice {
    flex: 1;
    padding: 0.875rem;
    border-radius: 0.75rem;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
}

.btn-practice-primary {
    background: var(--gradient-main);
    color: white;
}

.btn-practice-primary:active {
    transform: scale(0.98);
    opacity: 0.9;
}

.btn-practice-secondary {
    background: var(--bg-card-dark);
    color: var(--text-secondary);
    border: 1px solid var(--border-softer);
}

.btn-practice-secondary:active {
    background: rgba(30, 41, 59, 0.8);
    transform: scale(0.98);
}

/* Timer */
.timer-container {
    text-align: center;
    padding: 1.5rem;
    background: rgba(15,23,42,0.8);
    border-radius: 1rem;
    margin: 1rem 0;
}

.timer-display {
    font-size: 3rem;
    font-weight: 800;
    color: var(--text-teal);
    font-variant-numeric: tabular-nums;
    margin-bottom: 1rem;
}

/* Checkboxes */
.reflection-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem;
    background: rgba(15,23,42,0.6);
    border: 1px solid var(--border-softer);
    border-radius: 0.75rem;
    cursor: pointer;
    color: var(--text-secondary);
    font-size: 0.875rem;
    transition: all 0.2s;
}

.reflection-checkbox.checked {
    border-color: var(--primary-teal);
    background: rgba(14,116,144,0.15);
    color: var(--text-primary);
}

.reflection-checkbox input[type="checkbox"] {
    width: 1.125rem;
    height: 1.125rem;
    accent-color: var(--primary-teal);
}

.reflection-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin: 1.25rem 0;
}

/* Reference Card */
.reference-card {
    background: var(--gradient-subtle);
    border: 1px solid rgba(14,116,144,0.3);
    border-radius: 1rem;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.reference-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--text-teal-light);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.reference-grid {
    display: grid;
    gap: 0.75rem;
}

.reference-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    background: rgba(15,23,42,0.6);
    border-radius: 0.75rem;
}

.reference-icon {
    font-size: 1.25rem;
}

.reference-content {
    flex: 1;
}

.reference-name {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.875rem;
    margin-bottom: 0.125rem;
}

.reference-use {
    color: var(--text-muted);
    font-size: 0.75rem;
}

/* Buttons */
.btn {
    width: 100%;
    padding: 1.125rem 1.5rem;
    border-radius: 1rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    text-decoration: none;
}

.btn--primary {
    background: var(--gradient-main);
    color: white;
}

.btn--primary:active {
    transform: scale(0.98);
    opacity: 0.9;
}

.btn--secondary {
    background: rgba(30, 41, 59, 0.6);
    color: var(--text-secondary);
    border: 1px solid var(--border-softer);
}

.btn--secondary:active {
    background: rgba(30, 41, 59, 0.8);
    transform: scale(0.98);
}

.btn--save {
    background: var(--gradient-subtle);
    color: var(--text-teal-light);
    border: 1px solid rgba(14, 116, 144, 0.3);
    padding: 0.875rem 1.5rem;
    border-radius: 2rem;
    font-weight: 600;
    font-size: 0.875rem;
}

.btn--save:active {
    background: rgba(14, 116, 144, 0.2);
}

.btn--save.saved {
    background: var(--success-bg);
    color: var(--success-emerald);
    border-color: rgba(74, 222, 128, 0.3);
}

.btn-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1.5rem;
}

.save-feedback {
    color: var(--success-emerald);
    font-size: 0.875rem;
    text-align: center;
    margin-top: 0.875rem;
    display: none;
}

.save-feedback.show {
    display: block;
    animation: slideDown 0.3s ease-out;
}

/* Practice Button */
.practice-section {
    text-align: center;
    margin: 1.25rem 0;
}

.practice-btn {
    background: var(--success-bg);
    color: var(--success-emerald);
    border: 1px solid rgba(74, 222, 128, 0.3);
    padding: 0.875rem 2rem;
    border-radius: 2rem;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.625rem;
}

.practice-btn:active {
    background: rgba(34, 197, 94, 0.2);
    transform: scale(0.97);
}

.practice-btn.marked {
    background: rgba(34, 197, 94, 0.25);
}

/* Footer */
.footer {
    margin-top: auto;
    padding-top: 2rem;
    border-top: 1px solid var(--border-subtle);
    text-align: center;
}

.footer__warning {
    color: #fca5a5;
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 1rem;
}

.footer__resources {
    color: var(--text-muted);
    font-size: 0.8125rem;
    line-height: 1.8;
}

.footer__resources p {
    margin-bottom: 0.5rem;
}

/* Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.step-content {
    animation: fadeIn 0.3s ease-out;
}

/* Mobile Adjustments */
@media (max-width: 640px) {
    .reflection-grid {
        grid-template-columns: 1fr;
    }
    
    .btn-group {
        grid-template-columns: 1fr;
    }
    
    .practice-buttons {
        flex-direction: column;
    }
}

/* iOS Safe Area */
@supports (-webkit-touch-callout: none) {
    .container {
        height: -webkit-fill-available;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="app-wrapper">
        <div class="bg-blur-1"></div>
        <div class="bg-blur-2"></div>
        <div class="main-content" id="mainContent">
            <div class="content-wrapper" id="content">
                <!-- Content will be rendered here by JavaScript -->
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    'use strict';
    
    // Check disclaimer acknowledgment
    const acknowledged = localStorage.getItem('crisis_disclaimer_acknowledged');
    if (!acknowledged) {
        window.location.href = 'crisis-intro.html';
        return;
    }

    // State
    let currentStep = 1;
    const totalSteps = 9;
    let userData = {
        coldWaterBefore: 5,
        coldWaterAfter: 5,
        energyBefore: 5,
        energyAfter: 5,
        clarityAfter: 5,
        tensionBefore: 5,
        tensionAfter: 5,
        pmrBefore: 5,
        pmrAfter: 5,
        selectedTechniques: []
    };
    
    // Step titles
    const stepTitles = {
        1: 'Introduction',
        2: 'Cold Water ‚Äî The Dive Reflex',
        3: 'Cold Water Practice',
        4: 'Intense Exercise',
        5: 'Paced Breathing',
        6: 'Progressive Muscle Relaxation',
        7: 'Temperature Shock',
        8: 'Your Top Techniques',
        9: 'Module Complete!'
    };
    
    // Storage helpers
    function saveProgress() {
        try {
            const data = {
                step: currentStep,
                userData: userData,
                timestamp: Date.now()
            };
            localStorage.setItem('crisis_module2_progress', JSON.stringify(data));
            return true;
        } catch (e) {
            console.error('Save failed:', e);
            return false;
        }
    }
    
    function loadProgress() {
        try {
            const saved = localStorage.getItem('crisis_module2_progress');
            if (saved) {
                const data = JSON.parse(saved);
                if (Date.now() - data.timestamp < 24 * 60 * 60 * 1000) {
                    currentStep = data.step;
                    userData = data.userData;
                    return true;
                }
            }
        } catch (e) {
            console.error('Load failed:', e);
        }
        return false;
    }
    
    function saveToCrisisPlan(key, value) {
        try {
            let plan = JSON.parse(localStorage.getItem('crisis_plan') || '{}');
            plan[key] = value;
            plan.lastUpdated = new Date().toISOString();
            localStorage.setItem('crisis_plan', JSON.stringify(plan));
            return true;
        } catch (e) {
            console.error('Save to crisis plan failed:', e);
            return false;
        }
    }
    
    function saveToToolkit(item) {
        try {
            let toolkit = JSON.parse(localStorage.getItem('crisis_toolkit') || '[]');
            toolkit = toolkit.filter(t => t.id !== item.id);
            toolkit.push({
                ...item,
                date: new Date().toISOString()
            });
            localStorage.setItem('crisis_toolkit', JSON.stringify(toolkit));
            return true;
        } catch (e) {
            console.error('Save to toolkit failed:', e);
            return false;
        }
    }
    
    // Navigation
    function scrollToTop() {
        const mainContent = document.getElementById('mainContent');
        if (mainContent) {
            mainContent.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
    }
    
    function goToStep(step) {
        if (step < 1 || step > totalSteps) return;
        currentStep = step;
        saveProgress();
        render();
        scrollToTop();
    }
    
    function nextStep() {
        if (currentStep < totalSteps) {
            goToStep(currentStep + 1);
        }
    }
    
    function previousStep() {
        if (currentStep > 1) {
            goToStep(currentStep - 1);
        } else {
            window.location.href = 'crisis-module-1.html';
        }
    }
    
    // Update progress
    let progress = JSON.parse(localStorage.getItem('crisis_course_progress') || '{}');
    progress.currentModule = 2;
    progress.lastAccessed = new Date().toISOString();
    localStorage.setItem('crisis_course_progress', JSON.stringify(progress));
    
    // Render functions
    function renderHeader(showCrisis = false) {
        return `
            ${showCrisis ? `
            <div class="crisis-banner">
                <span class="crisis-banner__text">üö® In crisis? Help is available 24/7</span>
                <div class="crisis-banner__actions">
                    <a href="tel:988" class="crisis-banner__link">Call 988</a>
                    <a href="sms:988" class="crisis-banner__link">Text 988</a>
                </div>
            </div>
            ` : ''}
            
            <div class="header">
                <div class="header__top">
                    <button class="back-btn" onclick="previousStep()">‚Üê</button>
                    <span class="step-indicator">${currentStep} / ${totalSteps}</span>
                </div>
                <div class="progress-dots">
                    ${Array(totalSteps).fill(0).map((_, i) => 
                        `<div class="progress-dot ${i < currentStep ? 'active' : ''}"></div>`
                    ).join('')}
                </div>
                <h1 class="step-title">${stepTitles[currentStep]}</h1>
                <p class="step-subtitle">Module 2: Physical Reset ‚Äî Body to Brain</p>
            </div>
        `;
    }
    
    function renderFooter() {
        return `
            <div class="footer">
                <p class="footer__warning">‚ö†Ô∏è EDUCATIONAL ONLY ‚Äî NOT THERAPY</p>
                <div class="footer__resources">
                    <p>988 Suicide & Crisis Lifeline: Call or text 988</p>
                    <p>Crisis Text Line: Text HOME to 741741</p>
                </div>
            </div>
        `;
    }
    
    function renderStep1() {
        return `
            <div class="step-content">
                ${renderHeader(true)}
                
                <div class="card">
                    <div class="card__icon">üîÑ</div>
                    <div class="card__content">
                        <p style="font-size: 1.05rem; color: var(--text-teal-light); font-style: italic;">
                            "Your body has hardwired responses that can override your emotional state. These aren't distractions ‚Äî they're biological circuit breakers. When your alarm system is screaming, you need to speak its language: physical sensation."
                        </p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card__title">
                        <span>üí°</span>
                        <span>Why Physical Reset Works</span>
                    </div>
                    <div class="card__content">
                        <p>Remember from Module 1: when you're in crisis, your <strong>thinking brain is offline</strong>.</p>
                        
                        <p>These techniques work because they:</p>
                        
                        <p><strong>1. Bypass your thinking brain entirely</strong><br>
                        They trigger automatic nervous system responses</p>
                        
                        <p><strong>2. Metabolize stress chemicals</strong><br>
                        Burn through the adrenaline and cortisol flooding your system</p>
                        
                        <p><strong>3. Give you something to DO</strong><br>
                        Action urges need an outlet ‚Äî these provide safe ones</p>
                    </div>
                </div>
                
                <button class="btn btn--primary" onclick="nextStep()">
                    <span>Continue</span>
                    <span>‚Üí</span>
                </button>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep2() {
        setTimeout(() => {
            initColdWaterSave();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üßä</span>
                        <span class="section-title-text">Cold Water ‚Äî The Dive Reflex</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "When cold water hits your face, especially around your eyes and nose, it triggers the <strong>mammalian dive reflex</strong> ‚Äî the same response that lets seals dive deep. Your heart rate automatically slows. This isn't willpower; it's a hardwired reflex that's been around for millions of years."
                        </p>
                    </div>
                    
                    <div class="technique-stats">
                        <div class="stat">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">‚ö° 30-60 sec</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best for</div>
                            <div class="stat-value">üéØ Hyperarousal</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Intensity</div>
                            <div class="stat-value">üí™ High</div>
                        </div>
                    </div>
                    
                    <div class="instruction-box">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.75rem;">How To Do It:</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.5rem;">Method 1: Ice Water Face Dunk</p>
                        <ul class="instruction-list" style="margin-bottom: 1rem;">
                            <li>Fill bowl with ice water</li>
                            <li>Hold breath</li>
                            <li>Dunk face for 15-30 seconds</li>
                            <li>Come up, breathe normally</li>
                            <li>Repeat 2-3 times if needed</li>
                        </ul>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.5rem;">Method 2: Ice Pack on Face</p>
                        <ul class="instruction-list" style="margin-bottom: 1rem;">
                            <li>Wrap ice pack in thin towel</li>
                            <li>Hold on eyes and cheeks for 30 seconds</li>
                            <li>Breathe slowly</li>
                            <li>Repeat as needed</li>
                        </ul>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.5rem;">Method 3: Cold Shower</p>
                        <ul class="instruction-list">
                            <li>Turn water to cold</li>
                            <li>Let it hit face and chest</li>
                            <li>Stay for 1-2 minutes</li>
                        </ul>
                    </div>
                    
                    <div class="safety-note">
                        <strong>‚ö†Ô∏è Safety Notes:</strong> Don't do this if you have heart conditions. Don't hold breath for more than 30 seconds. If you feel dizzy, stop.
                    </div>
                </div>
                
                <button id="saveColdWaterBtn" class="btn btn--save">
                    <span>üßä</span> Save Cold Water to Toolkit
                </button>
                <div id="coldWaterSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Try It Now</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep3() {
        setTimeout(() => {
            initColdWaterPractice();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card card--highlight">
                    <div class="card__icon">üßä</div>
                    <div class="card__title">Let's Try Cold Water</div>
                    <div class="card__content">
                        <p>This is <strong>optional</strong> ‚Äî you can skip if you don't have supplies or aren't ready. But practicing now helps your brain remember this tool when you actually need it.</p>
                    </div>
                </div>
                
                <div class="practice-card" id="coldWaterPractice">
                    <div class="practice-title">
                        <span>üßä</span>
                        PRACTICE NOW
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Do you have access to:</p>
                        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem;">
                            <label class="reflection-checkbox" style="flex: 1;">
                                <input type="checkbox" id="iceBowl"> Ice and bowl
                            </label>
                            <label class="reflection-checkbox" style="flex: 1;">
                                <input type="checkbox" id="icePack"> Ice pack
                            </label>
                            <label class="reflection-checkbox" style="flex: 1;">
                                <input type="checkbox" id="coldSink"> Cold water
                            </label>
                        </div>
                    </div>
                    
                    <div class="practice-buttons">
                        <button id="coldWaterGuideBtn" class="btn-practice btn-practice-primary">Yes - Guide Me</button>
                        <button id="coldWaterSkipBtn" class="btn-practice btn-practice-secondary">Skip for Now</button>
                    </div>
                    
                    <div id="coldWaterGuided" style="display: none; margin-top: 1.5rem;">
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            <strong>Step 1:</strong> Rate your current intensity (0-10)
                        </p>
                        <input type="range" id="coldWaterBeforeSlider" min="0" max="10" value="5" step="1" style="width: 100%; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                            <span style="color: var(--text-muted); font-size: 0.75rem;">0 - Calm</span>
                            <span style="color: var(--text-teal); font-weight: 700;" id="coldWaterBeforeValue">5</span>
                            <span style="color: var(--text-muted); font-size: 0.75rem;">10 - Overwhelming</span>
                        </div>
                        
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            <strong>Step 2:</strong> Get your cold water ready. We'll wait.
                        </p>
                        
                        <button id="coldWaterReadyBtn" class="btn-practice btn-practice-primary" style="margin-bottom: 1rem;">Ready! ‚Üí</button>
                        
                        <div id="coldWaterTimer" style="display: none;">
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                <strong>Step 3:</strong> Take a normal breath in. Hold it. Dunk your face or apply ice pack for 15 seconds.
                            </p>
                            <div class="timer-container">
                                <div class="timer-display" id="coldWaterTimerDisplay">15</div>
                                <button id="coldWaterStartTimer" class="btn-practice btn-practice-primary">Start Timer</button>
                            </div>
                        </div>
                        
                        <div id="coldWaterAfter" style="display: none; margin-top: 1.5rem;">
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                <strong>Step 4:</strong> How do you feel NOW? Rate your intensity (0-10)
                            </p>
                            <input type="range" id="coldWaterAfterSlider" min="0" max="10" value="5" step="1" style="width: 100%; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                                <span style="color: var(--text-muted); font-size: 0.75rem;">0 - Calm</span>
                                <span style="color: var(--text-teal); font-weight: 700;" id="coldWaterAfterValue">5</span>
                                <span style="color: var(--text-muted); font-size: 0.75rem;">10 - Overwhelming</span>
                            </div>
                            
                            <div id="coldWaterResult" style="background: rgba(14,116,144,0.15); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; min-height: 80px; display: flex; align-items: center; justify-content: center;">
                                <p style="color: var(--text-muted); font-style: italic;">Adjust the slider above to see your result</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep4() {
        setTimeout(() => {
            initExercise();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üí™</span>
                        <span class="section-title-text">Intense Exercise</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "When you're flooded with stress hormones (adrenaline, cortisol), your body is literally primed for physical action. Intense exercise <strong>metabolizes these chemicals</strong> ‚Äî you burn through the fuel of panic. This is why pacing, running, or intense movement can shift your state."
                        </p>
                    </div>
                    
                    <div class="technique-stats">
                        <div class="stat">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">‚ö° 3-5 min</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best for</div>
                            <div class="stat-value">üéØ Restless panic, rage</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Intensity</div>
                            <div class="stat-value">üí™ High</div>
                        </div>
                    </div>
                    
                    <div class="instruction-box">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.75rem;">How To Do It:</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 0.75rem 0 0.25rem;">Option 1: Sprint/Run</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Run as fast as you can for 1-2 minutes, walk 1 minute, repeat 3-5 times</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 0.75rem 0 0.25rem;">Option 2: Jumping Jacks</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Do 50-100 jumping jacks as fast as possible, rest 30 seconds, repeat 3 times</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 0.75rem 0 0.25rem;">Option 3: Stair Sprints</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Run up stairs, walk down, repeat 5-10 times</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 0.75rem 0 0.25rem;">Option 4: Wall Sits or Planks</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">Hold wall sit for 60 seconds, rest 30 seconds, repeat 3 times</p>
                    </div>
                    
                    <p style="color: var(--text-teal); font-size: 0.875rem; font-weight: 600; margin: 0.75rem 0;">
                        The Key: It needs to be intense enough that you can't think about anything else. You should be breathing hard.
                    </p>
                </div>
                
                <button id="saveExerciseBtn" class="btn btn--save">
                    <span>üí™</span> Save Intense Exercise to Toolkit
                </button>
                <div id="exerciseSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep5() {
        setTimeout(() => {
            initBreathing();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üå¨Ô∏è</span>
                        <span class="section-title-text">Paced Breathing</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "Your heart rate and breathing are connected through your autonomic nervous system. When you breathe in, your heart speeds up slightly. When you breathe out, it slows down. By making your <strong>exhales longer than your inhales</strong>, you activate your body's natural calming system."
                        </p>
                    </div>
                    
                    <div class="technique-stats">
                        <div class="stat">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">‚ö° 2-3 min</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best for</div>
                            <div class="stat-value">üéØ Moderate anxiety</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Intensity</div>
                            <div class="stat-value">üí™ Low</div>
                        </div>
                    </div>
                    
                    <div class="instruction-box">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.75rem;">How To Do It:</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 0.75rem 0 0.25rem;">The 4-6-8 Pattern (recommended)</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">Breathe IN for 4 seconds ‚Üí HOLD for 6 seconds ‚Üí Breathe OUT for 8 seconds</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.25rem;">Box Breathing</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">IN for 4 ‚Üí HOLD for 4 ‚Üí OUT for 4 ‚Üí HOLD for 4</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.25rem;">4-7-8 (sleep-focused)</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">IN for 4 ‚Üí HOLD for 7 ‚Üí OUT for 8</p>
                    </div>
                    
                    <p style="color: var(--text-teal); font-size: 0.875rem; font-weight: 600; margin: 0.75rem 0;">
                        Key Principle: Exhale should be longer than inhale.
                    </p>
                    
                    <div class="safety-note" style="margin-top: 1rem;">
                        <strong>‚ö†Ô∏è Note:</strong> Some people feel MORE anxious focusing on breath. If that's you, skip this and use other tools.
                    </div>
                </div>
                
                <button id="saveBreathingBtn" class="btn btn--save">
                    <span>üå¨Ô∏è</span> Save Paced Breathing to Toolkit
                </button>
                <div id="breathingSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep6() {
        setTimeout(() => {
            initPMR();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üå¨Ô∏è</span>
                        <span class="section-title-text">Paced Breathing</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "Your heart rate and breathing are connected through your autonomic nervous system. When you breathe in, your heart speeds up slightly. When you breathe out, it slows down. By making your <strong>exhales longer than your inhales</strong>, you activate your body's natural calming system."
                        </p>
                    </div>
                    
                    <div class="technique-stats">
                        <div class="stat">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">‚ö° 2-3 min</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best for</div>
                            <div class="stat-value">üéØ Moderate anxiety</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Intensity</div>
                            <div class="stat-value">üí™ Low</div>
                        </div>
                    </div>
                    
                    <div class="instruction-box">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.75rem;">How To Do It:</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 0.75rem 0 0.25rem;">The 4-6-8 Pattern (recommended)</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">Breathe IN for 4 seconds ‚Üí HOLD for 6 seconds ‚Üí Breathe OUT for 8 seconds</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.25rem;">Box Breathing</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">IN for 4 ‚Üí HOLD for 4 ‚Üí OUT for 4 ‚Üí HOLD for 4</p>
                        
                        <p style="color: var(--text-teal-light); font-weight: 600; margin: 1rem 0 0.25rem;">4-7-8 (sleep-focused)</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">IN for 4 ‚Üí HOLD for 7 ‚Üí OUT for 8</p>
                    </div>
                    
                    <p style="color: var(--text-teal); font-size: 0.875rem; font-weight: 600; margin: 0.75rem 0;">
                        Key Principle: Exhale should be longer than inhale.
                    </p>
                    
                    <div class="safety-note" style="margin-top: 1rem;">
                        <strong>‚ö†Ô∏è Note:</strong> Some people feel MORE anxious focusing on breath. If that's you, skip this and use other tools.
                    </div>
                </div>
                
                <div class="card" style="margin-top: 2rem;">
                    <div class="section-header">
                        <span class="section-icon">üíÜ</span>
                        <span class="section-title-text">Progressive Muscle Relaxation</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "You can't be physically tense and mentally relaxed at the same time. PMR works by deliberately tensing then releasing muscle groups, which teaches your body what 'relaxed' actually feels like. Many people hold chronic tension without realizing it."
                        </p>
                    </div>
                    
                    <div class="technique-stats">
                        <div class="stat">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">‚ö° 5-10 min</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best for</div>
                            <div class="stat-value">üéØ Physical tension</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Intensity</div>
                            <div class="stat-value">üí™ Low</div>
                        </div>
                    </div>
                    
                    <div class="instruction-box">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.75rem;">Quick Version (2 minutes):</p>
                        <ul class="instruction-list">
                            <li>Hands: Clench fists tight for 5 seconds, release</li>
                            <li>Arms: Tense biceps, release</li>
                            <li>Shoulders: Pull shoulders to ears, release</li>
                            <li>Face: Scrunch face tight, release</li>
                            <li>Legs: Point toes and tense legs, release</li>
                        </ul>
                    </div>
                </div>
                
                <button id="saveBreathingBtn" class="btn btn--save">
                    <span>üå¨Ô∏è</span> Save Paced Breathing to Toolkit
                </button>
                <div id="breathingSaveFeedback" class="save-feedback"></div>
                
                <button id="savePMRBtn" class="btn btn--save" style="margin-top: 1rem;">
                    <span>üíÜ</span> Save PMR to Toolkit
                </button>
                <div id="pmrSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep6() {
        setTimeout(() => {
            initPMR();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üíÜ</span>
                        <span class="section-title-text">Progressive Muscle Relaxation</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "You can't be physically tense and mentally relaxed at the same time. PMR works by deliberately tensing then releasing muscle groups, which teaches your body what 'relaxed' actually feels like. Many people hold chronic tension without realizing it."
                        </p>
                    </div>
                    
                    <div class="technique-stats">
                        <div class="stat">
                            <div class="stat-label">Speed</div>
                            <div class="stat-value">‚ö° 5-10 min</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best for</div>
                            <div class="stat-value">üéØ Physical tension</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Intensity</div>
                            <div class="stat-value">üí™ Low</div>
                        </div>
                    </div>
                    
                    <div class="instruction-box">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.75rem;">Quick Version (2 minutes):</p>
                        <ul class="instruction-list">
                            <li>Hands: Clench fists tight for 5 seconds, release</li>
                            <li>Arms: Tense biceps, release</li>
                            <li>Shoulders: Pull shoulders to ears, release</li>
                            <li>Face: Scrunch face tight, release</li>
                            <li>Legs: Point toes and tense legs, release</li>
                        </ul>
                    </div>
                </div>
                
                <button id="savePMRBtn" class="btn btn--save">
                    <span>üíÜ</span> Save PMR to Toolkit
                </button>
                <div id="pmrSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep7() {
        setTimeout(() => {
            initTemperature();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üî•</span>
                        <span class="section-title-text">Temperature Shock</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "Extreme temperature changes create immediate physical sensations that can interrupt emotional overwhelm. Your brain has limited processing capacity ‚Äî intense physical sensation takes up 'bandwidth' that would otherwise spiral into panic."
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0;">
                        <div style="background: rgba(14,116,144,0.1); padding: 1rem; border-radius: 0.75rem;">
                            <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.5rem;">‚ùÑÔ∏è Cold</p>
                            <ul style="color: var(--text-secondary); font-size: 0.8125rem; list-style-position: inside;">
                                <li>Ice cubes in hands</li>
                                <li>Cold shower</li>
                                <li>Walk outside in cold</li>
                            </ul>
                        </div>
                        <div style="background: rgba(217,119,6,0.1); padding: 1rem; border-radius: 0.75rem;">
                            <p style="color: var(--text-amber); font-weight: 700; margin-bottom: 0.5rem;">üî• Heat</p>
                            <ul style="color: var(--text-secondary); font-size: 0.8125rem; list-style-position: inside;">
                                <li>Very hot (not burning) shower</li>
                                <li>Heating pad on chest</li>
                                <li>Hands under hot water</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="background: rgba(14,116,144,0.1); padding: 1rem; border-radius: 0.75rem; margin-bottom: 0.5rem;">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.25rem;">When to Use:</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">‚Ä¢ When numb/dissociated (temperature brings you back to body)</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">‚Ä¢ When emotionally overwhelmed</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">‚Ä¢ When physical pain urges arise (this is a safe intense sensation)</p>
                    </div>
                    
                    <div class="safety-note">
                        <strong>‚ö†Ô∏è Important:</strong> This is about sensation, not harm. Don't use temperatures that cause injury.
                    </div>
                </div>
                
                <button id="saveTempBtn" class="btn btn--save">
                    <span>üå°Ô∏è</span> Save Temperature Techniques to Toolkit
                </button>
                <div id="tempSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep7() {
        setTimeout(() => {
            initTemperature();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card">
                    <div class="section-header">
                        <span class="section-icon">üî•</span>
                        <span class="section-title-text">Temperature Shock</span>
                    </div>
                    
                    <div class="card__content">
                        <p>
                            "Extreme temperature changes create immediate physical sensations that can interrupt emotional overwhelm. Your brain has limited processing capacity ‚Äî intense physical sensation takes up 'bandwidth' that would otherwise spiral into panic."
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0;">
                        <div style="background: rgba(14,116,144,0.1); padding: 1rem; border-radius: 0.75rem;">
                            <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.5rem;">‚ùÑÔ∏è Cold</p>
                            <ul style="color: var(--text-secondary); font-size: 0.8125rem; list-style-position: inside;">
                                <li>Ice cubes in hands</li>
                                <li>Cold shower</li>
                                <li>Walk outside in cold</li>
                            </ul>
                        </div>
                        <div style="background: rgba(217,119,6,0.1); padding: 1rem; border-radius: 0.75rem;">
                            <p style="color: var(--text-amber); font-weight: 700; margin-bottom: 0.5rem;">üî• Heat</p>
                            <ul style="color: var(--text-secondary); font-size: 0.8125rem; list-style-position: inside;">
                                <li>Very hot (not burning) shower</li>
                                <li>Heating pad on chest</li>
                                <li>Hands under hot water</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="background: rgba(14,116,144,0.1); padding: 1rem; border-radius: 0.75rem; margin-bottom: 0.5rem;">
                        <p style="color: var(--text-teal); font-weight: 700; margin-bottom: 0.25rem;">When to Use:</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">‚Ä¢ When numb/dissociated (temperature brings you back to body)</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">‚Ä¢ When emotionally overwhelmed</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">‚Ä¢ When physical pain urges arise (this is a safe intense sensation)</p>
                    </div>
                    
                    <div class="safety-note">
                        <strong>‚ö†Ô∏è Important:</strong> This is about sensation, not harm. Don't use temperatures that cause injury.
                    </div>
                </div>
                
                <button id="saveTempBtn" class="btn btn--save">
                    <span>üå°Ô∏è</span> Save Temperature Techniques to Toolkit
                </button>
                <div id="tempSaveFeedback" class="save-feedback"></div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep8() {
        setTimeout(() => {
            initReflection();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="reference-card">
                    <div class="reference-title">
                        <span>üö®</span>
                        PHYSICAL RESET TOOLS ‚Äî Quick Reference
                    </div>
                    
                    <div class="reference-grid">
                        <div class="reference-item">
                            <span class="reference-icon">üßä</span>
                            <div class="reference-content">
                                <div class="reference-name">Cold Water</div>
                                <div class="reference-use">30 sec ‚Ä¢ Panic, rage, instant calm</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üí™</span>
                            <div class="reference-content">
                                <div class="reference-name">Intense Exercise</div>
                                <div class="reference-use">5 min ‚Ä¢ Restless energy, want to explode</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üå¨Ô∏è</span>
                            <div class="reference-content">
                                <div class="reference-name">Paced Breathing</div>
                                <div class="reference-use">3 min ‚Ä¢ Moderate anxiety, racing thoughts</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üíÜ</span>
                            <div class="reference-content">
                                <div class="reference-name">Muscle Relaxation</div>
                                <div class="reference-use">2-10 min ‚Ä¢ Physical tension, mild anxiety</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üå°Ô∏è</span>
                            <div class="reference-content">
                                <div class="reference-name">Temperature Shock</div>
                                <div class="reference-use">1-2 min ‚Ä¢ Numbness, dissociation</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-softer);">
                        <p style="color: var(--text-primary); font-weight: 700; margin-bottom: 1rem;">
                            "Which 2-3 techniques felt most accessible to you?"
                        </p>
                        
                        <div class="reflection-grid" id="techniqueCheckboxes">
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Cold Water"> Cold water
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Intense Exercise"> Intense exercise
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Paced Breathing"> Paced breathing
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Muscle Relaxation"> Muscle relaxation
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Temperature Shock"> Temperature shock
                            </label>
                        </div>
                        
                        <div style="background: rgba(217,119,6,0.1); padding: 1.25rem; border-radius: 0.75rem; margin-top: 1.5rem;">
                            <p style="color: var(--text-amber-light); font-weight: 600; margin-bottom: 1rem; text-align: center;">
                                "Crisis skills only work if you practice when calm. Will you commit to practicing your top 2 techniques this week?"
                            </p>
                            <div style="display: flex; gap: 0.75rem;">
                                <button id="commitYesBtn" class="btn-practice btn-practice-primary" style="flex: 1;">Yes, I Commit</button>
                                <button id="commitLaterBtn" class="btn-practice btn-practice-secondary" style="flex: 1;">Maybe Later</button>
                            </div>
                        </div>
                    </div>
                    
                    <button id="saveReflectionBtn" class="btn btn--save" style="margin-top: 1.5rem;">
                        <span>üìã</span> Save My Top Techniques to Toolkit
                    </button>
                    <div id="reflectionSaveFeedback" class="save-feedback"></div>
                </div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep8() {
        setTimeout(() => {
            initReflection();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="reference-card">
                    <div class="reference-title">
                        <span>üö®</span>
                        PHYSICAL RESET TOOLS ‚Äî Quick Reference
                    </div>
                    
                    <div class="reference-grid">
                        <div class="reference-item">
                            <span class="reference-icon">üßä</span>
                            <div class="reference-content">
                                <div class="reference-name">Cold Water</div>
                                <div class="reference-use">30 sec ‚Ä¢ Panic, rage, instant calm</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üí™</span>
                            <div class="reference-content">
                                <div class="reference-name">Intense Exercise</div>
                                <div class="reference-use">5 min ‚Ä¢ Restless energy, want to explode</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üå¨Ô∏è</span>
                            <div class="reference-content">
                                <div class="reference-name">Paced Breathing</div>
                                <div class="reference-use">3 min ‚Ä¢ Moderate anxiety, racing thoughts</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üíÜ</span>
                            <div class="reference-content">
                                <div class="reference-name">Muscle Relaxation</div>
                                <div class="reference-use">2-10 min ‚Ä¢ Physical tension, mild anxiety</div>
                            </div>
                        </div>
                        <div class="reference-item">
                            <span class="reference-icon">üå°Ô∏è</span>
                            <div class="reference-content">
                                <div class="reference-name">Temperature Shock</div>
                                <div class="reference-use">1-2 min ‚Ä¢ Numbness, dissociation</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-softer);">
                        <p style="color: var(--text-primary); font-weight: 700; margin-bottom: 1rem;">
                            "Which 2-3 techniques felt most accessible to you?"
                        </p>
                        
                        <div class="reflection-grid" id="techniqueCheckboxes">
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Cold Water"> Cold water
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Intense Exercise"> Intense exercise
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Paced Breathing"> Paced breathing
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Muscle Relaxation"> Muscle relaxation
                            </label>
                            <label class="reflection-checkbox">
                                <input type="checkbox" value="Temperature Shock"> Temperature shock
                            </label>
                        </div>
                        
                        <div style="background: rgba(217,119,6,0.1); padding: 1.25rem; border-radius: 0.75rem; margin-top: 1.5rem;">
                            <p style="color: var(--text-amber-light); font-weight: 600; margin-bottom: 1rem; text-align: center;">
                                "Crisis skills only work if you practice when calm. Will you commit to practicing your top 2 techniques this week?"
                            </p>
                            <div style="display: flex; gap: 0.75rem;">
                                <button id="commitYesBtn" class="btn-practice btn-practice-primary" style="flex: 1;">Yes, I Commit</button>
                                <button id="commitLaterBtn" class="btn-practice btn-practice-secondary" style="flex: 1;">Maybe Later</button>
                            </div>
                        </div>
                    </div>
                    
                    <button id="saveReflectionBtn" class="btn btn--save" style="margin-top: 1.5rem;">
                        <span>üìã</span> Save My Top Techniques to Toolkit
                    </button>
                    <div id="reflectionSaveFeedback" class="save-feedback"></div>
                </div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <button class="btn btn--primary" onclick="nextStep()">
                        <span>Continue</span>
                        <span>‚Üí</span>
                    </button>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep9() {
        setTimeout(() => {
            initComplete();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card card--highlight">
                    <div class="card__icon">‚úÖ</div>
                    <div class="card__title">Module 2 Complete!</div>
                    <div class="card__content">
                        <p>You now have physical tools to reset your nervous system when your thinking brain is offline.</p>
                        
                        <p><strong>Next:</strong> Module 3 will teach you grounding and distraction techniques for when you need to shift your mental focus.</p>
                    </div>
                </div>
                
                <div class="practice-section">
                    <button id="practiceBtn" class="practice-btn">
                        <span>‚úì</span>
                        <span>Mark Module as Practiced</span>
                    </button>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <a href="crisis-module-3.html" class="btn btn--primary">
                        <span>Module 3</span>
                        <span>‚Üí</span>
                    </a>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    function renderStep9() {
        setTimeout(() => {
            initComplete();
        }, 100);
        
        return `
            <div class="step-content">
                ${renderHeader()}
                
                <div class="card card--highlight">
                    <div class="card__icon">‚úÖ</div>
                    <div class="card__title">Module 2 Complete!</div>
                    <div class="card__content">
                        <p>You now have physical tools to reset your nervous system when your thinking brain is offline.</p>
                        
                        <p><strong>Next:</strong> Module 3 will teach you grounding and distraction techniques for when you need to shift your mental focus.</p>
                    </div>
                </div>
                
                <div class="practice-section">
                    <button id="practiceBtn" class="practice-btn">
                        <span>‚úì</span>
                        <span>Mark Module as Practiced</span>
                    </button>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn--secondary" onclick="previousStep()">
                        <span>‚Üê</span>
                        <span>Back</span>
                    </button>
                    <a href="crisis-module-3.html" class="btn btn--primary">
                        <span>Module 3</span>
                        <span>‚Üí</span>
                    </a>
                </div>
                
                ${renderFooter()}
            </div>
        `;
    }
    
    // Main render
    function render() {
        const content = document.getElementById('content');
        
        let html = '';
        switch(currentStep) {
            case 1: html = renderStep1(); break;
            case 2: html = renderStep2(); break;
            case 3: html = renderStep3(); break;
            case 4: html = renderStep4(); break;
            case 5: html = renderStep5(); break;
            case 6: html = renderStep6(); break;
            case 7: html = renderStep7(); break;
            case 8: html = renderStep8(); break;
            case 9: html = renderStep9(); break;
            default: html = renderStep1();
        }
        
        content.innerHTML = html;
    }
    
    // Interactive functionality
    function initColdWaterSave() {
        const saveBtn = document.getElementById('saveColdWaterBtn');
        const feedback = document.getElementById('coldWaterSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'cold-water',
                    category: 'Module 2: Physical Reset',
                    name: 'Cold Water ‚Äî Dive Reflex',
                    description: '30-60 seconds ‚Ä¢ Panic, rage, need instant calm ‚Ä¢ Dunk face in ice water or apply ice pack for 15-30 seconds'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span><span>Saved!</span>';
                feedback.textContent = '‚úì Saved to your toolkit.';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üßä</span> Save Cold Water to Toolkit';
                    feedback.classList.remove('show');
                }, 3000);
            });
        }
    }
    
    function initColdWaterPractice() {
        const guideBtn = document.getElementById('coldWaterGuideBtn');
        const skipBtn = document.getElementById('coldWaterSkipBtn');
        const guided = document.getElementById('coldWaterGuided');
        const readyBtn = document.getElementById('coldWaterReadyBtn');
        const timerDiv = document.getElementById('coldWaterTimer');
        const startTimerBtn = document.getElementById('coldWaterStartTimer');
        const timerDisplay = document.getElementById('coldWaterTimerDisplay');
        const afterDiv = document.getElementById('coldWaterAfter');
        const resultDiv = document.getElementById('coldWaterResult');
        
        // Sliders
        const beforeSlider = document.getElementById('coldWaterBeforeSlider');
        const beforeValue = document.getElementById('coldWaterBeforeValue');
        const afterSlider = document.getElementById('coldWaterAfterSlider');
        const afterValue = document.getElementById('coldWaterAfterValue');
        
        if (beforeSlider && beforeValue) {
            beforeSlider.addEventListener('input', function() {
                beforeValue.textContent = this.value;
            });
        }
        
        if (afterSlider && afterValue) {
            afterSlider.addEventListener('input', function() {
                afterValue.textContent = this.value;
            });
        }
        
        if (guideBtn) {
            guideBtn.addEventListener('click', function() {
                guided.style.display = 'block';
                guideBtn.style.display = 'none';
                skipBtn.style.display = 'none';
            });
        }
        
        if (skipBtn) {
            skipBtn.addEventListener('click', function() {
                this.textContent = 'Skipped';
                this.disabled = true;
            });
        }
        
        if (readyBtn) {
            readyBtn.addEventListener('click', function() {
                timerDiv.style.display = 'block';
                readyBtn.style.display = 'none';
            });
        }
        
        if (startTimerBtn) {
            startTimerBtn.addEventListener('click', function() {
                let timeLeft = 15;
                timerDisplay.textContent = timeLeft;
                startTimerBtn.textContent = 'Timer Running...';
                startTimerBtn.disabled = true;
                startTimerBtn.style.opacity = '0.6';
                
                const interval = setInterval(function() {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        timerDisplay.textContent = 'Done!';
                        timerDisplay.style.color = 'var(--success-emerald)';
                        
                        // Add a completion message
                        const completionMsg = document.createElement('p');
                        completionMsg.style.cssText = 'color: var(--text-teal-light); margin-top: 1rem; text-align: center; font-weight: 600;';
                        completionMsg.textContent = '‚úì Great! Now take a moment and notice how you feel.';
                        timerDiv.querySelector('.timer-container').appendChild(completionMsg);
                        
                        setTimeout(() => {
                            timerDiv.style.display = 'none';
                            afterDiv.style.display = 'block';
                        }, 2000);
                    }
                }, 1000);
            });
        }
        
        // Handle the after rating and show results
        if (afterSlider) {
            afterSlider.addEventListener('change', function() {
                const before = parseInt(beforeSlider?.value || '5');
                const after = parseInt(this.value);
                const change = before - after;
                
                let message = '';
                if (change > 0) {
                    message = `<p style="color: var(--text-teal-light);"><strong>‚úì Your intensity dropped from ${before} to ${after}!</strong><br><br>That's the dive reflex working ‚Äî your heart rate slowed automatically. This is a hardwired biological response you can use anytime.</p>`;
                } else if (change < 0) {
                    message = `<p style="color: var(--text-secondary);">Your intensity went from ${before} to ${after}. Cold water doesn't work for everyone, or you might need a longer/colder application. That's okay ‚Äî you have 4 other techniques to try.</p>`;
                } else {
                    message = `<p style="color: var(--text-secondary);">You stayed at ${before}. Some people need more intense cold or longer duration. That's fine ‚Äî other techniques may work better for you.</p>`;
                }
                
                resultDiv.innerHTML = message;
            });
        }
        
        // Checkbox visual state
        const checkboxes = document.querySelectorAll('.reflection-checkbox input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                const label = this.closest('.reflection-checkbox');
                if (this.checked) {
                    label.classList.add('checked');
                } else {
                    label.classList.remove('checked');
                }
            });
        });
    }
    
    function initExercise() {
        const saveBtn = document.getElementById('saveExerciseBtn');
        const feedback = document.getElementById('exerciseSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'intense-exercise',
                    category: 'Module 2: Physical Reset',
                    name: 'Intense Exercise',
                    description: '3-5 minutes ‚Ä¢ Restless panic, rage, "crawling out of skin" ‚Ä¢ Sprint, jumping jacks, stairs ‚Äî must be intense enough to breathe hard'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span><span>Saved!</span>';
                feedback.textContent = '‚úì Saved to your toolkit.';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üí™</span> Save Intense Exercise to Toolkit';
                    feedback.classList.remove('show');
                }, 3000);
            });
        }
    }
    
    function initBreathing() {
        const saveBtn = document.getElementById('saveBreathingBtn');
        const feedback = document.getElementById('breathingSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'paced-breathing',
                    category: 'Module 2: Physical Reset',
                    name: 'Paced Breathing',
                    description: '2-3 minutes ‚Ä¢ Moderate anxiety, racing thoughts ‚Ä¢ 4-6-8 pattern: IN 4, HOLD 6, OUT 8 ‚Ä¢ Exhale longer than inhale'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span><span>Saved!</span>';
                feedback.textContent = '‚úì Saved to your toolkit.';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üå¨Ô∏è</span> Save Paced Breathing to Toolkit';
                    feedback.classList.remove('show');
                }, 3000);
            });
        }
    }
    
    function initPMR() {
        const saveBtn = document.getElementById('savePMRBtn');
        const feedback = document.getElementById('pmrSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'pmr',
                    category: 'Module 2: Physical Reset',
                    name: 'Progressive Muscle Relaxation',
                    description: '5-10 minutes ‚Ä¢ Physical tension, mild anxiety ‚Ä¢ Tense each muscle group 5 sec, release 10 sec ‚Ä¢ Hands, arms, shoulders, face, legs'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span><span>Saved!</span>';
                feedback.textContent = '‚úì Saved to your toolkit.';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üíÜ</span> Save PMR to Toolkit';
                    feedback.classList.remove('show');
                }, 3000);
            });
        }
    }
    
    function initTemperature() {
        const saveBtn = document.getElementById('saveTempBtn');
        const feedback = document.getElementById('tempSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'temperature',
                    category: 'Module 2: Physical Reset',
                    name: 'Temperature Shock',
                    description: '1-2 minutes ‚Ä¢ Numbness, dissociation, need to feel present ‚Ä¢ Cold: ice cubes, cold shower ‚Ä¢ Heat: hot shower, heating pad ‚Ä¢ Sensation, not harm'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span><span>Saved!</span>';
                feedback.textContent = '‚úì Saved to your toolkit.';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üå°Ô∏è</span> Save Temperature Techniques to Toolkit';
                    feedback.classList.remove('show');
                }, 3000);
            });
        }
    }
    
    function initReflection() {
        const checkboxes = document.querySelectorAll('.reflection-checkbox input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                const label = this.closest('.reflection-checkbox');
                if (this.checked) {
                    label.classList.add('checked');
                } else {
                    label.classList.remove('checked');
                }
            });
        });
        
        // Load saved techniques
        const crisisPlan = JSON.parse(localStorage.getItem('crisis_plan') || '{}');
        const savedTechniques = crisisPlan.physicalTechniques || [];
        
        if (savedTechniques.length > 0) {
            checkboxes.forEach(cb => {
                if (savedTechniques.includes(cb.value)) {
                    cb.checked = true;
                    const label = cb.closest('.reflection-checkbox');
                    label.classList.add('checked');
                }
            });
        }
        
        // Commit buttons
        const commitYesBtn = document.getElementById('commitYesBtn');
        const commitLaterBtn = document.getElementById('commitLaterBtn');
        
        if (commitYesBtn) {
            commitYesBtn.addEventListener('click', function() {
                this.textContent = '‚úì Committed!';
                this.style.background = 'var(--success-bg)';
                this.style.color = 'var(--success-emerald)';
                
                saveToCrisisPlan('practiceCommitment', {
                    committed: true,
                    date: new Date().toISOString(),
                    module: 2
                });
            });
        }
        
        if (commitLaterBtn) {
            commitLaterBtn.addEventListener('click', function() {
                this.textContent = 'Maybe Later';
                this.disabled = true;
            });
        }
        
        // Save reflection
        const saveBtn = document.getElementById('saveReflectionBtn');
        const feedback = document.getElementById('reflectionSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                const checkedBoxes = document.querySelectorAll('#techniqueCheckboxes input[type="checkbox"]:checked');
                const techniques = Array.from(checkedBoxes).map(cb => cb.value);
                
                if (techniques.length === 0) {
                    alert('Please select at least one technique.');
                    return;
                }
                
                saveToToolkit({
                    id: 'my-top-techniques',
                    category: 'My Crisis Profile',
                    name: 'My Top Physical Reset Techniques',
                    description: techniques.join(', ')
                });
                
                saveToCrisisPlan('physicalTechniques', techniques);
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span><span>Saved!</span>';
                feedback.textContent = '‚úì Your top techniques have been saved to your crisis plan.';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üìã</span> Save My Top Techniques to Toolkit';
                    feedback.classList.remove('show');
                }, 3000);
            });
        }
    }
    
    function initComplete() {
        const practiceBtn = document.getElementById('practiceBtn');
        
        let progress = JSON.parse(localStorage.getItem('crisis_course_progress') || '{}');
        if (progress.practicedModules && progress.practicedModules.includes('module2')) {
            practiceBtn.classList.add('marked');
            practiceBtn.innerHTML = '<span>‚úì</span><span>Module 2 Practiced</span>';
        }
        
        if (practiceBtn) {
            practiceBtn.addEventListener('click', function() {
                if (!progress.practicedModules) {
                    progress.practicedModules = [];
                }
                
                if (!progress.practicedModules.includes('module2')) {
                    progress.practicedModules.push('module2');
                    progress.lastPracticed = new Date().toISOString();
                    progress.currentModule = 2;
                    localStorage.setItem('crisis_course_progress', JSON.stringify(progress));
                    
                    practiceBtn.classList.add('marked');
                    practiceBtn.innerHTML = '<span>‚úì</span><span>Module 2 Practiced</span>';
                }
            });
        }
    }
    
    // Expose functions globally
    window.nextStep = nextStep;
    window.previousStep = previousStep;
    window.goToStep = goToStep;
    
    // Initialize
    loadProgress();
    render();
})();
</script>
</body>
</html>
