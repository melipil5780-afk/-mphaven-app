<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f172a">
<title>Module 2: Physical Reset ‚Äî Body to Brain</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #0f172a;
    color: rgb(241, 245, 249);
}

.container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

.app-wrapper {
    width: 100%;
    max-width: 28rem;
    height: 100%;
    margin: 0 auto;
    background: rgba(15, 23, 42, 0.98);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

.main-content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    position: relative;
    z-index: 1;
    padding: 1.25rem;
    padding-bottom: calc(2rem + env(safe-area-inset-bottom));
}

.main-content::-webkit-scrollbar {
    display: none;
}

/* Crisis Banner */
.crisis-banner {
    background: rgba(220, 38, 38, 0.08);
    border: 1px solid #dc2626;
    border-radius: 0.875rem;
    padding: 1rem 1.25rem;
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.crisis-text {
    color: #fca5a5;
    font-size: 0.875rem;
    font-weight: 600;
}

.crisis-actions {
    display: flex;
    gap: 0.625rem;
}

.crisis-link {
    color: white;
    background: #dc2626;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-size: 0.8125rem;
    font-weight: 700;
}

/* Header */
.header {
    background: linear-gradient(135deg, rgba(30,41,59,0.65), rgba(15,23,42,0.45));
    border: 1px solid rgba(51,65,85,0.4);
    border-radius: 1rem;
    padding: 1.25rem;
    margin-bottom: 1.25rem;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.back-btn {
    background: none;
    border: none;
    color: rgb(148,163,184);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.25rem;
}

.step-indicator {
    color: rgb(148,163,184);
    font-size: 0.875rem;
    font-weight: 600;
}

.progress-dots {
    display: flex;
    gap: 0.375rem;
    margin-bottom: 1rem;
}

.progress-dot {
    flex: 1;
    height: 0.5rem;
    background: rgba(148,163,184,0.2);
    border-radius: 1rem;
    transition: all 0.3s;
}

.progress-dot.active {
    background: linear-gradient(135deg, #0e7490, #d97706);
}

.step-title {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, #0e7490, #d97706);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
}

.step-subtitle {
    color: rgb(203,213,225);
    font-size: 0.9375rem;
}

/* Cards */
.card {
    background: linear-gradient(135deg, rgba(30,41,59,0.65), rgba(15,23,42,0.45));
    border: 1px solid rgba(51,65,85,0.4);
    border-radius: 1.25rem;
    padding: 1.5rem;
    margin-bottom: 1.25rem;
}

.card-highlight {
    background: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.1));
    border: 1px solid rgba(14,116,144,0.3);
}

.section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(51,65,85,0.4);
}

.section-icon {
    font-size: 1.75rem;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: rgb(165,243,252);
}

/* Stats */
.technique-stats {
    display: flex;
    gap: 1rem;
    margin: 1rem 0;
    padding: 1rem;
    background: rgba(15,23,42,0.6);
    border-radius: 0.75rem;
}

.stat {
    flex: 1;
    text-align: center;
}

.stat-label {
    color: rgb(148,163,184);
    font-size: 0.6875rem;
    text-transform: uppercase;
}

.stat-value {
    color: rgb(94,234,212);
    font-weight: 700;
    font-size: 1rem;
    margin-top: 0.25rem;
}

/* Instruction Box */
.instruction-box {
    background: rgba(15,23,42,0.6);
    border-left: 4px solid #0e7490;
    border-radius: 0.75rem;
    padding: 1.25rem;
    margin: 1.25rem 0;
}

.instruction-list {
    list-style: none;
    counter-reset: step;
}

.instruction-list li {
    counter-increment: step;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    color: rgb(203,213,225);
    font-size: 0.875rem;
}

.instruction-list li:before {
    content: counter(step);
    background: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.1));
    color: rgb(165,243,252);
    font-weight: 700;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    flex-shrink: 0;
}

/* Safety Note */
.safety-note {
    background: rgba(220,38,38,0.1);
    border-left: 4px solid #dc2626;
    padding: 1rem;
    border-radius: 0.75rem;
    margin: 1rem 0;
    font-size: 0.8125rem;
    color: #fca5a5;
}

/* Practice Card */
.practice-card {
    background: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.1));
    border: 2px solid rgba(14,116,144,0.3);
    border-radius: 1rem;
    padding: 1.5rem;
    margin: 1.25rem 0;
}

.practice-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgb(165,243,252);
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 1rem;
}

.practice-buttons {
    display: flex;
    gap: 0.75rem;
    margin: 1.25rem 0;
}

.btn-practice {
    flex: 1;
    padding: 0.875rem;
    border-radius: 0.75rem;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
}

.btn-practice-primary {
    background: linear-gradient(135deg, #0e7490, #d97706);
    color: white;
}

.btn-practice-secondary {
    background: rgba(15,23,42,0.45);
    color: rgb(203,213,225);
    border: 1px solid rgba(51,65,85,0.4);
}

/* Timer */
.timer-container {
    text-align: center;
    padding: 1.5rem;
    background: rgba(15,23,42,0.8);
    border-radius: 1rem;
    margin: 1rem 0;
}

.timer-display {
    font-size: 3rem;
    font-weight: 800;
    color: rgb(94,234,212);
    font-variant-numeric: tabular-nums;
    margin-bottom: 1rem;
}

.timer-phase {
    font-size: 1.25rem;
    color: rgb(165,243,252);
    margin-bottom: 0.5rem;
}

.timer-round {
    color: rgb(148,163,184);
    font-size: 0.875rem;
}

/* Sliders */
.slider-container {
    margin: 1.5rem 0;
}

.slider-label {
    display: flex;
    justify-content: space-between;
    color: rgb(203,213,225);
    margin-bottom: 0.5rem;
}

.slider {
    width: 100%;
    height: 0.5rem;
    -webkit-appearance: none;
    background: rgba(15,23,42,0.6);
    border-radius: 1rem;
    outline: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    background: linear-gradient(135deg, #0e7490, #d97706);
    border-radius: 50%;
    cursor: pointer;
}

.slider-value {
    color: rgb(94,234,212);
    font-weight: 700;
    font-size: 1rem;
}

.slider-labels {
    display: flex;
    justify-content: space-between;
    color: rgb(148,163,184);
    font-size: 0.75rem;
    margin-top: 0.25rem;
}

/* Checkboxes */
.reflection-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin: 1.25rem 0;
}

.reflection-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem;
    background: rgba(15,23,42,0.6);
    border: 1px solid rgba(51,65,85,0.4);
    border-radius: 0.75rem;
    cursor: pointer;
    color: rgb(203,213,225);
    font-size: 0.875rem;
    transition: all 0.2s;
}

.reflection-checkbox.checked {
    border-color: #0e7490;
    background: rgba(14,116,144,0.15);
    color: white;
}

.reflection-checkbox input {
    width: 1.125rem;
    height: 1.125rem;
    accent-color: #0e7490;
}

/* Buttons */
.btn {
    width: 100%;
    padding: 1rem;
    border-radius: 0.75rem;
    font-weight: 600;
    font-size: 0.9375rem;
    cursor: pointer;
    border: none;
    text-decoration: none;
    text-align: center;
    display: inline-block;
    transition: all 0.2s;
}

.btn-primary {
    background: linear-gradient(135deg, #0e7490, #d97706);
    color: white;
}

.btn-secondary {
    background: rgba(15,23,42,0.45);
    color: rgb(203,213,225);
    border: 1px solid rgba(51,65,85,0.4);
}

.btn-group {
    display: flex;
    gap: 1rem;
    margin: 2rem 0 1rem;
}

.btn-save {
    background: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.1));
    color: rgb(165,243,252);
    border: 1px solid rgba(14,116,144,0.3);
    padding: 0.875rem 1.5rem;
    border-radius: 2rem;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    width: 100%;
    margin-top: 1rem;
    transition: all 0.2s;
}

.btn-save.saved {
    background: rgba(34,197,94,0.12);
    color: rgb(74,222,128);
    border-color: rgba(74,222,128,0.3);
}

.save-feedback {
    color: rgb(74,222,128);
    font-size: 0.875rem;
    text-align: center;
    margin-top: 0.5rem;
    display: none;
}

.save-feedback.show {
    display: block;
    animation: fadeIn 0.3s;
}

/* Result Box */
.result-box {
    background: rgba(14,116,144,0.15);
    padding: 1rem;
    border-radius: 0.75rem;
    margin: 1rem 0;
    min-height: 5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgb(165,243,252);
}

/* Footer */
.footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(30,41,59,0.5);
    text-align: center;
}

.footer-warning {
    color: #fca5a5;
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 1rem;
}

.footer-resources {
    color: rgb(148,163,184);
    font-size: 0.8125rem;
    line-height: 1.6;
}

/* Utilities */
.hidden {
    display: none !important;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 640px) {
    .reflection-grid {
        grid-template-columns: 1fr;
    }
    .btn-group {
        flex-direction: column;
    }
    .practice-buttons {
        flex-direction: column;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="app-wrapper">
        <div class="main-content" id="mainContent">
            <div class="content-wrapper" id="content">
                <!-- Content rendered by JavaScript -->
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    // Check disclaimer
    if (!localStorage.getItem('crisis_disclaimer_acknowledged')) {
        window.location.href = 'crisis-intro.html';
        return;
    }

    // ===== STATE =====
    let currentStep = 1;
    const totalSteps = 9;
    
    // User data
    let userData = {
        coldBefore: 5,
        coldAfter: 5,
        energyBefore: 5,
        energyAfter: 5,
        clarityAfter: 5,
        tensionBefore: 5,
        tensionAfter: 5,
        pmrBefore: 5,
        pmrAfter: 5,
        selectedTechniques: []
    };

    // Step titles
    const stepTitles = {
        1: 'Introduction',
        2: 'Cold Water ‚Äî The Dive Reflex',
        3: 'Cold Water Practice',
        4: 'Intense Exercise',
        5: 'Intense Exercise Practice',
        6: 'Paced Breathing',
        7: 'Progressive Muscle Relaxation',
        8: 'Temperature + Your Top Techniques',
        9: 'Module Complete!'
    };

    // ===== STORAGE =====
    function saveProgress() {
        localStorage.setItem('crisis_module2_progress', JSON.stringify({
            step: currentStep,
            userData: userData,
            timestamp: Date.now()
        }));
    }

    function loadProgress() {
        const saved = localStorage.getItem('crisis_module2_progress');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                if (Date.now() - data.timestamp < 86400000) { // 24 hours
                    currentStep = data.step || 1;
                    userData = data.userData || userData;
                }
            } catch (e) {}
        }
    }

    function saveToToolkit(item) {
        let toolkit = JSON.parse(localStorage.getItem('crisis_toolkit') || '[]');
        toolkit = toolkit.filter(t => t.id !== item.id);
        toolkit.push({...item, date: new Date().toISOString()});
        localStorage.setItem('crisis_toolkit', JSON.stringify(toolkit));
    }

    function saveToCrisisPlan(key, value) {
        let plan = JSON.parse(localStorage.getItem('crisis_plan') || '{}');
        plan[key] = value;
        plan.lastUpdated = new Date().toISOString();
        localStorage.setItem('crisis_plan', JSON.stringify(plan));
    }

    // ===== NAVIGATION =====
    function scrollToTop() {
        document.getElementById('mainContent').scrollTo({ top: 0, behavior: 'smooth' });
    }

    function nextStep() {
        if (currentStep < totalSteps) {
            currentStep++;
            saveProgress();
            render();
            scrollToTop();
        }
    }

    function previousStep() {
        if (currentStep > 1) {
            currentStep--;
            saveProgress();
            render();
            scrollToTop();
        } else {
            window.location.href = 'crisis-module-1.html';
        }
    }

    function goToStep(step) {
        if (step >= 1 && step <= totalSteps) {
            currentStep = step;
            saveProgress();
            render();
            scrollToTop();
        }
    }

    // Make functions global
    window.nextStep = nextStep;
    window.previousStep = previousStep;
    window.goToStep = goToStep;

    // ===== RENDER FUNCTIONS =====
    function renderHeader() {
        return `
            <div class="crisis-banner">
                <span class="crisis-text">üö® In crisis? Help is available 24/7</span>
                <div class="crisis-actions">
                    <a href="tel:988" class="crisis-link">Call 988</a>
                    <a href="sms:988" class="crisis-link">Text 988</a>
                </div>
            </div>
            
            <div class="header">
                <div class="header-top">
                    <button class="back-btn" onclick="previousStep()">‚Üê</button>
                    <span class="step-indicator">${currentStep} / ${totalSteps}</span>
                </div>
                <div class="progress-dots">
                    ${Array(totalSteps).fill(0).map((_, i) => 
                        `<div class="progress-dot ${i < currentStep ? 'active' : ''}"></div>`
                    ).join('')}
                </div>
                <h1 class="step-title">${stepTitles[currentStep]}</h1>
                <p class="step-subtitle">Module 2: Physical Reset ‚Äî Body to Brain</p>
            </div>
        `;
    }

    function renderFooter() {
        return `
            <div class="footer">
                <p class="footer-warning">‚ö†Ô∏è EDUCATIONAL ONLY ‚Äî NOT THERAPY</p>
                <div class="footer-resources">
                    <p>988 Suicide & Crisis Lifeline: Call or text 988</p>
                    <p>Crisis Text Line: Text HOME to 741741</p>
                </div>
            </div>
        `;
    }

    // STEP 1: Introduction
    function renderStep1() {
        return `
            ${renderHeader()}
            
            <div class="card">
                <div class="card-highlight" style="padding: 1.5rem; border-radius: 1.25rem;">
                    <p style="font-size: 1.05rem; color: rgb(165,243,252); font-style: italic; margin: 0;">
                        "Your body has hardwired responses that can override your emotional state. These aren't distractions ‚Äî they're biological circuit breakers. When your alarm system is screaming, you need to speak its language: physical sensation."
                    </p>
                </div>
            </div>
            
            <div class="card">
                <div class="section-header">
                    <span class="section-icon">üí°</span>
                    <span class="section-title">Why Physical Reset Works</span>
                </div>
                <div style="color: rgb(203,213,225); line-height: 1.7;">
                    <p style="margin-bottom: 1rem;">Remember from Module 1: when you're in crisis, your <strong style="color: rgb(94,234,212);">thinking brain is offline</strong>.</p>
                    
                    <p style="margin-bottom: 1rem;">These techniques work because they:</p>
                    
                    <p style="margin-bottom: 1rem;"><strong style="color: rgb(94,234,212);">1. Bypass your thinking brain entirely</strong><br>
                    They trigger automatic nervous system responses</p>
                    
                    <p style="margin-bottom: 1rem;"><strong style="color: rgb(94,234,212);">2. Metabolize stress chemicals</strong><br>
                    Burn through the adrenaline and cortisol flooding your system</p>
                    
                    <p><strong style="color: rgb(94,234,212);">3. Give you something to DO</strong><br>
                    Action urges need an outlet ‚Äî these provide safe ones</p>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="nextStep()">
                <span>Continue ‚Üí</span>
            </button>
            
            ${renderFooter()}
        `;
    }

    // STEP 2: Cold Water Info
    function renderStep2() {
        return `
            ${renderHeader()}
            
            <div class="card">
                <div class="section-header">
                    <span class="section-icon">üßä</span>
                    <span class="section-title">Cold Water ‚Äî The Dive Reflex</span>
                </div>
                
                <div style="color: rgb(203,213,225); line-height: 1.7;">
                    <p style="margin-bottom: 1rem;">
                        "When cold water hits your face, especially around your eyes and nose, it triggers the <strong style="color: rgb(94,234,212);">mammalian dive reflex</strong> ‚Äî the same response that lets seals dive deep. Your heart rate automatically slows. This isn't willpower; it's a hardwired reflex."
                    </p>
                </div>
                
                <div class="technique-stats">
                    <div class="stat">
                        <div class="stat-label">Speed</div>
                        <div class="stat-value">‚ö° 30-60 sec</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Best for</div>
                        <div class="stat-value">üéØ Hyperarousal</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Intensity</div>
                        <div class="stat-value">üí™ High</div>
                    </div>
                </div>
                
                <div class="instruction-box">
                    <p style="color: rgb(94,234,212); font-weight: 700; margin-bottom: 0.75rem;">How To Do It:</p>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 1rem 0 0.5rem;">Method 1: Ice Water Face Dunk</p>
                    <ul class="instruction-list">
                        <li>Fill bowl with ice water</li>
                        <li>Hold breath</li>
                        <li>Dunk face for 15-30 seconds</li>
                        <li>Come up, breathe normally</li>
                        <li>Repeat 2-3 times if needed</li>
                    </ul>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 1rem 0 0.5rem;">Method 2: Ice Pack on Face</p>
                    <ul class="instruction-list">
                        <li>Wrap ice pack in thin towel</li>
                        <li>Hold on eyes and cheeks for 30 seconds</li>
                        <li>Breathe slowly</li>
                        <li>Repeat as needed</li>
                    </ul>
                </div>
                
                <div class="safety-note">
                    <strong>‚ö†Ô∏è Safety:</strong> Don't do this if you have heart conditions. Don't hold breath for more than 30 seconds. If dizzy, stop.
                </div>
            </div>
            
            <button id="saveColdWaterBtn" class="btn-save">
                <span>üßä</span> Save Cold Water to Toolkit
            </button>
            <div id="coldWaterSaveFeedback" class="save-feedback"></div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Try It Now ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 3: Cold Water Practice
    function renderStep3() {
        return `
            ${renderHeader()}
            
            <div class="card-highlight" style="padding: 1.5rem; border-radius: 1.25rem; margin-bottom: 1.25rem;">
                <div style="text-align: center; font-size: 3rem; margin-bottom: 1rem;">üßä</div>
                <p style="color: rgb(165,243,252); text-align: center; font-weight: 600;">Let's try cold water together</p>
                <p style="color: rgb(203,213,225); text-align: center; font-size: 0.9375rem;">This is optional ‚Äî skip if you're not ready</p>
            </div>
            
            <div class="practice-card" id="coldWaterPractice">
                <div class="practice-title">
                    <span>üßä</span>
                    COLD WATER PRACTICE
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <p style="color: rgb(203,213,225); margin-bottom: 1rem;">Do you have access to:</p>
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                        <label class="reflection-checkbox" style="flex:1;">
                            <input type="checkbox" id="iceBowl"> Ice and bowl
                        </label>
                        <label class="reflection-checkbox" style="flex:1;">
                            <input type="checkbox" id="icePack"> Ice pack
                        </label>
                        <label class="reflection-checkbox" style="flex:1;">
                            <input type="checkbox" id="coldSink"> Cold water
                        </label>
                    </div>
                </div>
                
                <div class="practice-buttons">
                    <button id="coldWaterGuideBtn" class="btn-practice btn-practice-primary">Yes - Guide Me</button>
                    <button id="coldWaterSkipBtn" class="btn-practice btn-practice-secondary">Skip Practice</button>
                </div>
                
                <div id="coldWaterGuided" style="display: none; margin-top: 1.5rem;">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Current intensity (0-10)</span>
                            <span class="slider-value" id="coldBeforeValue">5</span>
                        </div>
                        <input type="range" id="coldBeforeSlider" class="slider" min="0" max="10" value="5" step="1">
                        <div class="slider-labels">
                            <span>0 - Calm</span>
                            <span>10 - Overwhelming</span>
                        </div>
                    </div>
                    
                    <p style="color: rgb(203,213,225); margin: 1rem 0; text-align: center;">
                        <strong>Get your cold water ready.</strong>
                    </p>
                    
                    <button id="coldWaterReadyBtn" class="btn-practice btn-practice-primary" style="margin-bottom: 1rem;">I'm Ready ‚Üí</button>
                    
                    <div id="coldWaterTimer" style="display: none;">
                        <div class="timer-container">
                            <div class="timer-phase">Hold breath ‚Ä¢ Apply cold</div>
                            <div class="timer-display" id="coldTimerDisplay">15</div>
                            <button id="coldStartTimerBtn" class="btn-practice btn-practice-primary">Start Timer</button>
                        </div>
                    </div>
                    
                    <div id="coldWaterAfter" style="display: none; margin-top: 1.5rem;">
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Intensity NOW (0-10)</span>
                                <span class="slider-value" id="coldAfterValue">5</span>
                            </div>
                            <input type="range" id="coldAfterSlider" class="slider" min="0" max="10" value="5" step="1">
                            <div class="slider-labels">
                                <span>0 - Calm</span>
                                <span>10 - Overwhelming</span>
                            </div>
                        </div>
                        
                        <div id="coldResult" class="result-box">
                            Adjust the slider to see your result
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Continue ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 4: Intense Exercise Info
    function renderStep4() {
        return `
            ${renderHeader()}
            
            <div class="card">
                <div class="section-header">
                    <span class="section-icon">üí™</span>
                    <span class="section-title">Intense Exercise</span>
                </div>
                
                <div style="color: rgb(203,213,225); line-height: 1.7;">
                    <p style="margin-bottom: 1rem;">
                        "When you're flooded with stress hormones (adrenaline, cortisol), your body is primed for physical action. Intense exercise <strong style="color: rgb(94,234,212);">metabolizes these chemicals</strong> ‚Äî you burn through the fuel of panic."
                    </p>
                </div>
                
                <div class="technique-stats">
                    <div class="stat">
                        <div class="stat-label">Speed</div>
                        <div class="stat-value">‚ö° 3-5 min</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Best for</div>
                        <div class="stat-value">üéØ Restless panic</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Intensity</div>
                        <div class="stat-value">üí™ High</div>
                    </div>
                </div>
                
                <div class="instruction-box">
                    <p style="color: rgb(94,234,212); font-weight: 700; margin-bottom: 0.75rem;">Options:</p>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 0.75rem 0 0.25rem;">üèÉ Sprint/Run</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem; margin-bottom: 0.75rem;">Run fast 1-2 min, walk 1 min, repeat 3-5x</p>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 0.75rem 0 0.25rem;">ü§∏ Jumping Jacks</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem; margin-bottom: 0.75rem;">50-100 fast, rest 30 sec, repeat 3x</p>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 0.75rem 0 0.25rem;">ü™ú Stair Sprints</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem; margin-bottom: 0.75rem;">Run up stairs, walk down, repeat 5-10x</p>
                </div>
                
                <p style="color: rgb(94,234,212); font-size: 0.875rem; font-weight: 600;">
                    Key: Intense enough you can't think. You should be breathing hard.
                </p>
            </div>
            
            <button id="saveExerciseBtn" class="btn-save">
                <span>üí™</span> Save Intense Exercise to Toolkit
            </button>
            <div id="exerciseSaveFeedback" class="save-feedback"></div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Practice ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 5: Intense Exercise Practice
    function renderStep5() {
        return `
            ${renderHeader()}
            
            <div class="practice-card" id="exercisePractice">
                <div class="practice-title">
                    <span>üí™</span>
                    EXERCISE PRACTICE
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <p style="color: rgb(203,213,225); margin-bottom: 1rem;">Can you do 2 minutes of movement?</p>
                    <div class="practice-buttons">
                        <button id="exerciseYesBtn" class="btn-practice btn-practice-primary">Yes - Let's Do It</button>
                        <button id="exerciseNoBtn" class="btn-practice btn-practice-secondary">Not Right Now</button>
                    </div>
                </div>
                
                <div id="exerciseGuided" style="display: none;">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Current energy (0-10)</span>
                            <span class="slider-value" id="energyBeforeValue">5</span>
                        </div>
                        <input type="range" id="energyBeforeSlider" class="slider" min="0" max="10" value="5" step="1">
                        <div class="slider-labels">
                            <span>0 - Low</span>
                            <span>10 - High</span>
                        </div>
                    </div>
                    
                    <p style="color: rgb(203,213,225); margin: 1rem 0;">Choose your exercise:</p>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
                        <button class="reflection-btn btn-practice btn-practice-secondary" id="exerciseJumpingJacks">Jumping Jacks</button>
                        <button class="reflection-btn btn-practice btn-practice-secondary" id="exerciseRun">Run in Place</button>
                        <button class="reflection-btn btn-practice btn-practice-secondary" id="exerciseStairs">Stairs</button>
                    </div>
                    
                    <button id="startWorkoutBtn" class="btn-practice btn-practice-primary">Start Workout ‚Üí</button>
                    
                    <div id="workoutTimer" style="display: none;">
                        <div class="timer-container">
                            <div class="timer-phase" id="workoutPhase">GO!</div>
                            <div class="timer-display" id="workoutTimerDisplay">30</div>
                            <div class="timer-round" id="workoutRound">Round 1 of 4</div>
                        </div>
                    </div>
                    
                    <div id="exerciseAfter" style="display: none; margin-top: 1.5rem;">
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Energy NOW (0-10)</span>
                                <span class="slider-value" id="energyAfterValue">5</span>
                            </div>
                            <input type="range" id="energyAfterSlider" class="slider" min="0" max="10" value="5" step="1">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Mental clarity (0-10)</span>
                                <span class="slider-value" id="clarityAfterValue">5</span>
                            </div>
                            <input type="range" id="clarityAfterSlider" class="slider" min="0" max="10" value="5" step="1">
                            <div class="slider-labels">
                                <span>0 - Foggy</span>
                                <span>10 - Clear</span>
                            </div>
                        </div>
                        
                        <div id="exerciseResult" class="result-box">
                            Complete the workout to see results
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Continue ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 6: Paced Breathing Info
    function renderStep6() {
        return `
            ${renderHeader()}
            
            <div class="card">
                <div class="section-header">
                    <span class="section-icon">üå¨Ô∏è</span>
                    <span class="section-title">Paced Breathing</span>
                </div>
                
                <div style="color: rgb(203,213,225); line-height: 1.7;">
                    <p style="margin-bottom: 1rem;">
                        "When you breathe in, your heart speeds up slightly. When you breathe out, it slows down. By making your <strong style="color: rgb(94,234,212);">exhales longer than inhales</strong>, you activate your body's natural calming system."
                    </p>
                </div>
                
                <div class="technique-stats">
                    <div class="stat">
                        <div class="stat-label">Speed</div>
                        <div class="stat-value">‚ö° 2-3 min</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Best for</div>
                        <div class="stat-value">üéØ Moderate anxiety</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Intensity</div>
                        <div class="stat-value">üí™ Low</div>
                    </div>
                </div>
                
                <div class="instruction-box">
                    <p style="color: rgb(94,234,212); font-weight: 700; margin-bottom: 0.75rem;">Patterns:</p>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 0.75rem 0 0.25rem;">4-6-8 (recommended)</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem;">IN 4 sec ‚Üí HOLD 6 sec ‚Üí OUT 8 sec</p>
                    
                    <p style="color: rgb(165,243,252); font-weight: 600; margin: 1rem 0 0.25rem;">Box Breathing</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem;">IN 4 ‚Üí HOLD 4 ‚Üí OUT 4 ‚Üí HOLD 4</p>
                </div>
                
                <p style="color: rgb(94,234,212); font-size: 0.875rem; font-weight: 600;">
                    Key: Exhale longer than inhale.
                </p>
                
                <div class="safety-note">
                    <strong>‚ö†Ô∏è Note:</strong> If focusing on breath makes you MORE anxious, skip this.
                </div>
            </div>
            
            <button id="saveBreathingBtn" class="btn-save">
                <span>üå¨Ô∏è</span> Save Paced Breathing to Toolkit
            </button>
            <div id="breathingSaveFeedback" class="save-feedback"></div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Practice ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 7: PMR Practice
    function renderStep7() {
        return `
            ${renderHeader()}
            
            <div class="card">
                <div class="section-header">
                    <span class="section-icon">üíÜ</span>
                    <span class="section-title">Progressive Muscle Relaxation</span>
                </div>
                
                <div style="color: rgb(203,213,225); line-height: 1.7;">
                    <p>
                        "You can't be physically tense and mentally relaxed at the same time. PMR works by deliberately tensing then releasing muscle groups."
                    </p>
                </div>
                
                <div class="technique-stats">
                    <div class="stat">
                        <div class="stat-label">Speed</div>
                        <div class="stat-value">‚ö° 5-10 min</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Best for</div>
                        <div class="stat-value">üéØ Physical tension</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Intensity</div>
                        <div class="stat-value">üí™ Low</div>
                    </div>
                </div>
            </div>
            
            <div class="practice-card" id="pmrPractice">
                <div class="practice-title">
                    <span>üíÜ</span>
                    GUIDED PMR (2 MIN)
                </div>
                
                <button id="startPMRBtn" class="btn-practice btn-practice-primary" style="margin-bottom: 1rem;">Start Guided Practice</button>
                
                <div id="pmrGuided" style="display: none;">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Current tension (0-10)</span>
                            <span class="slider-value" id="pmrBeforeValue">5</span>
                        </div>
                        <input type="range" id="pmrBeforeSlider" class="slider" min="0" max="10" value="5" step="1">
                        <div class="slider-labels">
                            <span>0 - Relaxed</span>
                            <span>10 - Tense</span>
                        </div>
                    </div>
                    
                    <div style="background: rgba(15,23,42,0.6); padding: 1.5rem; border-radius: 0.75rem; margin: 1rem 0;">
                        <p style="color: rgb(165,243,252); font-weight: 600; margin-bottom: 1rem; text-align: center;" id="pmrInstruction">Hands: Make tight fists</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: rgb(94,234,212); font-size: 2rem; font-weight: 700;" id="pmrTimer">5</span>
                            <button id="pmrNextBtn" class="btn-practice btn-practice-primary">Next ‚Üí</button>
                        </div>
                    </div>
                    
                    <div id="pmrAfter" style="display: none; margin-top: 1.5rem;">
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Tension NOW (0-10)</span>
                                <span class="slider-value" id="pmrAfterValue">5</span>
                            </div>
                            <input type="range" id="pmrAfterSlider" class="slider" min="0" max="10" value="5" step="1">
                        </div>
                        
                        <div id="pmrResult" class="result-box">
                            Complete the practice to see results
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="savePMRBtn" class="btn-save">
                <span>üíÜ</span> Save PMR to Toolkit
            </button>
            <div id="pmrSaveFeedback" class="save-feedback"></div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Continue ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 8: Temperature + Reflection
    function renderStep8() {
        return `
            ${renderHeader()}
            
            <div class="card">
                <div class="section-header">
                    <span class="section-icon">üî•</span>
                    <span class="section-title">Temperature Shock</span>
                </div>
                
                <div style="color: rgb(203,213,225); line-height: 1.7;">
                    <p>
                        "Extreme temperature changes create immediate physical sensations that interrupt emotional overwhelm. Your brain has limited processing capacity ‚Äî intense sensation takes up 'bandwidth'."
                    </p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0;">
                    <div style="background: rgba(14,116,144,0.1); padding: 1rem; border-radius: 0.75rem;">
                        <p style="color: rgb(94,234,212); font-weight: 700; margin-bottom: 0.5rem;">‚ùÑÔ∏è Cold</p>
                        <ul style="color: rgb(203,213,225); font-size: 0.8125rem; list-style-position: inside;">
                            <li>Ice cubes in hands</li>
                            <li>Cold shower</li>
                            <li>Walk outside in cold</li>
                        </ul>
                    </div>
                    <div style="background: rgba(217,119,6,0.1); padding: 1rem; border-radius: 0.75rem;">
                        <p style="color: rgb(251,191,36); font-weight: 700; margin-bottom: 0.5rem;">üî• Heat</p>
                        <ul style="color: rgb(203,213,225); font-size: 0.8125rem; list-style-position: inside;">
                            <li>Hot (not burning) shower</li>
                            <li>Heating pad on chest</li>
                            <li>Hands under hot water</li>
                        </ul>
                    </div>
                </div>
                
                <div style="background: rgba(14,116,144,0.1); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
                    <p style="color: rgb(94,234,212); font-weight: 700; margin-bottom: 0.25rem;">When to Use:</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem;">‚Ä¢ When numb/dissociated</p>
                    <p style="color: rgb(203,213,225); font-size: 0.875rem;">‚Ä¢ When emotionally overwhelmed</p>
                </div>
                
                <div class="safety-note">
                    <strong>‚ö†Ô∏è Important:</strong> Sensation, not harm. Don't cause injury.
                </div>
            </div>
            
            <button id="saveTempBtn" class="btn-save">
                <span>üå°Ô∏è</span> Save Temperature Techniques
            </button>
            <div id="tempSaveFeedback" class="save-feedback"></div>
            
            <div class="reference-card" style="background: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.1)); border: 1px solid rgba(14,116,144,0.3); border-radius: 1rem; padding: 1.5rem; margin: 1.5rem 0;">
                <div class="reference-title" style="display: flex; align-items: center; gap: 0.5rem; color: rgb(165,243,252); font-size: 1.125rem; font-weight: 700; margin-bottom: 1rem;">
                    <span>üìã</span> Your Top Techniques
                </div>
                
                <p style="color: white; font-weight: 600; margin-bottom: 1rem;">
                    "Which 2-3 techniques felt most accessible?"
                </p>
                
                <div class="reflection-grid" id="techniqueCheckboxes">
                    <label class="reflection-checkbox"><input type="checkbox" value="Cold Water"> Cold water</label>
                    <label class="reflection-checkbox"><input type="checkbox" value="Intense Exercise"> Intense exercise</label>
                    <label class="reflection-checkbox"><input type="checkbox" value="Paced Breathing"> Paced breathing</label>
                    <label class="reflection-checkbox"><input type="checkbox" value="Muscle Relaxation"> Muscle relaxation</label>
                    <label class="reflection-checkbox"><input type="checkbox" value="Temperature Shock"> Temperature shock</label>
                </div>
                
                <div style="background: rgba(217,119,6,0.1); padding: 1.25rem; border-radius: 0.75rem; margin-top: 1.5rem;">
                    <p style="color: rgb(251,191,36); font-weight: 600; margin-bottom: 1rem; text-align: center;">
                        "Crisis skills only work if you practice when calm. Will you commit to practicing your top 2 techniques this week?"
                    </p>
                    <div style="display: flex; gap: 0.75rem;">
                        <button id="commitYesBtn" class="btn-practice btn-practice-primary" style="flex: 1;">Yes, I Commit</button>
                        <button id="commitLaterBtn" class="btn-practice btn-practice-secondary" style="flex: 1;">Maybe Later</button>
                    </div>
                </div>
                
                <button id="saveReflectionBtn" class="btn-save" style="margin-top: 1.5rem;">
                    <span>üìã</span> Save My Top Techniques
                </button>
                <div id="reflectionSaveFeedback" class="save-feedback"></div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Complete Module ‚Üí</button>
            </div>
            
            ${renderFooter()}
        `;
    }

    // STEP 9: Completion
    function renderStep9() {
        return `
            ${renderHeader()}
            
            <div class="card-highlight" style="padding: 2rem; border-radius: 1.25rem; text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">‚úÖ</div>
                <h2 style="color: rgb(165,243,252); font-size: 1.5rem; margin-bottom: 1rem;">Module 2 Complete!</h2>
                <p style="color: rgb(203,213,225); margin-bottom: 1.5rem;">
                    You now have physical tools to reset your nervous system when your thinking brain is offline.
                </p>
                <p style="color: rgb(94,234,212); font-weight: 600;">
                    Next: Module 3 - Grounding & Distraction
                </p>
            </div>
            
            <div style="text-align: center; margin: 2rem 0;">
                <button id="practiceBtn" style="background: rgba(34,197,94,0.12); color: rgb(74,222,128); border: 1px solid rgba(74,222,128,0.3); padding: 0.875rem 2rem; border-radius: 2rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer;">
                    ‚úì Mark Module as Practiced
                </button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="previousStep()">‚Üê Back</button>
                <a href="crisis-module-3.html" class="btn btn-primary">Module 3 ‚Üí</a>
            </div>
            
            ${renderFooter()}
        `;
    }

    // ===== MAIN RENDER =====
    function render() {
        const content = document.getElementById('content');
        
        switch(currentStep) {
            case 1: content.innerHTML = renderStep1(); break;
            case 2: content.innerHTML = renderStep2(); initColdWaterSave(); break;
            case 3: content.innerHTML = renderStep3(); initColdWaterPractice(); break;
            case 4: content.innerHTML = renderStep4(); initExerciseSave(); break;
            case 5: content.innerHTML = renderStep5(); initExercisePractice(); break;
            case 6: content.innerHTML = renderStep6(); initBreathingSave(); break;
            case 7: content.innerHTML = renderStep7(); initPMR(); break;
            case 8: content.innerHTML = renderStep8(); initTemperature(); initReflection(); break;
            case 9: content.innerHTML = renderStep9(); initComplete(); break;
            default: content.innerHTML = renderStep1();
        }
    }

    // ===== INIT FUNCTIONS =====
    function initColdWaterSave() {
        const btn = document.getElementById('saveColdWaterBtn');
        const feedback = document.getElementById('coldWaterSaveFeedback');
        if (!btn) return;
        
        btn.addEventListener('click', function() {
            saveToToolkit({
                id: 'cold-water',
                category: 'Module 2',
                name: 'Cold Water ‚Äî Dive Reflex',
                description: '30-60 seconds ‚Ä¢ Panic, rage, instant calm ‚Ä¢ Dunk face in ice water 15-30 seconds'
            });
            
            btn.classList.add('saved');
            btn.innerHTML = '<span>‚úì</span> Saved!';
            feedback.textContent = '‚úì Saved to toolkit';
            feedback.classList.add('show');
            
            setTimeout(() => {
                btn.classList.remove('saved');
                btn.innerHTML = '<span>üßä</span> Save Cold Water to Toolkit';
                feedback.classList.remove('show');
            }, 2000);
        });
    }

    function initColdWaterPractice() {
        const guideBtn = document.getElementById('coldWaterGuideBtn');
        const skipBtn = document.getElementById('coldWaterSkipBtn');
        const guided = document.getElementById('coldWaterGuided');
        const readyBtn = document.getElementById('coldWaterReadyBtn');
        const timer = document.getElementById('coldWaterTimer');
        const startBtn = document.getElementById('coldStartTimerBtn');
        const timerDisplay = document.getElementById('coldTimerDisplay');
        const afterDiv = document.getElementById('coldWaterAfter');
        const resultDiv = document.getElementById('coldResult');
        
        const beforeSlider = document.getElementById('coldBeforeSlider');
        const beforeValue = document.getElementById('coldBeforeValue');
        const afterSlider = document.getElementById('coldAfterSlider');
        const afterValue = document.getElementById('coldAfterValue');
        
        if (beforeSlider && beforeValue) {
            beforeSlider.addEventListener('input', () => {
                beforeValue.textContent = beforeSlider.value;
            });
        }
        
        if (afterSlider && afterValue) {
            afterSlider.addEventListener('input', () => {
                afterValue.textContent = afterSlider.value;
                const before = parseInt(beforeSlider?.value || '5');
                const after = parseInt(afterSlider.value);
                
                if (after < before) {
                    resultDiv.innerHTML = `<p style="color: rgb(165,243,252);"><strong>‚úì Dropped from ${before} to ${after}!</strong><br>That's the dive reflex working.</p>`;
                } else {
                    resultDiv.innerHTML = `<p style="color: rgb(203,213,225);">Stayed at ${after}. Other techniques may work better for you.</p>`;
                }
            });
        }
        
        if (guideBtn) {
            guideBtn.addEventListener('click', () => {
                guided.style.display = 'block';
                guideBtn.style.display = 'none';
                skipBtn.style.display = 'none';
            });
        }
        
        if (skipBtn) {
            skipBtn.addEventListener('click', () => {
                skipBtn.textContent = 'Skipped';
                skipBtn.disabled = true;
            });
        }
        
        if (readyBtn) {
            readyBtn.addEventListener('click', () => {
                timer.style.display = 'block';
                readyBtn.style.display = 'none';
            });
        }
        
        if (startBtn) {
            startBtn.addEventListener('click', function() {
                let timeLeft = 15;
                timerDisplay.textContent = timeLeft;
                startBtn.textContent = 'Timer Running...';
                startBtn.disabled = true;
                
                const interval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        timerDisplay.textContent = 'Done!';
                        setTimeout(() => {
                            timer.style.display = 'none';
                            afterDiv.style.display = 'block';
                        }, 1000);
                    }
                }, 1000);
            });
        }
        
        // Checkboxes
        document.querySelectorAll('.reflection-checkbox input').forEach(cb => {
            cb.addEventListener('change', function() {
                const label = this.closest('.reflection-checkbox');
                if (this.checked) label.classList.add('checked');
                else label.classList.remove('checked');
            });
        });
    }

    function initExerciseSave() {
        const btn = document.getElementById('saveExerciseBtn');
        const feedback = document.getElementById('exerciseSaveFeedback');
        if (!btn) return;
        
        btn.addEventListener('click', function() {
            saveToToolkit({
                id: 'intense-exercise',
                category: 'Module 2',
                name: 'Intense Exercise',
                description: '3-5 minutes ‚Ä¢ Restless panic, rage ‚Ä¢ Sprint, jumping jacks, stairs ‚Äî breathe hard'
            });
            
            btn.classList.add('saved');
            btn.innerHTML = '<span>‚úì</span> Saved!';
            feedback.textContent = '‚úì Saved to toolkit';
            feedback.classList.add('show');
            
            setTimeout(() => {
                btn.classList.remove('saved');
                btn.innerHTML = '<span>üí™</span> Save Intense Exercise to Toolkit';
                feedback.classList.remove('show');
            }, 2000);
        });
    }

    function initExercisePractice() {
        const yesBtn = document.getElementById('exerciseYesBtn');
        const noBtn = document.getElementById('exerciseNoBtn');
        const guided = document.getElementById('exerciseGuided');
        const startBtn = document.getElementById('startWorkoutBtn');
        const workoutTimer = document.getElementById('workoutTimer');
        const timerDisplay = document.getElementById('workoutTimerDisplay');
        const workoutPhase = document.getElementById('workoutPhase');
        const workoutRound = document.getElementById('workoutRound');
        const afterDiv = document.getElementById('exerciseAfter');
        const resultDiv = document.getElementById('exerciseResult');
        
        const energyBefore = document.getElementById('energyBeforeSlider');
        const energyBeforeVal = document.getElementById('energyBeforeValue');
        const energyAfter = document.getElementById('energyAfterSlider');
        const energyAfterVal = document.getElementById('energyAfterValue');
        const clarityAfter = document.getElementById('clarityAfterSlider');
        const clarityAfterVal = document.getElementById('clarityAfterValue');
        
        if (energyBefore && energyBeforeVal) {
            energyBefore.addEventListener('input', () => energyBeforeVal.textContent = energyBefore.value);
        }
        
        if (energyAfter && energyAfterVal) {
            energyAfter.addEventListener('input', () => energyAfterVal.textContent = energyAfter.value);
        }
        
        if (clarityAfter && clarityAfterVal) {
            clarityAfter.addEventListener('input', () => clarityAfterVal.textContent = clarityAfter.value);
        }
        
        if (yesBtn) {
            yesBtn.addEventListener('click', () => {
                guided.style.display = 'block';
                yesBtn.style.display = 'none';
                noBtn.style.display = 'none';
            });
        }
        
        if (noBtn) {
            noBtn.addEventListener('click', () => {
                noBtn.textContent = 'Skipped';
                noBtn.disabled = true;
            });
        }
        
        if (startBtn) {
            let round = 1;
            let isWorkout = true;
            let timeLeft = 30;
            let interval;
            
            startBtn.addEventListener('click', function() {
                workoutTimer.style.display = 'block';
                startBtn.style.display = 'none';
                
                interval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        if (isWorkout) {
                            isWorkout = false;
                            timeLeft = 30;
                            workoutPhase.textContent = 'REST';
                            workoutPhase.style.color = 'rgb(251,191,36)';
                        } else {
                            isWorkout = true;
                            timeLeft = 30;
                            round++;
                            workoutPhase.textContent = 'GO!';
                            workoutPhase.style.color = 'rgb(94,234,212)';
                            workoutRound.textContent = `Round ${round} of 4`;
                        }
                        
                        if (round > 4) {
                            clearInterval(interval);
                            workoutTimer.style.display = 'none';
                            afterDiv.style.display = 'block';
                            
                            const before = parseInt(energyBefore?.value || '5');
                            const after = parseInt(energyAfter?.value || '7');
                            const clarity = parseInt(clarityAfter?.value || '6');
                            
                            resultDiv.innerHTML = `<p style="color: rgb(165,243,252);">Energy: ${before} ‚Üí ${after}<br>Clarity: ${clarity}/10</p>`;
                        }
                    }
                }, 1000);
            });
        }
        
        // Exercise type buttons
        ['exerciseJumpingJacks', 'exerciseRun', 'exerciseStairs'].forEach(id => {
            const btn = document.getElementById(id);
            if (btn) {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('#exerciseGuided .reflection-btn').forEach(b => {
                        b.style.background = 'rgba(15,23,42,0.45)';
                    });
                    this.style.background = 'rgba(14,116,144,0.3)';
                });
            }
        });
    }

    function initBreathingSave() {
        const btn = document.getElementById('saveBreathingBtn');
        const feedback = document.getElementById('breathingSaveFeedback');
        if (!btn) return;
        
        btn.addEventListener('click', function() {
            saveToToolkit({
                id: 'paced-breathing',
                category: 'Module 2',
                name: 'Paced Breathing',
                description: '2-3 minutes ‚Ä¢ Moderate anxiety ‚Ä¢ 4-6-8 pattern: IN 4, HOLD 6, OUT 8'
            });
            
            btn.classList.add('saved');
            btn.innerHTML = '<span>‚úì</span> Saved!';
            feedback.textContent = '‚úì Saved to toolkit';
            feedback.classList.add('show');
            
            setTimeout(() => {
                btn.classList.remove('saved');
                btn.innerHTML = '<span>üå¨Ô∏è</span> Save Paced Breathing to Toolkit';
                feedback.classList.remove('show');
            }, 2000);
        });
    }

    function initPMR() {
        const startBtn = document.getElementById('startPMRBtn');
        const guided = document.getElementById('pmrGuided');
        const pmrInstruction = document.getElementById('pmrInstruction');
        const pmrTimer = document.getElementById('pmrTimer');
        const pmrNext = document.getElementById('pmrNextBtn');
        const pmrAfter = document.getElementById('pmrAfter');
        const pmrResult = document.getElementById('pmrResult');
        
        const beforeSlider = document.getElementById('pmrBeforeSlider');
        const beforeValue = document.getElementById('pmrBeforeValue');
        const afterSlider = document.getElementById('pmrAfterSlider');
        const afterValue = document.getElementById('pmrAfterValue');
        
        if (beforeSlider && beforeValue) {
            beforeSlider.addEventListener('input', () => beforeValue.textContent = beforeSlider.value);
        }
        
        if (afterSlider && afterValue) {
            afterSlider.addEventListener('input', () => afterValue.textContent = afterSlider.value);
        }
        
        const steps = [
            { text: 'Hands: Make tight fists... tighter... hold...', time: 5 },
            { text: '...and RELEASE. Feel the difference.', time: 10 },
            { text: 'Arms: Tense biceps... squeeze...', time: 5 },
            { text: '...and RELEASE. Notice the warmth.', time: 10 },
            { text: 'Shoulders: Pull up to ears... squeeze...', time: 5 },
            { text: '...and DROP. Let them be heavy.', time: 10 },
            { text: 'Face: Scrunch everything tight...', time: 5 },
            { text: '...and SOFTEN. Jaw loose.', time: 10 },
            { text: 'Legs: Point toes, tense thighs...', time: 5 },
            { text: '...and RELEASE. Heavy legs.', time: 10 }
        ];
        
        let stepIndex = 0;
        let timerInterval;
        
        if (startBtn) {
            startBtn.addEventListener('click', () => {
                guided.style.display = 'block';
                startBtn.style.display = 'none';
                stepIndex = 0;
                runStep();
            });
        }
        
        function runStep() {
            if (stepIndex >= steps.length) {
                if (timerInterval) clearInterval(timerInterval);
                guided.style.display = 'none';
                pmrAfter.style.display = 'block';
                
                const before = parseInt(beforeSlider?.value || '5');
                const after = parseInt(afterSlider?.value || '3');
                pmrResult.innerHTML = `<p style="color: rgb(165,243,252);">Tension: ${before} ‚Üí ${after}</p>`;
                return;
            }
            
            const step = steps[stepIndex];
            pmrInstruction.textContent = step.text;
            let timeLeft = step.time;
            pmrTimer.textContent = timeLeft;
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                pmrTimer.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }
        
        if (pmrNext) {
            pmrNext.addEventListener('click', () => {
                stepIndex++;
                runStep();
            });
        }
        
        const saveBtn = document.getElementById('savePMRBtn');
        const feedback = document.getElementById('pmrSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'pmr',
                    category: 'Module 2',
                    name: 'Progressive Muscle Relaxation',
                    description: '5-10 minutes ‚Ä¢ Physical tension ‚Ä¢ Tense each muscle group 5 sec, release 10 sec'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span> Saved!';
                feedback.textContent = '‚úì Saved to toolkit';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üíÜ</span> Save PMR to Toolkit';
                    feedback.classList.remove('show');
                }, 2000);
            });
        }
    }

    function initTemperature() {
        const saveBtn = document.getElementById('saveTempBtn');
        const feedback = document.getElementById('tempSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                saveToToolkit({
                    id: 'temperature',
                    category: 'Module 2',
                    name: 'Temperature Shock',
                    description: '1-2 minutes ‚Ä¢ Numbness, dissociation ‚Ä¢ Cold: ice cubes ‚Ä¢ Heat: hot shower'
                });
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span> Saved!';
                feedback.textContent = '‚úì Saved to toolkit';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üå°Ô∏è</span> Save Temperature Techniques';
                    feedback.classList.remove('show');
                }, 2000);
            });
        }
    }

    function initReflection() {
        // Checkbox styling
        document.querySelectorAll('.reflection-checkbox input').forEach(cb => {
            cb.addEventListener('change', function() {
                const label = this.closest('.reflection-checkbox');
                if (this.checked) label.classList.add('checked');
                else label.classList.remove('checked');
            });
        });
        
        // Load saved
        const plan = JSON.parse(localStorage.getItem('crisis_plan') || '{}');
        const saved = plan.physicalTechniques || [];
        
        document.querySelectorAll('#techniqueCheckboxes input').forEach(cb => {
            if (saved.includes(cb.value)) {
                cb.checked = true;
                cb.closest('.reflection-checkbox').classList.add('checked');
            }
        });
        
        // Commit buttons
        const yesBtn = document.getElementById('commitYesBtn');
        const laterBtn = document.getElementById('commitLaterBtn');
        
        if (yesBtn) {
            yesBtn.addEventListener('click', function() {
                this.textContent = '‚úì Committed!';
                this.style.background = 'rgba(34,197,94,0.12)';
                this.style.color = 'rgb(74,222,128)';
                
                saveToCrisisPlan('practiceCommitment', {
                    committed: true,
                    date: new Date().toISOString(),
                    module: 2
                });
            });
        }
        
        if (laterBtn) {
            laterBtn.addEventListener('click', function() {
                this.textContent = 'Maybe Later';
                this.disabled = true;
            });
        }
        
        // Save reflection
        const saveBtn = document.getElementById('saveReflectionBtn');
        const feedback = document.getElementById('reflectionSaveFeedback');
        
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                const checked = document.querySelectorAll('#techniqueCheckboxes input:checked');
                const techniques = Array.from(checked).map(cb => cb.value);
                
                if (techniques.length === 0) {
                    alert('Select at least one technique');
                    return;
                }
                
                saveToToolkit({
                    id: 'my-top-techniques',
                    category: 'My Crisis Profile',
                    name: 'My Top Physical Reset Techniques',
                    description: techniques.join(', ')
                });
                
                saveToCrisisPlan('physicalTechniques', techniques);
                
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<span>‚úì</span> Saved!';
                feedback.textContent = '‚úì Saved to crisis plan';
                feedback.classList.add('show');
                
                setTimeout(() => {
                    saveBtn.classList.remove('saved');
                    saveBtn.innerHTML = '<span>üìã</span> Save My Top Techniques';
                    feedback.classList.remove('show');
                }, 2000);
            });
        }
    }

    function initComplete() {
        const practiceBtn = document.getElementById('practiceBtn');
        
        let progress = JSON.parse(localStorage.getItem('crisis_course_progress') || '{}');
        if (progress.practicedModules?.includes('module2')) {
            practiceBtn.innerHTML = '‚úì Module 2 Practiced';
            practiceBtn.style.background = 'rgba(34,197,94,0.25)';
        }
        
        if (practiceBtn) {
            practiceBtn.addEventListener('click', function() {
                if (!progress.practicedModules) progress.practicedModules = [];
                if (!progress.practicedModules.includes('module2')) {
                    progress.practicedModules.push('module2');
                    progress.lastPracticed = new Date().toISOString();
                    localStorage.setItem('crisis_course_progress', JSON.stringify(progress));
                    
                    practiceBtn.innerHTML = '‚úì Module 2 Practiced';
                    practiceBtn.style.background = 'rgba(34,197,94,0.25)';
                }
            });
        }
    }

    // Initialize
    loadProgress();
    render();
})();
</script>
</body>
</html>
