<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>MPHaven - Important Safety Information</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-dark: #0f172a;
            --bg-card: rgba(15, 23, 42, 0.98);
            --bg-card-light: rgba(30, 41, 59, 0.65);
            --border-subtle: rgba(30, 41, 59, 0.5);
            --border-softer: rgba(51, 65, 85, 0.4);
            --primary-teal: #0e7490;
            --crisis-red: #dc2626;
            --crisis-bg: rgba(220, 38, 38, 0.08);
            --warning-amber: #d97706;
            --text-primary: rgb(241, 245, 249);
            --text-secondary: rgb(203, 213, 225);
            --text-muted: rgb(148, 163, 184);
            --gradient-main: linear-gradient(135deg, #0e7490, #d97706);
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(to bottom, #020617, #0f172a, #020617);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .container {
            width: 100%;
            max-width: 32rem;
            height: 100vh;
            max-height: 844px;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            border: 1px solid rgba(30, 41, 59, 0.5);
            -ms-overflow-style: none;
            scrollbar-width: none;
            border-radius: 2.5rem;
            margin: 20px;
        }

        .container::-webkit-scrollbar {
            display: none;
        }

        .bg-blur-1 {
            position: absolute;
            top: -10%;
            left: 50%;
            transform: translateX(-50%);
            width: 30rem;
            height: 30rem;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 50%;
            filter: blur(120px);
            pointer-events: none;
            z-index: 0;
        }

        .content {
            position: relative;
            z-index: 10;
            padding: 2rem 1.5rem;
            flex: 1;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: white;
        }

        .title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fca5a5, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        /* ========== CRISIS SCREENING (MOST IMPORTANT) ========== */
        .crisis-screen {
            background: rgba(220, 38, 38, 0.15);
            border: 3px solid var(--crisis-red);
            border-radius: 1.25rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            animation: pulse-border 2s ease-in-out infinite;
        }

        @keyframes pulse-border {
            0%, 100% { border-color: var(--crisis-red); }
            50% { border-color: #fca5a5; }
        }

        .crisis-screen h2 {
            color: #fca5a5;
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .crisis-question {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(220, 38, 38, 0.4);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .crisis-question p {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .crisis-question ul {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-left: 1.25rem;
            line-height: 1.8;
        }

        .crisis-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .crisis-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid var(--border-softer);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .crisis-option:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: var(--text-muted);
        }

        .crisis-option.selected {
            background: rgba(14, 116, 144, 0.2);
            border-color: var(--primary-teal);
        }

        .crisis-option.blocked {
            background: rgba(220, 38, 38, 0.2);
            border-color: var(--crisis-red);
        }

        .crisis-option input[type="radio"] {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary-teal);
            cursor: pointer;
        }

        .crisis-option label {
            color: var(--text-primary);
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
        }

        .crisis-resources {
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid var(--crisis-red);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            display: none;
        }

        .crisis-resources.show {
            display: block;
        }

        .crisis-resources p {
            color: #fca5a5;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .crisis-resources a {
            color: #fca5a5;
            text-decoration: none;
            font-weight: 700;
        }

        .crisis-resources a:hover {
            text-decoration: underline;
        }

        /* ========== PRIMARY DISCLAIMER (SIMPLIFIED) ========== */
        .disclaimer-primary {
            background: rgba(30, 41, 59, 0.5);
            border: 2px solid var(--border-softer);
            border-radius: 1.25rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .disclaimer-primary h2 {
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .key-point {
            background: rgba(14, 116, 144, 0.1);
            border-left: 3px solid var(--primary-teal);
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.5rem;
        }

        .key-point strong {
            color: var(--primary-teal);
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
        }

        .key-point p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* ========== ACKNOWLEDGMENT CHECKBOXES (SEPARATED) ========== */
        .acknowledgments {
            background: rgba(30, 41, 59, 0.5);
            border: 2px solid var(--border-softer);
            border-radius: 1.25rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .acknowledgments h3 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .ack-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--border-softer);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .ack-item.checked {
            background: rgba(14, 116, 144, 0.1);
            border-color: var(--primary-teal);
        }

        .ack-item input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            margin-top: 0.125rem;
            accent-color: var(--primary-teal);
            cursor: pointer;
            flex-shrink: 0;
        }

        .ack-item label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
            flex: 1;
            cursor: pointer;
        }

        .ack-item label strong {
            color: var(--text-primary);
            font-size: 0.9375rem;
        }

        /* ========== EXPANDABLE FULL LEGAL TEXT ========== */
        .legal-toggle {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border-softer);
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .legal-toggle:hover {
            background: rgba(30, 41, 59, 0.7);
            border-color: var(--text-muted);
        }

        .legal-toggle span {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .legal-toggle svg {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
            transition: transform 0.3s;
        }

        .legal-toggle.expanded svg {
            transform: rotate(180deg);
        }

        .legal-full {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .legal-full.expanded {
            max-height: 2000px;
        }

        .legal-content {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border-softer);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .legal-clause {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid var(--border-softer);
            border-radius: 0.5rem;
            padding: 0.875rem;
            margin-bottom: 0.75rem;
        }

        .legal-clause strong {
            color: var(--primary-teal);
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.8125rem;
        }

        .legal-clause p {
            color: var(--text-muted);
            font-size: 0.75rem;
            line-height: 1.5;
        }

        /* ========== BUTTONS ========== */
        .btn {
            width: 100%;
            padding: 1rem 1.5rem;
            border-radius: 1rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            text-align: center;
            display: inline-block;
            transition: all 0.2s;
            text-decoration: none;
            letter-spacing: 0.02em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0e7490, #d97706);
            color: white;
            box-shadow: 0 10px 25px rgba(14, 116, 144, 0.3);
        }

        .btn-primary:hover:not(.btn-disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(14, 116, 144, 0.4);
        }

        .btn-secondary {
            background: rgba(30, 41, 59, 0.6);
            color: var(--text-secondary);
            border: 1px solid var(--border-softer);
        }

        .btn-secondary:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: var(--text-muted);
        }

        .btn-disabled {
            opacity: 0.5;
            pointer-events: none;
            background: rgba(30, 41, 59, 0.6);
            color: var(--text-muted);
            box-shadow: none;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .footer {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.7rem;
            line-height: 1.6;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-softer);
        }

        .footer a {
            color: var(--primary-teal);
            text-decoration: none;
        }

        .progress-indicator {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .progress-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background: var(--border-softer);
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: var(--primary-teal);
            width: 1.5rem;
            border-radius: 0.25rem;
        }

        @media (max-width: 640px) {
            .btn-group { 
                flex-direction: column; 
            }
            .container {
                margin: 0;
                border-radius: 0;
                height: 100vh;
                max-height: 100vh;
            }
            .content {
                padding: 1.5rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="bg-blur-1"></div>
        
        <div class="content">
            <button class="back-link" onclick="goBack()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Back
            </button>
            
            <h1 class="title">‚ö†Ô∏è Before You Continue</h1>
            <p class="subtitle">Important safety and legal information ‚Äî please read carefully</p>

            <div class="progress-indicator">
                <div class="progress-dot" id="dot1"></div>
                <div class="progress-dot" id="dot2"></div>
                <div class="progress-dot" id="dot3"></div>
            </div>

            <!-- ========== STEP 1: CRISIS SCREENING ========== -->
            <div class="crisis-screen">
                <h2>üö® Crisis Safety Check</h2>
                
                <div class="crisis-question">
                    <p>Are you currently experiencing any of the following?</p>
                    <ul>
                        <li>Thoughts of suicide or self-harm</li>
                        <li>Plans to hurt yourself or others</li>
                        <li>Unable to keep yourself safe right now</li>
                    </ul>
                </div>

                <div class="crisis-options">
                    <div class="crisis-option" onclick="selectCrisis('yes')">
                        <input type="radio" name="crisis" id="crisisYes" value="yes">
                        <label for="crisisYes">Yes, I am experiencing these thoughts</label>
                    </div>
                    <div class="crisis-option" onclick="selectCrisis('no')">
                        <input type="radio" name="crisis" id="crisisNo" value="no">
                        <label for="crisisNo">No, I am safe to continue</label>
                    </div>
                </div>

                <div class="crisis-resources" id="crisisResources">
                    <p style="font-size: 1rem; margin-bottom: 0.75rem;">üö® PLEASE STOP AND GET HELP NOW:</p>
                    <p>‚Ä¢ <a href="tel:988">988 Suicide & Crisis Lifeline</a> ‚Äî Call or text 988 (24/7)</p>
                    <p>‚Ä¢ <a href="sms:741741">Crisis Text Line</a> ‚Äî Text HOME to 741741</p>
                    <p>‚Ä¢ <a href="tel:911">911 Emergency</a> ‚Äî Or go to your nearest ER</p>
                    <p style="margin-top: 0.75rem; color: #fca5a5; font-weight: 700;">‚ö†Ô∏è This app cannot help in a crisis. Please contact professional help immediately.</p>
                </div>
            </div>

            <!-- ========== STEP 2: PRIMARY DISCLAIMER ========== -->
            <div class="disclaimer-primary" id="disclaimerSection" style="display: none;">
                <h2>üìã What MPHaven Is (and Isn't)</h2>
                
                <div class="key-point">
                    <strong>This is NOT Therapy or Medical Treatment</strong>
                    <p>MPHaven provides educational content and self-help tools. It is not a substitute for professional mental health care, diagnosis, or treatment.</p>
                </div>

                <div class="key-point">
                    <strong>No Professional Relationship Created</strong>
                    <p>Using this app does not create a therapist-client, doctor-patient, or any other professional healthcare relationship.</p>
                </div>

                <div class="key-point">
                    <strong>You Are Responsible</strong>
                    <p>You are solely responsible for your own wellbeing and decisions. We provide information‚Äîyou decide how to use it.</p>
                </div>

                <div class="key-point">
                    <strong>No Guarantees</strong>
                    <p>We make no guarantees these techniques will work for you. Results vary. All content is provided "as is" without warranties.</p>
                </div>
            </div>

            <!-- ========== STEP 3: ACKNOWLEDGMENTS (SEPARATED FOR ENFORCEABILITY) ========== -->
            <div class="acknowledgments" id="acknowledgmentsSection" style="display: none;">
                <h3>‚úì Required Acknowledgments</h3>
                
                <div class="ack-item" id="ack1">
                    <input type="checkbox" id="check1" onchange="updateAckState('ack1', 'check1')">
                    <label for="check1">
                        <strong>I understand this is educational content, not therapy.</strong> 
                        I know MPHaven does not provide medical or mental health treatment, and using it does not create any professional relationship.
                    </label>
                </div>

                <div class="ack-item" id="ack2">
                    <input type="checkbox" id="check2" onchange="updateAckState('ack2', 'check2')">
                    <label for="check2">
                        <strong>I am not currently in crisis.</strong> 
                        I confirm that I am safe and do not have immediate thoughts of self-harm or suicide. I know to contact 988 or 911 if this changes.
                    </label>
                </div>

                <div class="ack-item" id="ack3">
                    <input type="checkbox" id="check3" onchange="updateAckState('ack3', 'check3')">
                    <label for="check3">
                        <strong>I accept full responsibility for my use.</strong> 
                        I understand that I am solely responsible for my decisions and actions. MPHaven is not liable for outcomes from my use of this app.
                    </label>
                </div>

                <div class="ack-item" id="ack4">
                    <input type="checkbox" id="check4" onchange="updateAckState('ack4', 'check4')">
                    <label for="check4">
                        <strong>I agree to the legal terms.</strong> 
                        I have read and agree to the <a href="terms.html" target="_blank" style="color: var(--primary-teal);">Terms of Service</a>, <a href="privacy.html" target="_blank" style="color: var(--primary-teal);">Privacy Policy</a>, and arbitration/class action waiver provisions.
                    </label>
                </div>
            </div>

            <!-- ========== EXPANDABLE FULL LEGAL TEXT ========== -->
            <div class="legal-toggle" id="legalToggle" onclick="toggleLegal()" style="display: none;">
                <span>üìÑ View Full Legal Terms & Conditions</span>
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                </svg>
            </div>

            <div class="legal-full" id="legalFull">
                <div class="legal-content">
                    <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem; line-height: 1.6;">
                        <strong style="color: var(--text-primary);">Complete Legal Disclaimer ‚Äî Version 3.0 (February 2026)</strong><br>
                        The following provisions apply to your use of MPHaven. By continuing, you acknowledge and agree to all terms below.
                    </p>

                    <div class="legal-clause">
                        <strong>LIMITATION OF LIABILITY:</strong>
                        <p>To the maximum extent permitted by law, MPHaven and its creators shall NOT be liable for any direct, indirect, incidental, special, consequential, or punitive damages resulting from your use of the app.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>INDEMNIFICATION:</strong>
                        <p>You agree to defend, indemnify, and hold harmless MPHaven from any claims, damages, losses, and expenses arising from your use of the app or violation of these terms.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>ARBITRATION & CLASS ACTION WAIVER:</strong>
                        <p>Any disputes shall be resolved through binding individual arbitration administered by the American Arbitration Association. You waive your right to participate in class actions and to trial by jury.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>GOVERNING LAW:</strong>
                        <p>These terms are governed by the laws of your state of residence, or if indeterminable, the State of Delaware, without regard to conflict of law provisions.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>SEVERABILITY:</strong>
                        <p>If any provision is held unenforceable, it will be modified to accomplish its objectives to the greatest extent possible, and remaining provisions continue in full force.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>ENTIRE AGREEMENT:</strong>
                        <p>These terms, with the Terms of Service and Privacy Policy, constitute the complete agreement between you and MPHaven.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>SURVIVAL:</strong>
                        <p>All provisions that should survive termination (ownership, disclaimers, indemnity, liability limitations) shall survive.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>FORCE MAJEURE:</strong>
                        <p>MPHaven is not liable for failures due to circumstances beyond reasonable control, including acts of God, war, pandemics, or internet failures.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>NO WAIVER:</strong>
                        <p>No failure to exercise any right operates as a waiver, nor does any single exercise preclude further exercise of rights.</p>
                    </div>

                    <div class="legal-clause">
                        <strong>CONTACT:</strong>
                        <p>Legal: legal@mphaven.com | Privacy: privacy@mphaven.com | Support: support@mphaven.com</p>
                    </div>
                </div>
            </div>

            <!-- ========== CONTINUE BUTTON ========== -->
            <div class="btn-group">
                <a id="continueBtn" class="btn btn-disabled">Continue to MPHaven</a>
                <button class="btn btn-secondary" onclick="goBack()">‚Üê Go Back</button>
            </div>

            <div class="footer">
                <p>By continuing, you agree to our 
                    <a href="terms.html" target="_blank">Terms of Service</a>, 
                    <a href="privacy.html" target="_blank">Privacy Policy</a>, and 
                    <a href="disclaimer.html" target="_blank">Legal Disclaimer</a>.
                </p>
                <p style="margin-top: 0.5rem; font-size: 0.65rem; color: var(--text-dim);">
                    ¬© 2026 MPHaven. Version 3.0 | Last updated: February 2026
                </p>
            </div>
        </div>
    </div>

    <script>
    (function() {
        'use strict';
        
        const DISCLAIMER_VERSION = '3.0'; // Update when terms change
        
        // ========== STATE MANAGEMENT ==========
        let crisisCheckPassed = false;
        let allAcknowledged = false;
        
        // DOM Elements
        const continueBtn = document.getElementById('continueBtn');
        const disclaimerSection = document.getElementById('disclaimerSection');
        const acknowledgmentsSection = document.getElementById('acknowledgmentsSection');
        const legalToggle = document.getElementById('legalToggle');
        const crisisResources = document.getElementById('crisisResources');
        
        const dot1 = document.getElementById('dot1');
        const dot2 = document.getElementById('dot2');
        const dot3 = document.getElementById('dot3');
        
        // ========== REMOVED AUTO-REDIRECT ==========
        // Users must interact with the page first
        // No more automatic redirects that cause history warnings
        
        // ========== CHECK PREVIOUS ACKNOWLEDGMENT (BUT DON'T AUTO-REDIRECT) ==========
        const acknowledged = localStorage.getItem('mphaven_disclaimer_acknowledged');
        const version = localStorage.getItem('mphaven_disclaimer_version');
        const crisisPassed = localStorage.getItem('mphaven_crisis_check_passed');
        
        // If previously acknowledged with same version, show a banner or pre-fill? 
        // But DON'T auto-redirect - let them click through again if they want
        if (acknowledged === 'true' && version === DISCLAIMER_VERSION && crisisPassed === 'true') {
            // Optionally pre-select the "No" crisis option and checkboxes
            // But don't auto-redirect - user must click Continue
            console.log('Previously acknowledged (v' + version + ') - pre-filling form');
            
            // Pre-select "No" for crisis
            setTimeout(() => {
                const noRadio = document.getElementById('crisisNo');
                if (noRadio) {
                    noRadio.checked = true;
                    selectCrisis('no', true); // true = silent mode (no scroll)
                }
                
                // Pre-check all boxes
                for (let i = 1; i <= 4; i++) {
                    const check = document.getElementById(`check${i}`);
                    if (check) {
                        check.checked = true;
                        updateAckState(`ack${i}`, `check${i}`);
                    }
                }
            }, 100);
        } else if (acknowledged === 'true' && version !== DISCLAIMER_VERSION) {
            // Version changed - clear old data
            console.log('Disclaimer version changed - re-acknowledgment required');
            clearDisclaimerData();
        }
        
        // Initialize progress
        dot1.classList.add('active');
        
        // ========== CRISIS CHECK ==========
        window.selectCrisis = function(answer, silent = false) {
            const yesOption = document.querySelector('.crisis-option:first-child');
            const noOption = document.querySelector('.crisis-option:last-child');
            const yesRadio = document.getElementById('crisisYes');
            const noRadio = document.getElementById('crisisNo');
            
            // Clear previous selections
            yesOption.classList.remove('selected', 'blocked');
            noOption.classList.remove('selected', 'blocked');
            
            if (answer === 'yes') {
                yesRadio.checked = true;
                yesOption.classList.add('blocked');
                crisisResources.classList.add('show');
                crisisCheckPassed = false;
                
                // Hide continue sections
                disclaimerSection.style.display = 'none';
                acknowledgmentsSection.style.display = 'none';
                legalToggle.style.display = 'none';
                continueBtn.classList.add('btn-disabled');
                
                // Update progress
                dot1.classList.add('active');
                dot2.classList.remove('active');
                dot3.classList.remove('active');
                
            } else if (answer === 'no') {
                noRadio.checked = true;
                noOption.classList.add('selected');
                crisisResources.classList.remove('show');
                crisisCheckPassed = true;
                
                // Show disclaimer section
                disclaimerSection.style.display = 'block';
                acknowledgmentsSection.style.display = 'block';
                legalToggle.style.display = 'flex';
                
                // Update progress
                dot1.classList.remove('active');
                dot2.classList.add('active');
                
                // Only scroll if not silent (skip on auto-fill)
                if (!silent) {
                    disclaimerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                
                checkAllComplete();
            }
        };
        
        // ========== ACKNOWLEDGMENT CHECKBOXES ==========
        window.updateAckState = function(ackId, checkId) {
            const ackItem = document.getElementById(ackId);
            const checkbox = document.getElementById(checkId);
            
            if (checkbox.checked) {
                ackItem.classList.add('checked');
            } else {
                ackItem.classList.remove('checked');
            }
            
            checkAllComplete();
        };
        
        // ========== CHECK IF ALL COMPLETE ==========
        function checkAllComplete() {
            const check1 = document.getElementById('check1')?.checked;
            const check2 = document.getElementById('check2')?.checked;
            const check3 = document.getElementById('check3')?.checked;
            const check4 = document.getElementById('check4')?.checked;
            
            allAcknowledged = check1 && check2 && check3 && check4;
            
            if (crisisCheckPassed && allAcknowledged) {
                continueBtn.classList.remove('btn-disabled');
                continueBtn.classList.add('btn-primary');
                continueBtn.style.cursor = 'pointer';
                
                // Update progress
                dot2.classList.remove('active');
                dot3.classList.add('active');
            } else {
                continueBtn.classList.add('btn-disabled');
                continueBtn.classList.remove('btn-primary');
                continueBtn.style.cursor = 'not-allowed';
            }
        }
        
        // ========== TOGGLE LEGAL TEXT ==========
        window.toggleLegal = function() {
            const legalFull = document.getElementById('legalFull');
            const toggle = document.getElementById('legalToggle');
            
            if (legalFull.classList.contains('expanded')) {
                legalFull.classList.remove('expanded');
                toggle.classList.remove('expanded');
            } else {
                legalFull.classList.add('expanded');
                toggle.classList.add('expanded');
                
                // Scroll to legal section
                setTimeout(() => {
                    toggle.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        };
        
        // ========== CONTINUE BUTTON ==========
        continueBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (!crisisCheckPassed) {
                alert('Please complete the crisis safety check before continuing.');
                return;
            }
            
            if (!allAcknowledged) {
                alert('Please check all acknowledgment boxes to continue.');
                return;
            }
            
            // Save to localStorage (NO EXPIRY - only version-based)
            const now = new Date().toISOString();
            localStorage.setItem('mphaven_disclaimer_acknowledged', 'true');
            localStorage.setItem('mphaven_disclaimer_timestamp', now);
            localStorage.setItem('mphaven_disclaimer_version', DISCLAIMER_VERSION);
            localStorage.setItem('mphaven_crisis_check_passed', 'true');
            localStorage.setItem('mphaven_disclaimer_useragent', navigator.userAgent);
            
            console.log('Disclaimer acknowledged - version ' + DISCLAIMER_VERSION);
            
            // Redirect to app (this is USER-INITIATED via button click - safe!)
            window.location.href = 'app.html';
        });
        
        // ========== HELPER FUNCTIONS ==========
        function clearDisclaimerData() {
            localStorage.removeItem('mphaven_disclaimer_acknowledged');
            localStorage.removeItem('mphaven_disclaimer_timestamp');
            localStorage.removeItem('mphaven_disclaimer_version');
            localStorage.removeItem('mphaven_crisis_check_passed');
        }
        
    })();
    
    // ========== NAVIGATION ==========
    function goBack() {
        const referrer = document.referrer;
        if (referrer && (referrer.includes('signup.html') || referrer.includes('login.html') || referrer.includes('index.html'))) {
            window.location.href = referrer;
        } else {
            window.location.href = 'index.html';
        }
    }
    
    window.goBack = goBack;
    </script>
</body>
</html>
