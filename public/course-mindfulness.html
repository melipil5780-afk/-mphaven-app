<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>MPHaven - Mindfulness</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* BACKGROUNDS & NEUTRALS - EXACT MATCH */
            --bg-dark: #0f172a;
            --bg-card: rgba(15, 23, 42, 0.98);
            --bg-card-light: rgba(30, 41, 59, 0.65);
            --bg-card-dark: rgba(15, 23, 42, 0.45);
            --border-subtle: rgba(30, 41, 59, 0.5);
            --border-softer: rgba(51, 65, 85, 0.4);
            
            /* PRIMARY COLORS - EXACT MATCH */
            --primary-teal: #0e7490;
            --primary-teal-dark: #0c627a;
            --accent-amber: #d97706;
            --accent-amber-dark: #b45309;
            
            /* TEXT COLORS - EXACT MATCH */
            --text-primary: rgb(241, 245, 249);
            --text-secondary: rgb(203, 213, 225);
            --text-muted: rgb(148, 163, 184);
            --text-dim: rgb(100, 116, 139);
            --text-teal-light: rgb(165, 243, 252);
            --text-teal: rgb(94, 234, 212);
            --text-amber-light: rgb(253, 230, 138);
            --text-amber: rgb(251, 191, 36);
            
            /* SUCCESS - EXACT MATCH */
            --success-emerald: rgb(74, 222, 128);
            --success-bg: rgba(34, 197, 94, 0.12);
            
            /* GRADIENTS - EXACT MATCH */
            --gradient-main: linear-gradient(135deg, #0e7490, #d97706);
            --gradient-subtle: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.10));
            --gradient-success: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(21,128,61,0.08));
            
            /* SHADOWS - EXACT MATCH */
            --shadow-card: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;-webkit-font-smoothing:antialiased}html,body{width:100%;height:100%;overflow:hidden;position:fixed;overscroll-behavior:none}body{background:var(--bg-dark);touch-action:pan-y}.container{width:100%;height:100vh;height:100dvh;display:flex;flex-direction:column}.app-wrapper{width:100%;max-width:28rem;height:100%;margin:0 auto;background:var(--bg-card);backdrop-filter:blur(40px);display:flex;flex-direction:column;position:relative}.bg-blur-1{position:absolute;top:-5%;left:50%;transform:translateX(-50%);width:22rem;height:22rem;background:rgba(14,116,144,0.08);border-radius:50%;filter:blur(140px);pointer-events:none;z-index:0;opacity:0.6}.bg-blur-2{position:absolute;bottom:-5%;right:-5%;width:18rem;height:18rem;background:rgba(217,119,6,0.08);border-radius:50%;filter:blur(140px);pointer-events:none;z-index:0;opacity:0.6}.main-content{flex:1;overflow-y:auto;overflow-x:hidden;position:relative;z-index:1;-ms-overflow-style:none;scrollbar-width:none;scroll-behavior:smooth;-webkit-overflow-scrolling:touch}.main-content::-webkit-scrollbar{display:none}.content-wrapper{padding:1.5rem;padding-bottom:2rem;min-height:100%}.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(100px);background:rgba(30,41,59,0.95);border:1px solid rgba(14,116,144,0.3);border-radius:0.75rem;padding:1rem 1.5rem;color:white;font-weight:600;z-index:10000;opacity:0;transition:all 0.3s ease;backdrop-filter:blur(10px);box-shadow:0 10px 25px rgba(0,0,0,0.3);max-width:90%;text-align:center}.toast.show{transform:translateX(-50%) translateY(0);opacity:1}@keyframes gentleFadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-in{animation:gentleFadeIn 0.35s ease-out}
        
        /* CARD STYLES - USING YOUR EXACT COLORS */
        .module-card{
            background:linear-gradient(135deg, var(--bg-card-light), var(--bg-card-dark));
            border:1px solid var(--border-softer);
            border-radius:1.25rem;
            padding:1.5rem;
            margin-bottom:1rem;
            cursor:pointer;
            transition:all 0.3s;
            display:block;
            width:100%;
            -webkit-tap-highlight-color:transparent;
            box-shadow: var(--shadow-card);
        }
        .module-card:active{transform:scale(0.98)}
        .module-card:hover{border-color:rgba(var(--primary-teal),0.5)}
        
        /* RECOMMENDED MODULE - USING YOUR GRADIENT */
        .module-card.card-recommended {
            border:2px solid rgba(var(--primary-teal),0.5);
            background: var(--gradient-subtle);
            box-shadow: 0 4px 20px rgba(14,116,144,0.15);
        }

        /* AVAILABLE MODULES - SUBTLE DIM */
        .module-card.card-available {
            opacity: 0.9;
            border-color: rgba(var(--text-dim),0.3);
        }
        
        /* MODULE ICON - MATCHING YOUR STYLE */
        .module-icon{
            width:3.5rem;
            height:3.5rem;
            border-radius:1rem;
            background:var(--gradient-subtle);
            display:flex;
            align-items:center;
            justify-content:center;
            margin-bottom:1rem;
            font-size:1.5rem
        }
        
        /* TEXT STYLES - EXACT MATCH */
        .module-title{
            color:var(--text-primary);
            font-size:1.5rem;
            font-weight:700;
            margin-bottom:0.5rem
        }
        .module-tagline{
            color:var(--text-secondary);
            font-size:0.875rem;
            margin-bottom:1rem
        }
        .module-description{
            color:var(--text-muted);
            font-size:0.8125rem;
            line-height:1.4;
            margin-bottom:1.25rem
        }
        
        /* STATUS BADGES - PERFECTLY MATCHING YOUR PALETTE */
        .status-badge{
            padding:0.25rem 0.75rem;
            border-radius:9999px;
            font-size:0.75rem;
            font-weight:600;
            letter-spacing:0.05em;
            text-transform:uppercase;
        }
        
        /* COMPLETED: Using your success emerald */
        .status-completed{
            background:var(--success-bg);
            color:var(--success-emerald);
            border:1px solid rgba(34,197,94,0.25);
        }
        
        /* RECOMMENDED: Using your primary gradient */
        .status-recommended{
            background: var(--gradient-subtle);
            color:var(--text-teal-light);
            border:1px solid rgba(var(--primary-teal),0.35);
        }
        
        /* AVAILABLE: Using your muted palette */
        .status-available{
            background:rgba(var(--text-muted),0.15);
            color:var(--text-muted);
            border:1px solid rgba(var(--text-muted),0.3);
        }
        
        /* HEADER - MATCHING YOUR STYLE */
        .header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:1.5rem;
            padding-bottom:1rem;
            border-bottom:1px solid var(--border-subtle)
        }
        
        /* PROGRESS CIRCLE - USING YOUR GRADIENT */
        .progress-circle{
            width:2.5rem;
            height:2.5rem;
            border-radius:50%;
            background: var(--gradient-subtle);
            color:var(--text-primary);
            font-size:0.875rem;
            font-weight:600;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        
        /* SKILL HEADER - LIKE YOUR OBSERVE MODULE */
        .skill-header{
            background: var(--gradient-main);
            padding: 1.5rem;
            border-radius: 1.25rem;
            margin-bottom: 1rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(14,116,144,0.2);
        }
        
        /* SUCCESS MESSAGE - MATCHING YOUR STYLE */
        .success-message{
            background: var(--gradient-success);
            border: 1px solid rgba(34,197,94,0.35);
            padding: 1rem;
            margin-top: 0.5rem;
            text-align: center;
            border-radius: 0.75rem;
        }
        .success-message p{
            color: var(--success-emerald);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* INFO BOX - MATCHING YOUR PALETTE */
        .info-box{
            background: var(--gradient-subtle);
            border: 1px solid rgba(var(--primary-teal),0.25);
            border-radius: 1rem;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .info-box p{
            color: var(--text-teal-light);
            font-size: 0.875rem;
        }
        
        /* BACK BUTTON - MATCHING YOUR STYLE */
        .back-button{
            padding:0.75rem 1.5rem;
            background:rgba(var(--bg-card-light),0.5);
            border:1px solid var(--border-softer);
            border-radius:0.75rem;
            color:var(--text-muted);
            font-size:0.875rem;
            cursor:pointer;
            width:100%;
            text-align:center;
        }
        .back-button:hover{
            background:rgba(var(--bg-card-light),0.7);
            border-color:rgba(var(--primary-teal),0.3);
        }
        
        @media (min-width:640px){
            .app-wrapper{border-radius:2.5rem;height:844px}
            .container{padding:2rem;align-items:center;justify-content:center}
        }
        @media (max-width:380px){
            .content-wrapper{padding:1rem}
            .module-icon{width:3rem;height:3rem;font-size:1.25rem}
            .module-title{font-size:1.25rem}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-wrapper">
            <div class="bg-blur-1"></div>
            <div class="bg-blur-2"></div>
            
            <div id="mainContent" class="main-content"></div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>

    <script>
        // ===== STATE =====
        let state = {
            completedModules: [],
            lastActivity: null,
            showIntro: true
        };

        // ===== 8 MINDFULNESS MODULES =====
        const modules = [
            { 
                id: 'introduction', 
                name: 'GETTING STARTED', 
                icon: 'üåü', 
                tagline: 'Begin your awareness journey', 
                description: 'Learn what mindful awareness is, how it helps, and how to use these modules.',
                learnUrl: 'module-introduction.html',
                duration: '5 min',
                required: true
            },
            { 
                id: 'notice', 
                name: 'NOTICE', 
                icon: 'üëÅÔ∏è', 
                tagline: 'See thoughts like passing clouds', 
                description: 'Become aware of sensations, thoughts, and emotions without getting pulled in.',
                learnUrl: 'module-notice.html', 
                duration: '10 min',
                dependsOn: 'introduction'
            },
            { 
                id: 'label', 
                name: 'LABEL', 
                icon: 'üìù', 
                tagline: 'Name what you notice clearly', 
                description: 'Put simple words to your experience using facts, without adding judgment.',
                learnUrl: 'module-label.html', 
                duration: '8 min',
                dependsOn: 'notice'
            },
            { 
                id: 'engage', 
                name: 'ENGAGE', 
                icon: 'üåø', 
                tagline: 'Be fully in the moment', 
                description: 'Dive completely into what you\'re doing, letting go of self-consciousness.',
                learnUrl: 'module-engage.html', 
                duration: '12 min',
                dependsOn: 'label'
            },
            { 
                id: 'accept', 
                name: 'ACCEPT', 
                icon: '‚öñÔ∏è', 
                tagline: 'Let go of good/bad labels', 
                description: 'Observe experiences without labeling them as right, wrong, good, or bad.',
                learnUrl: 'module-accept.html', 
                duration: '15 min',
                dependsOn: 'engage'
            },
            { 
                id: 'focus', 
                name: 'FOCUS', 
                icon: 'üéØ', 
                tagline: 'One thing at a time', 
                description: 'Give your full attention to one task. Gently return when the mind wanders.',
                learnUrl: 'module-focus.html', 
                duration: '10 min',
                dependsOn: 'accept'
            },
            { 
                id: 'actwisely', 
                name: 'ACT WISELY', 
                icon: '‚úÖ', 
                tagline: 'Choose what truly works', 
                description: 'Do what helps reach your goals, even if it doesn\'t feel fair or right.',
                learnUrl: 'module-actwisely.html', 
                duration: '12 min',
                dependsOn: 'focus'
            },
            { 
                id: 'checkin', 
                name: 'CHECK-IN', 
                icon: 'üß†', 
                tagline: 'Know your state', 
                description: 'Pause and notice your current emotional, mental, and physical state.',
                learnUrl: 'module-checkin.html', 
                duration: '8 min',
                dependsOn: 'actwisely'
            }
        ];

        // ===== NAVIGATION =====
        
        function startModule(moduleId) {
            const module = modules.find(m => m.id === moduleId);
            if (!module) return;
            
            // Send data to module
            localStorage.setItem('currentModule', JSON.stringify({
                moduleId: moduleId,
                moduleName: module.name,
                timestamp: new Date().toISOString(),
                userProgress: state.completedModules.includes(moduleId) ? 100 : 0,
                fromApp: 'mindfulness-course'
            }));
            
            // Navigate to module
            window.location.href = module.learnUrl;
        }
        
        function checkModuleCompletion() {
            const completed = localStorage.getItem('moduleCompleted');
            if (completed) {
                try {
                    const data = JSON.parse(completed);
                    let moduleId = data.moduleId;
                    
                    const idMap = {
                        'observe': 'notice',
                        'describe': 'label',
                        'participate': 'engage',
                        'nonjudgment': 'accept',
                        'onemindfully': 'focus',
                        'effectively': 'actwisely'
                    };
                    
                    if (idMap[moduleId]) {
                        moduleId = idMap[moduleId];
                    }
                    
                    if (moduleId && data.completed) {
                        if (!state.completedModules.includes(moduleId)) {
                            state.completedModules.push(moduleId);
                        }
                        
                        state.lastActivity = new Date().toISOString();
                        state.showIntro = false;
                        
                        saveState();
                        syncWithMainApp();
                        
                        const module = modules.find(m => m.id === moduleId);
                        showToast(`${module ? module.name : 'Module'} completed! ‚ú®`);
                        
                        localStorage.removeItem('moduleCompleted');
                        
                        if (data.journalPrompts) {
                            localStorage.setItem('modulePrompts', JSON.stringify(data.journalPrompts));
                            showToast("Reflection prompts added to your journal üìù");
                        }
                        
                        render();
                    }
                } catch (e) {
                    console.error('Error:', e);
                }
            }
        }
        
        function syncWithMainApp() {
            try {
                let mainState = {};
                const existing = localStorage.getItem('mphaven_state');
                if (existing) {
                    mainState = JSON.parse(existing);
                }
                
                if (!mainState.mindfulnessProgress) {
                    mainState.mindfulnessProgress = {};
                }
                
                modules.forEach(module => {
                    mainState.mindfulnessProgress[module.id] = {
                        completed: state.completedModules.includes(module.id),
                        lastPracticed: state.lastActivity,
                        name: module.name,
                        tagline: module.tagline
                    };
                });
                
                localStorage.setItem('mphaven_state', JSON.stringify(mainState));
                
            } catch (e) {
                console.error('Sync error:', e);
            }
        }
        
        function loadFromMainApp() {
            try {
                const mainState = localStorage.getItem('mphaven_state');
                if (mainState) {
                    const data = JSON.parse(mainState);
                    
                    if (data.mindfulnessProgress) {
                        Object.keys(data.mindfulnessProgress).forEach(moduleId => {
                            if (data.mindfulnessProgress[moduleId].completed) {
                                if (!state.completedModules.includes(moduleId)) {
                                    state.completedModules.push(moduleId);
                                }
                            }
                        });
                        
                        if (state.completedModules.length > 0) {
                            state.showIntro = false;
                        }
                    }
                }
            } catch (e) {
                console.log('No main app data found');
            }
        }

        // ===== UI FUNCTIONS =====
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function getModuleStatus(module) {
            if (state.completedModules.includes(module.id)) {
                return { type: 'completed', text: 'COMPLETED', cardClass: '' };
            }
            
            if (!module.dependsOn) {
                return { type: 'recommended', text: 'RECOMMENDED', cardClass: 'card-recommended' };
            }
            
            if (state.completedModules.includes(module.dependsOn)) {
                return { type: 'recommended', text: 'RECOMMENDED', cardClass: 'card-recommended' };
            }
            
            return { type: 'available', text: 'AVAILABLE', cardClass: 'card-available' };
        }

        // ===== RENDER FUNCTION =====
        function render() {
            const completedCount = state.completedModules.length;
            const totalModules = modules.length;
            const progressPercent = Math.round((completedCount / totalModules) * 100);
            
            const visibleModules = modules.filter(module => 
                !(module.id === 'introduction' && !state.showIntro)
            );
            
            const content = document.getElementById('mainContent');
            content.innerHTML = `
                <div class="content-wrapper fade-in">
                    <div class="header">
                        <div>
                            <h1 style="color:var(--text-primary);font-size:1.5rem;font-weight:700">Mindfulness</h1>
                            <p style="color:var(--text-muted);font-size:0.875rem">
                                ${completedCount}/${totalModules} modules completed
                            </p>
                        </div>
                        <div class="progress-circle">
                            ${progressPercent}%
                        </div>
                    </div>
                    
                    ${state.showIntro ? `
                        <div class="info-box">
                            <p>Follow the recommended path or choose what you need right now</p>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top:0.5rem">
                        ${visibleModules.map(module => {
                            const status = getModuleStatus(module);
                            
                            return `
                                <button onclick="startModule('${module.id}')" 
                                        class="module-card ${status.cardClass}">
                                    <div class="module-icon">${module.icon}</div>
                                    <div class="module-title">${module.name}</div>
                                    <div class="module-tagline">${module.tagline}</div>
                                    <div class="module-description">${module.description}</div>
                                    
                                    <div style="display:flex;justify-content:space-between;align-items:center">
                                        <div style="color:var(--text-muted);font-size:0.75rem">
                                            ${module.duration}
                                        </div>
                                        <div class="status-badge status-${status.type}">
                                            ${status.text}
                                        </div>
                                    </div>
                                </button>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top:2rem;text-align:center">
                        <button onclick="window.location.href='index.html'" class="back-button">
                            ‚Üê Back to Main App
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== STATE MANAGEMENT =====
        function saveState() {
            localStorage.setItem('mindfulness_state', JSON.stringify(state));
            syncWithMainApp();
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('mindfulness_state');
                if (saved) {
                    const data = JSON.parse(saved);
                    state.completedModules = data.completedModules || [];
                    state.lastActivity = data.lastActivity;
                    state.showIntro = data.showIntro !== false;
                }
            } catch (e) {
                console.log('Starting fresh');
            }
        }

        // ===== INITIALIZATION =====
        function init() {
            loadState();
            loadFromMainApp();
            checkModuleCompletion();
            render();
        }

        init();
    </script>
</body>
</html>
