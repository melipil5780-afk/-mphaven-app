<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#020617">
    <title>MPHaven</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: #020617;
        }

        .container {
            width: 100%;
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        .app-wrapper {
            width: 100%;
            max-width: 28rem;
            height: 100%;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(40px);
            display: flex;
            flex-direction: column;
            border-left: 1px solid rgba(30, 41, 59, 0.5);
            border-right: 1px solid rgba(30, 41, 59, 0.5);
        }

        .bg-blur-1, .bg-blur-2 {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            pointer-events: none;
        }
        
        .bg-blur-1 {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24rem;
            height: 24rem;
            background: rgba(147, 51, 234, 0.1);
        }
        
        .bg-blur-2 {
            bottom: 0;
            right: 0;
            width: 20rem;
            height: 20rem;
            background: rgba(6, 182, 212, 0.1);
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .main-content::-webkit-scrollbar { display: none; }

        .nav-bar {
            border-top: 1px solid rgba(30, 41, 59, 0.5);
            background: rgba(15, 23, 42, 0.98);
            padding: 0.75rem 0 calc(0.75rem + env(safe-area-inset-bottom));
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            max-width: 28rem;
            margin: 0 auto;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            min-height: 60px;
            position: relative;
        }

        .nav-indicator {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2.5rem;
            height: 3px;
            background: linear-gradient(to right, #a855f7, #06b6d4);
            border-radius: 9999px;
            transition: opacity 0.2s ease;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            stroke-width: 2;
            transition: all 0.2s ease;
        }

        .nav-icon.active { 
            color: white; 
            opacity: 1;
            transform: translateY(-2px);
        }

        .nav-icon.inactive { 
            color: rgba(100, 116, 139, 0.7); 
            opacity: 0.7;
        }

        .nav-label {
            font-size: 0.6875rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .nav-label.active { 
            color: white; 
            opacity: 1;
        }

        .nav-label.inactive { 
            color: rgba(100, 116, 139, 0.7); 
            opacity: 0.7;
        }

        .content-wrapper {
            padding: max(1rem, env(safe-area-inset-top)) 1.25rem 2rem 1.25rem;
        }

        .card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.2));
            border: 1px solid rgba(51, 65, 85, 0.4);
            border-radius: 1.25rem;
        }

        .skill-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(6, 182, 212, 0.05));
            border: 1px solid rgba(168, 85, 247, 0.25);
        }

        .practice-timer {
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            font-size: 3rem;
            font-weight: 300;
            color: white;
            text-align: center;
            letter-spacing: 0.05em;
        }

        .prompt-chip {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 9999px;
            color: rgb(216, 180, 254);
            font-size: 0.875rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .prompt-chip:hover {
            background: rgba(168, 85, 247, 0.2);
            transform: translateY(-1px);
        }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            color: white;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.35s ease-out; }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.25rem;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 1.5rem;
            padding: 1.75rem;
            max-width: 22rem;
            width: 100%;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        @media (min-width: 640px) {
            .app-wrapper {
                border-radius: 2.5rem;
                height: 844px;
                margin-top: 2rem;
                margin-bottom: 2rem;
            }
            .container {
                padding: 0 1rem;
                align-items: center;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-wrapper">
            <div class="bg-blur-1"></div>
            <div class="bg-blur-2"></div>

            <div id="mainContent" class="main-content"></div>

            <div class="nav-bar">
                <div class="nav-container">
                    <button onclick="switchTab('learn')" class="nav-btn" data-tab="learn">
                        <div class="nav-indicator" style="opacity: 1;"></div>
                        <svg class="nav-icon active" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                        <span class="nav-label active">Learn</span>
                    </button>
                    
                    <button onclick="switchTab('practice')" class="nav-btn" data-tab="practice">
                        <div class="nav-indicator" style="opacity: 0;"></div>
                        <svg class="nav-icon inactive" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="nav-label inactive">Practice</span>
                    </button>
                    
                    <button onclick="switchTab('notes')" class="nav-btn" data-tab="notes">
                        <div class="nav-indicator" style="opacity: 0;"></div>
                        <svg class="nav-icon inactive" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        <span class="nav-label inactive">Notes</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // ===== STATE =====
        let state = {
            currentTab: 'learn',
            currentSkill: 'observe',
            sessionNotes: ''
        };

        const skills = [
            { 
                id: 'observe', 
                name: 'OBSERVE', 
                icon: 'ðŸ‘ï¸', 
                tagline: 'Watch thoughts like clouds', 
                description: 'Notice sensations, thoughts, and emotions without getting caught in them.',
                why: 'Awareness is the foundation of choice.'
            },
            { 
                id: 'describe', 
                name: 'DESCRIBE', 
                icon: 'ðŸ“', 
                tagline: 'Facts over stories', 
                description: 'Put words to what you observe using only facts, not interpretations.',
                why: 'Language shapes how we experience reality.'
            },
            { 
                id: 'participate', 
                name: 'PARTICIPATE', 
                icon: 'ðŸŒ¿', 
                tagline: 'Be fully present', 
                description: 'Engage completely in what you\'re doing. Drop self-consciousness.',
                why: 'Life happens when you\'re not watching yourself.'
            },
            { 
                id: 'nonjudgment', 
                name: 'NONJUDGE', 
                icon: 'âš–ï¸', 
                tagline: 'Drop the labels', 
                description: 'Let go of evaluating things as good/bad, right/wrong.',
                why: 'Judgment creates unnecessary suffering.'
            },
            { 
                id: 'onemindfully', 
                name: 'ONE-MINDFULLY', 
                icon: 'ðŸŽ¯', 
                tagline: 'One thing at a time', 
                description: 'Focus on one thing completely. When your mind wanders, gently bring it back.',
                why: 'Presence deepens everything.'
            },
            { 
                id: 'effectively', 
                name: 'EFFECTIVELY', 
                icon: 'âœ…', 
                tagline: 'Do what works', 
                description: 'Focus on what actually works, not what should work or what feels fair.',
                why: 'Being right doesn\'t always help.'
            },
            { 
                id: 'checkin', 
                name: 'CHECK-IN', 
                icon: 'ðŸ§ ', 
                tagline: 'Know your state', 
                description: 'Pause and notice your current emotional, mental, and physical state.',
                why: 'You can\'t shift what you don\'t notice.'
            }
        ];

        // Practice prompts
        const practicePrompts = [
            "Notice three things you can see without naming them.",
            "Watch a thought arise and pass without following it.",
            "What sensations are present in your body right now?",
            "Notice your breath without changing it.",
            "What sounds are happening in the background?",
            "Describe your current emotion using neutral words.",
            "Name what you feel without explaining why.",
            "Put words to your body sensations.",
            "Fully engage in what you are doing for the next minute.",
            "Drop awareness into the body and move naturally.",
            "Notice judgments and label them as 'judging'.",
            "Describe what is happening without good or bad.",
            "Do one thing at a time for the next minute.",
            "Bring attention back when it wanders.",
            "What action works best right now?",
            "Choose effectiveness over being right."
        ];

        // Reflection prompts (for after practice journaling)
        const reflectionPrompts = [
            "What did you notice during your practice?",
            "What emotions or thoughts came up?",
            "How did your body feel during the practice?",
            "What was challenging? What was easy?",
            "How do you feel now compared to before?",
            "What insights emerged?",
            "What patterns did you observe?",
            "How can you bring this awareness into your day?",
            "What would help you practice more consistently?",
            "What resistance did you feel, if any?",
            "What moment felt most present?",
            "How did your mind respond to the practice?",
            "What would you like to explore next time?",
            "What feels different in your body now?",
            "What thought patterns repeated?",
            "What felt new or surprising?"
        ];

        // ===== TIMER =====
        let timerInterval = null;
        let timerSeconds = 0;
        let timerRunning = false;

        function startTimer() {
            if (timerRunning) return;
            timerRunning = true;
            timerSeconds = 0;
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
            render();
        }

        function stopTimer() {
            if (!timerRunning) return;
            timerRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            const finalTime = timerSeconds;
            timerSeconds = 0;
            updateTimerDisplay();
            
            // Show option to go to journal AFTER stopping
            if (finalTime >= 30) {
                showModal(`
                    <div style="text-align:center">
                        <div style="font-size:3rem;margin-bottom:1rem">âœ¨</div>
                        <h2 style="color:white;font-size:1.25rem;font-weight:bold;margin-bottom:0.75rem">${formatTime(finalTime)} of mindfulness</h2>
                        <p style="color:rgb(148,163,184);font-size:0.875rem;margin-bottom:1.25rem">Ready to reflect on your practice?</p>
                        <button onclick="closeModal();switchTab('notes')" style="width:100%;padding:0.875rem;border-radius:0.75rem;background:linear-gradient(to right,#a855f7,#06b6d4);color:white;font-weight:bold;border:none;font-size:0.9375rem;margin-bottom:0.5rem">Go to Journal</button>
                        <button onclick="closeModal()" style="width:100%;padding:0.75rem;border-radius:0.75rem;background:rgba(51,65,85,0.5);color:rgb(203,213,225);font-weight:600;border:none;font-size:0.875rem">Stay Here</button>
                    </div>
                `);
            } else {
                showToast("Practice ended");
            }
            render();
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timerDisplay');
            if (display) display.textContent = formatTime(timerSeconds);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // ===== TOAST NOTIFICATION =====
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ===== EMAIL & COPY =====
        async function emailNotes() {
            const notes = state.sessionNotes.trim();
            if (!notes) {
                showToast("Write some reflections first");
                return;
            }

            const skill = skills.find(s => s.id === state.currentSkill);
            const date = new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const time = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true
            });
            
            const subject = `Mindfulness Reflections - ${date}`;
            
            const body = `MINDFULNESS REFLECTIONS
${date} at ${time}
Practice: ${skill?.name || 'Mindfulness'}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

${notes}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

From MPHaven - Simple Mindfulness Journal`;

            // Method 1: Direct mailto link
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Try to open email client
            window.location.href = mailtoLink;
            
            // Show toast notification
            setTimeout(() => {
                showToast("Email app opened");
            }, 500);
        }

        async function copyNotes() {
            const notes = state.sessionNotes.trim();
            if (!notes) {
                showToast("Write some reflections first");
                return;
            }

            const skill = skills.find(s => s.id === state.currentSkill);
            const date = new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const time = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true
            });
            
            const fullText = `MINDFULNESS REFLECTIONS
${date} at ${time}
Practice: ${skill?.name || 'Mindfulness'}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

${notes}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

From MPHaven - Simple Mindfulness Journal`;

            try {
                await navigator.clipboard.writeText(fullText);
                showToast("Copied to clipboard!");
            } catch (err) {
                // Fallback method
                const textarea = document.createElement('textarea');
                textarea.value = fullText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast("Copied to clipboard!");
            }
        }

        function downloadNotes() {
            const notes = state.sessionNotes.trim();
            if (!notes) {
                showToast("Write some reflections first");
                return;
            }

            const skill = skills.find(s => s.id === state.currentSkill);
            const date = new Date();
            const formattedDate = date.toISOString().split('T')[0];
            
            const fullText = `MINDFULNESS REFLECTIONS
Date: ${formattedDate}
Time: ${date.toLocaleTimeString()}
Practice: ${skill?.name || 'Mindfulness'}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

${notes}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

From MPHaven - Simple Mindfulness Journal
Generated on: ${new Date().toLocaleString()}`;

            // Create download link
            const blob = new Blob([fullText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `mindfulness-reflections-${formattedDate}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast("Saved as text file!");
        }

        function addPromptToNotes(prompt) {
            const textarea = document.getElementById('sessionNotes');
            if (textarea) {
                const current = textarea.value.trim();
                textarea.value = current + (current ? '\n\n' : '') + prompt + '\n';
                textarea.focus();
                // Move cursor to end
                textarea.selectionStart = textarea.value.length;
                textarea.selectionEnd = textarea.value.length;
                state.sessionNotes = textarea.value;
                saveState();
            }
        }

        function clearNotes() {
            if (state.sessionNotes.trim() && confirm('Clear all reflections?')) {
                state.sessionNotes = '';
                saveState();
                render();
                showToast("Cleared all notes");
            } else if (!state.sessionNotes.trim()) {
                showToast("Nothing to clear");
            }
        }

        // ===== STATE MANAGEMENT =====
        function saveState() { 
            localStorage.setItem('mphaven_state', JSON.stringify({
                currentTab: state.currentTab,
                currentSkill: state.currentSkill,
                sessionNotes: state.sessionNotes
            })); 
        }
        
        function loadState() {
            const saved = localStorage.getItem('mphaven_state');
            if (saved) {
                const data = JSON.parse(saved);
                state.currentTab = data.currentTab || 'learn';
                state.currentSkill = data.currentSkill || 'observe';
                state.sessionNotes = data.sessionNotes || '';
            }
        }

        function switchTab(tabName) {
            state.currentTab = tabName;
            saveState();
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const indicator = btn.querySelector('.nav-indicator');
                const icon = btn.querySelector('.nav-icon');
                const label = btn.querySelector('.nav-label');
                
                if (btn.dataset.tab === tabName) {
                    indicator.style.opacity = '1';
                    icon.classList.remove('inactive');
                    icon.classList.add('active');
                    label.classList.remove('inactive');
                    label.classList.add('active');
                } else {
                    indicator.style.opacity = '0';
                    icon.classList.remove('active');
                    icon.classList.add('inactive');
                    label.classList.remove('active');
                    label.classList.add('inactive');
                }
            });
            
            render();
        }

        function showModal(content) {
            const modal = document.createElement('div');
            modal.id = 'modal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `<div class="modal-content">${content}</div>`;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            if (modal) modal.remove();
        }

        function selectSkill(skillId) {
            state.currentSkill = skillId;
            saveState();
            switchTab('practice');
        }

        // ===== RENDER FUNCTIONS =====
        function renderLearn() {
            return `
                <div class="content-wrapper fade-in">
                    <div style="margin-bottom:1.5rem">
                        <h2 style="color:white;font-size:1.75rem;font-weight:300;margin-bottom:0.5rem">Mindfulness Skills</h2>
                        <p style="color:rgb(148,163,184);font-size:0.9375rem">Choose a skill to practice</p>
                    </div>

                    <div style="display:flex;flex-direction:column;gap:1rem">
                        ${skills.map(skill => `
                            <button onclick="selectSkill('${skill.id}')" class="card skill-card" style="width:100%;text-align:left;padding:1.25rem;border:none;cursor:pointer;transition:transform 0.2s ease">
                                <div style="display:flex;align-items:start;gap:1rem">
                                    <div style="width:3.5rem;height:3.5rem;border-radius:1rem;background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(6,182,212,0.1));display:flex;align-items:center;justify-content:center;flex-shrink:0">
                                        <span style="font-size:1.75rem">${skill.icon}</span>
                                    </div>
                                    <div style="flex:1;min-width:0">
                                        <h4 style="color:white;font-weight:bold;font-size:1rem;margin-bottom:0.375rem">${skill.name}</h4>
                                        <p style="color:rgb(203,213,225);font-size:0.875rem;margin-bottom:0.5rem">${skill.tagline}</p>
                                        <p style="color:rgb(148,163,184);font-size:0.8125rem;font-style:italic">${skill.why}</p>
                                    </div>
                                </div>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderPractice() {
            const skill = skills.find(s => s.id === state.currentSkill);
            const todayPrompt = practicePrompts[Math.floor(Math.random() * practicePrompts.length)];
            
            return `
                <div class="content-wrapper fade-in">
                    <div style="margin-bottom:1.25rem">
                        <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:0.75rem">
                            <div style="width:3rem;height:3rem;border-radius:0.875rem;background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(6,182,212,0.1));display:flex;align-items:center;justify-content:center">
                                <span style="font-size:1.5rem">${skill.icon}</span>
                            </div>
                            <div>
                                <h2 style="color:white;font-size:1.5rem;font-weight:bold">${skill.name}</h2>
                                <button onclick="switchTab('learn')" style="background:none;border:none;color:rgb(148,163,184);font-size:0.8125rem;cursor:pointer;padding:0;text-decoration:underline">Change skill</button>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="padding:1.25rem;margin-bottom:1.5rem;background:linear-gradient(135deg,rgba(168,85,247,0.12),rgba(6,182,212,0.08))">
                        <p style="color:white;font-size:1rem;line-height:1.6">${todayPrompt}</p>
                    </div>

                    <div class="card" style="padding:2.5rem 1.5rem;margin-bottom:1.25rem;text-align:center">
                        <div id="timerDisplay" class="practice-timer" style="margin-bottom:1.5rem">${formatTime(timerSeconds)}</div>
                        <div style="display:flex;gap:0.75rem">
                            ${!timerRunning ? `
                                <button onclick="startTimer()" style="flex:1;padding:1rem;border-radius:0.875rem;background:linear-gradient(to right,#a855f7,#06b6d4);color:white;font-weight:bold;border:none;font-size:1rem;transition:transform 0.2s ease">
                                    Start Practice
                                </button>
                            ` : `
                                <button onclick="stopTimer()" style="flex:1;padding:1rem;border-radius:0.875rem;background:rgba(239,68,68,0.2);border:2px solid rgba(239,68,68,0.4);color:rgb(252,165,165);font-weight:bold;font-size:1rem;transition:transform 0.2s ease">
                                    Stop Practice
                                </button>
                            `}
                        </div>
                    </div>

                    <div class="card" style="padding:1rem;background:linear-gradient(135deg,rgba(168,85,247,0.08),rgba(6,182,212,0.05))">
                        <p style="color:rgb(203,213,225);font-size:0.875rem;line-height:1.5">${skill.description}</p>
                    </div>
                </div>
            `;
        }

        function renderNotes() {
            const randomPrompts = [...reflectionPrompts]
                .sort(() => 0.5 - Math.random())
                .slice(0, 6);
            
            return `
                <div class="content-wrapper fade-in">
                    <div style="margin-bottom:1.25rem">
                        <h2 style="color:white;font-size:1.625rem;font-weight:bold;margin-bottom:0.5rem">Practice Reflections</h2>
                        <p style="color:rgb(148,163,184);font-size:0.875rem">Journal what you noticed</p>
                    </div>

                    <div style="margin-bottom:1rem">
                        <p style="color:rgb(148,163,184);font-size:0.875rem;margin-bottom:0.75rem">Reflection prompts:</p>
                        <div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem">
                            ${randomPrompts.map(prompt => `
                                <div onclick="addPromptToNotes('${prompt}')" class="prompt-chip">
                                    ${prompt}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card" style="padding:1rem;margin-bottom:1rem">
                        <textarea 
                            id="sessionNotes" 
                            placeholder="Write your reflections here...
                            
Or click a prompt above to start."
                            style="width:100%;background:rgba(255,255,255,0.05);border:1px solid rgba(51,65,85,0.5);border-radius:0.75rem;padding:1rem;color:white;font-size:0.9375rem;resize:vertical;min-height:300px;line-height:1.6"
                            oninput="state.sessionNotes=this.value;saveState()"
                        >${state.sessionNotes}</textarea>
                    </div>

                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.75rem;margin-bottom:1rem">
                        <button onclick="emailNotes()" style="padding:0.875rem;border-radius:0.75rem;background:rgba(168,85,247,0.2);border:1px solid rgba(168,85,247,0.3);color:rgb(192,132,252);font-weight:600;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:0.375rem;transition:transform 0.2s ease">
                            <svg style="width:1.5rem;height:1.5rem" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            <span style="font-size:0.75rem">Email</span>
                        </button>
                        
                        <button onclick="copyNotes()" style="padding:0.875rem;border-radius:0.75rem;background:rgba(6,182,212,0.2);border:1px solid rgba(6,182,212,0.3);color:rgb(103,232,249);font-weight:600;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:0.375rem;transition:transform 0.2s ease">
                            <svg style="width:1.5rem;height:1.5rem" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            <span style="font-size:0.75rem">Copy</span>
                        </button>
                        
                        <button onclick="downloadNotes()" style="padding:0.875rem;border-radius:0.75rem;background:rgba(51,65,85,0.5);border:1px solid rgba(51,65,85,0.8);color:rgb(203,213,225);font-weight:600;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:0.375rem;transition:transform 0.2s ease">
                            <svg style="width:1.5rem;height:1.5rem" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span style="font-size:0.75rem">Save</span>
                        </button>
                    </div>

                    ${state.sessionNotes.trim() ? `
                        <button onclick="clearNotes()" style="width:100%;padding:0.75rem;border-radius:0.75rem;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);color:rgb(252,165,165);font-weight:600;font-size:0.875rem;transition:transform 0.2s ease">
                            Clear All
                        </button>
                    ` : ''}
                </div>
            `;
        }

        function render() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = state.currentTab === 'learn' ? renderLearn() : 
                               state.currentTab === 'practice' ? renderPractice() : renderNotes();
            
            if (state.currentTab === 'notes') {
                const textarea = document.getElementById('sessionNotes');
                if (textarea) {
                    textarea.value = state.sessionNotes;
                }
            }
            
            content.scrollTop = 0;
        }

        // ===== INITIALIZE =====
        loadState();
        render();

        setInterval(() => {
            if (timerRunning) updateTimerDisplay();
        }, 100);
    </script>
</body>
</html>
