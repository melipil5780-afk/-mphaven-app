<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>MPHaven - Mindfulness</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* COLOR PALETTE - KEEPING YOUR EXACT COLORS */
            --bg-dark: #0f172a;
            --bg-card: rgba(15, 23, 42, 0.98);
            --bg-card-light: rgba(30, 41, 59, 0.65);
            --bg-card-dark: rgba(15, 23, 42, 0.45);
            --border-subtle: rgba(30, 41, 59, 0.5);
            --border-softer: rgba(51, 65, 85, 0.4);
            --primary-teal: #0e7490;
            --accent-amber: #d97706;
            --text-primary: rgb(241, 245, 249);
            --text-secondary: rgb(203, 213, 225);
            --text-muted: rgb(148, 163, 184);
            --text-dim: rgb(100, 116, 139);
            --text-teal-light: rgb(165, 243, 252);
            --text-amber-light: rgb(253, 230, 138);
            --success-emerald: rgb(74, 222, 128);
            --success-bg: rgba(34, 197, 94, 0.12);
            --practice-purple: rgb(196, 181, 253);
            --practice-bg: rgba(139, 92, 246, 0.12);
            --gradient-main: linear-gradient(135deg, #0e7490, #d97706);
            --gradient-subtle: linear-gradient(135deg, rgba(14,116,144,0.15), rgba(217,119,6,0.10));
        }

```
    /* ===== MOBILE-FIRST RESET ===== */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        -webkit-text-size-adjust: 100%;
        touch-action: manipulation;
    }
    
    html {
        height: 100%;
        width: 100%;
        overflow: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        width: 100%;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        min-height: 100dvh;
        overflow: hidden;
        position: fixed;
        overscroll-behavior: none;
    }
    
    /* ===== CONTAINER & WRAPPER ===== */
    .container {
        width: 100%;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    
    .app-wrapper {
        width: 100%;
        max-width: 28rem;
        height: 100vh;
        height: 100dvh;
        margin: 0 auto;
        background: var(--bg-card);
        backdrop-filter: blur(40px);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }
    
    /* ===== SAFE AREA INSETS ===== */
    @supports (padding: max(0px)) {
        .app-wrapper {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
    }
    
    /* ===== BACKGROUND EFFECTS ===== */
    .bg-blur-1, .bg-blur-2 {
        position: absolute;
        border-radius: 50%;
        filter: blur(140px);
        pointer-events: none;
        z-index: 0;
        opacity: 0.6;
    }
    
    .bg-blur-1 {
        top: -10%;
        left: 50%;
        transform: translateX(-50%);
        width: 22rem;
        height: 22rem;
        background: rgba(14, 116, 144, 0.08);
    }
    
    .bg-blur-2 {
        bottom: -10%;
        right: -10%;
        width: 18rem;
        height: 18rem;
        background: rgba(217, 119, 6, 0.08);
    }
    
    /* ===== MAIN CONTENT AREA ===== */
    .main-content {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        position: relative;
        z-index: 1;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        padding-bottom: env(safe-area-inset-bottom);
    }
    
    .main-content::-webkit-scrollbar {
        display: none;
    }
    
    /* ===== CONTENT WRAPPER ===== */
    .content-wrapper {
        padding: max(1rem, env(safe-area-inset-top)) 1rem 2rem 1rem;
        min-height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    /* ===== HEADER ===== */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-subtle);
        padding-top: 0.5rem;
    }
    
    .header h1 {
        color: var(--text-primary);
        font-size: clamp(1.25rem, 5vw, 1.5rem);
        font-weight: 700;
        line-height: 1.2;
    }
    
    .header p {
        color: var(--text-muted);
        font-size: clamp(0.75rem, 3vw, 0.875rem);
        margin-top: 0.25rem;
    }
    
    /* ===== MODULE CARDS (MOBILE OPTIMIZED) ===== */
    .module-card {
        background: linear-gradient(135deg, var(--bg-card-light), var(--bg-card-dark));
        border: 1px solid var(--border-softer);
        border-radius: 1rem;
        padding: 1.25rem;
        margin-bottom: 0.75rem;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        display: block;
        width: 100%;
        text-align: left;
        min-height: 7rem;
        position: relative;
        /* IMPORTANT: No display:none anywhere - modules always visible */
        opacity: 1;
        visibility: visible;
    }
    
    /* Tap target optimization */
    .module-card::after {
        content: '';
        position: absolute;
        top: -0.5rem;
        left: -0.5rem;
        right: -0.5rem;
        bottom: -0.5rem;
        z-index: -1;
    }
    
    /* Active state for touch feedback */
    .module-card:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
        background: linear-gradient(135deg, 
            rgba(30, 41, 59, 0.75), 
            rgba(15, 23, 42, 0.55));
    }
    
    .module-card:hover {
        border-color: rgba(14, 116, 144, 0.5);
    }
    
    /* RECOMMENDED CARD */
    .module-card.card-recommended {
        border: 2px solid rgba(14, 116, 144, 0.5);
        background: var(--gradient-subtle);
        box-shadow: 0 4px 12px rgba(14, 116, 144, 0.15);
    }
    
    .module-card.card-recommended:active {
        background: linear-gradient(135deg, 
            rgba(14, 116, 144, 0.2), 
            rgba(217, 119, 6, 0.15));
    }
    
    /* PRACTICED CARD - Gentle styling that invites return */
    .module-card.card-practiced {
        border: 1px solid rgba(139, 92, 246, 0.3);
        background: linear-gradient(135deg, 
            rgba(139, 92, 246, 0.08), 
            rgba(139, 92, 246, 0.05));
    }
    
    .module-card.card-practiced:active {
        background: linear-gradient(135deg, 
            rgba(139, 92, 246, 0.12), 
            rgba(139, 92, 246, 0.08));
    }
    
    /* AVAILABLE CARD */
    .module-card.card-available {
        opacity: 0.9;
        border-color: rgba(100, 116, 139, 0.3);
    }
    
    /* ===== MODULE CONTENT ===== */
    .module-icon {
        width: 3rem;
        height: 3rem;
        min-width: 3rem;
        border-radius: 0.75rem;
        background: var(--gradient-subtle);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.75rem;
        font-size: 1.5rem;
        flex-shrink: 0;
    }
    
    .module-title {
        color: var(--text-primary);
        font-size: clamp(1rem, 4vw, 1.25rem);
        font-weight: 700;
        margin-bottom: 0.25rem;
        line-height: 1.3;
    }
    
    .module-tagline {
        color: var(--text-secondary);
        font-size: clamp(0.75rem, 3vw, 0.8125rem);
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }
    
    .module-description {
        color: var(--text-muted);
        font-size: clamp(0.6875rem, 2.5vw, 0.75rem);
        line-height: 1.4;
        margin-bottom: 0.75rem;
    }
    
    /* ===== STATUS BADGES ===== */
    .status-badge {
        padding: 0.375rem 0.75rem;
        border-radius: 9999px;
        font-size: clamp(0.625rem, 2.5vw, 0.6875rem);
        font-weight: 600;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        min-height: 1.75rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    /* UPDATED: Changed from "completed" to "practiced" */
    .status-practiced {
        background: var(--practice-bg);
        color: var(--practice-purple);
        border: 1px solid rgba(139, 92, 246, 0.25);
    }
    
    .status-recommended {
        background: var(--gradient-subtle);
        color: var(--text-teal-light);
        border: 1px solid rgba(14, 116, 144, 0.35);
    }
    
    .status-available {
        background: rgba(148, 163, 184, 0.15);
        color: var(--text-muted);
        border: 1px solid rgba(148, 163, 184, 0.3);
    }
    
    /* ===== MODULE FOOTER ===== */
    .module-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 0.5rem;
    }
    
    .module-duration {
        color: var(--text-muted);
        font-size: clamp(0.625rem, 2.5vw, 0.6875rem);
    }
    
    /* ===== INFO BOX ===== */
    .info-box {
        background: var(--gradient-subtle);
        border: 1px solid rgba(14, 116, 144, 0.25);
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1.25rem;
        text-align: center;
    }
    
    .info-box p {
        color: var(--text-teal-light);
        font-size: clamp(0.75rem, 3vw, 0.8125rem);
        line-height: 1.4;
    }
    
    /* ===== BACK BUTTON ===== */
    .back-button {
        padding: 0.875rem;
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid var(--border-softer);
        border-radius: 0.75rem;
        color: var(--text-muted);
        font-size: clamp(0.75rem, 3vw, 0.8125rem);
        cursor: pointer;
        width: 100%;
        text-align: center;
        margin-top: 1rem;
        min-height: 3rem;
        transition: all 0.2s ease;
    }
    
    .back-button:active {
        transform: scale(0.98);
        background: rgba(30, 41, 59, 0.7);
        border-color: rgba(14, 116, 144, 0.3);
    }
    
    /* ===== TOAST ===== */
    .toast {
        position: fixed;
        bottom: max(6rem, env(safe-area-inset-bottom) + 4rem);
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(14, 116, 144, 0.3);
        border-radius: 0.75rem;
        padding: 0.875rem 1.25rem;
        color: white;
        font-weight: 600;
        z-index: 10000;
        opacity: 0;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        max-width: calc(100vw - 2rem);
        text-align: center;
        font-size: 0.875rem;
    }
    
    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
    
    /* ===== ANIMATIONS ===== */
    @keyframes gentleFadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
        animation: gentleFadeIn 0.35s ease-out;
    }
    
    /* ===== RESPONSIVE ADJUSTMENTS ===== */
    @media (max-width: 320px) {
        .content-wrapper {
            padding: max(0.75rem, env(safe-area-inset-top)) 0.75rem 1.5rem 0.75rem;
        }
        
        .module-card {
            padding: 1rem;
            min-height: 6.5rem;
        }
        
        .module-icon {
            width: 2.5rem;
            height: 2.5rem;
            font-size: 1.25rem;
        }
    }
    
    @media (min-width: 768px) {
        .app-wrapper {
            border-radius: 2rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            height: calc(100dvh - 2rem);
            max-height: 844px;
        }
        
        .content-wrapper {
            padding: max(1.5rem, env(safe-area-inset-top)) 1.5rem 2rem 1.5rem;
        }
    }
    
    /* ===== PREVENT TEXT SELECTION ON BUTTONS ===== */
    .module-card, .back-button, button {
        user-select: none;
        -webkit-user-select: none;
    }
    
    /* ===== IMPROVE SCROLLING ON iOS ===== */
    @supports (-webkit-touch-callout: none) {
        .main-content {
            -webkit-overflow-scrolling: touch;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="app-wrapper">
            <div class="bg-blur-1"></div>
            <div class="bg-blur-2"></div>

```
        <div id="mainContent" class="main-content"></div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    // ===== STATE =====
    let state = {
        completedModules: [],
        lastActivity: null,
        showIntro: true
    };

    // ===== 8 MINDFULNESS MODULES =====
    const modules = [
        { 
            id: 'introduction', 
            name: 'GETTING STARTED', 
            icon: 'üåü', 
            tagline: 'Begin your awareness journey', 
            description: 'Learn what mindful awareness is, how it helps, and how to use these modules.',
            learnUrl: 'mindfulness.introduction.html',
            duration: '5 min',
            required: true
        },
        { 
            id: 'notice', 
            name: 'NOTICE', 
            icon: 'üëÅÔ∏è', 
            tagline: 'See thoughts like passing clouds', 
            description: 'Become aware of sensations, thoughts, and emotions without getting pulled in.',
            learnUrl: 'mindfulness.notice.html',
            duration: '10 min',
            dependsOn: 'introduction'
        },
        { 
          
       { 
    id: 'label', 
    name: 'NAME',  // Changed from 'LABEL' to 'NAME'
    icon: 'üìù', 
    tagline: 'Name what you notice clearly', 
    description: 'Put simple words to your experience using facts, without adding judgment.',
    learnUrl: 'mindfulness.label.html',
    duration: '8 min',
    dependsOn: 'notice'
},
        { 
            id: 'accept', 
            name: 'ACCEPT', 
            icon: '‚öñÔ∏è', 
            tagline: 'Let go of good/bad labels', 
            description: 'Observe experiences without labeling them as right, wrong, good, or bad.',
            learnUrl: 'mindfulness.accept.html',
            duration: '15 min',
            dependsOn: 'engage'
        },
        { 
            id: 'focus', 
            name: 'FOCUS', 
            icon: 'üéØ', 
            tagline: 'One thing at a time', 
            description: 'Give your full attention to one task. Gently return when the mind wanders.',
            learnUrl: 'mindfulness.focus.html',
            duration: '10 min',
            dependsOn: 'accept'
        },
        { 
            id: 'actwisely', 
            name: 'ACT WISELY', 
            icon: '‚úÖ', 
            tagline: 'Choose what truly works', 
            description: 'Do what helps reach your goals, even if it doesn\'t feel fair or right.',
            learnUrl: 'mindfulness.actwisely.html',
            duration: '12 min',
            dependsOn: 'focus'
        },
        { 
            id: 'checkin', 
            name: 'CHECK-IN', 
            icon: 'üß†', 
            tagline: 'Know your state', 
            description: 'Pause and notice your current emotional, mental, and physical state.',
            learnUrl: 'mindfulness.checkin.html',
            duration: '8 min',
            dependsOn: 'actwisely'
        }
    ];

    // ===== NAVIGATION =====
    
    function startModule(moduleId) {
        const module = modules.find(m => m.id === moduleId);
        if (!module) return;
        
        // Send data to module
        localStorage.setItem('currentModule', JSON.stringify({
            moduleId: moduleId,
            moduleName: module.name,
            timestamp: new Date().toISOString(),
            userProgress: state.completedModules.includes(moduleId) ? 100 : 0,
            fromApp: 'mindfulness-course'
        }));
        
        // Navigate to module
        setTimeout(() => {
            window.location.href = module.learnUrl;
        }, 150); // Small delay for touch feedback
    }
    
    function checkModuleCompletion() {
        const completed = localStorage.getItem('moduleCompleted');
        if (completed) {
            try {
                const data = JSON.parse(completed);
                let moduleId = data.moduleId;
                
                // Map module IDs from onboarding to course menu
                const idMap = {
                    'introduction': 'introduction',
                    'observe': 'notice',
                    'describe': 'name', 
                    'participate': 'engage',
                    'nonjudgment': 'accept',
                    'onemindfully': 'focus',
                    'effectively': 'actwisely'
                };
                
                // If moduleId is in our map, use the mapped value
                if (idMap[moduleId]) {
                    moduleId = idMap[moduleId];
                }
                
                // Check if this is any module completion
                if (data.completed) {
                    console.log(`Module ${moduleId} completed!`);
                    
                    // Add to completed modules if not already there
                    if (!state.completedModules.includes(moduleId)) {
                        state.completedModules.push(moduleId);
                    }
                    
                    // Mark activity
                    state.lastActivity = new Date().toISOString();
                    
                    // Save state
                    saveState();
                    syncWithMainApp();
                    
                    // Show toast with growth-focused message
                    const module = modules.find(m => m.id === moduleId);
                    if (module) {
                        showToast(`${module.name} practiced! You can revisit anytime ‚ú®`);
                    }
                    
                    // Clear the completion flag so we don't keep checking it
                    localStorage.removeItem('moduleCompleted');
                    
                    // If there are journal prompts, save them
                    if (data.journalPrompts) {
                        localStorage.setItem('modulePrompts', JSON.stringify(data.journalPrompts));
                        showToast("Reflection prompts added to your journal üìù");
                    }
                    
                    // Re-render to update UI
                    setTimeout(() => {
                        render();
                    }, 500);
                }
            } catch (e) {
                console.error('Error checking module completion:', e);
            }
        }
    }
    
    function syncWithMainApp() {
        try {
            let mainState = {};
            const existing = localStorage.getItem('mphaven_state');
            if (existing) {
                mainState = JSON.parse(existing);
            }
            
            if (!mainState.mindfulnessProgress) {
                mainState.mindfulnessProgress = {};
            }
            
            modules.forEach(module => {
                mainState.mindfulnessProgress[module.id] = {
                    completed: state.completedModules.includes(module.id),
                    lastPracticed: state.lastActivity,
                    name: module.name,
                    tagline: module.tagline
                };
            });
            
            localStorage.setItem('mphaven_state', JSON.stringify(mainState));
            
        } catch (e) {
            console.error('Sync error:', e);
        }
    }
    
    function loadFromMainApp() {
        try {
            const mainState = localStorage.getItem('mphaven_state');
            if (mainState) {
                const data = JSON.parse(mainState);
                
                if (data.mindfulnessProgress) {
                    Object.keys(data.mindfulnessProgress).forEach(moduleId => {
                        if (data.mindfulnessProgress[moduleId].completed) {
                            if (!state.completedModules.includes(moduleId)) {
                                state.completedModules.push(moduleId);
                            }
                        }
                    });
                }
            }
        } catch (e) {
            console.log('No main app data found');
        }
    }

    // ===== UI FUNCTIONS =====
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function getModuleStatus(module) {
        // UPDATED: Check if module has been practiced (was "completed")
        // Modules are ALWAYS displayed, just with different status badges
        if (state.completedModules.includes(module.id)) {
            return { 
                type: 'practiced', 
                text: 'PRACTICE AGAIN', 
                cardClass: 'card-practiced' 
            };
        }
        
        // Introduction is always recommended if not practiced yet
        if (module.id === 'introduction') {
            return { type: 'recommended', text: 'START HERE', cardClass: 'card-recommended' };
        }
        
        // Check if dependencies are met
        if (!module.dependsOn) {
            return { type: 'recommended', text: 'RECOMMENDED', cardClass: 'card-recommended' };
        }
        
        if (state.completedModules.includes(module.dependsOn)) {
            return { type: 'recommended', text: 'NEXT UP', cardClass: 'card-recommended' };
        }
        
        return { type: 'available', text: 'AVAILABLE', cardClass: 'card-available' };
    }

    // ===== RENDER FUNCTION =====
    function render() {
        // Count practiced skills (excluding introduction)
        const practicedSkills = state.completedModules.filter(id => id !== 'introduction').length;
        const totalSkills = modules.filter(m => m.id !== 'introduction').length;
        
        const content = document.getElementById('mainContent');
        content.innerHTML = `
            <div class="content-wrapper fade-in">
                <!-- HEADER -->
                <div class="header">
                    <div>
                        <h1>Mindfulness Skills</h1>
                        <p>Build awareness step by step</p>
                    </div>
                </div>
                
                <!-- Info box for introduction guidance -->
                ${!state.completedModules.includes('introduction') ? `
                    <div class="info-box">
                        <p>Start with the introduction to learn how these skills work together</p>
                    </div>
                ` : ''}
                
                <!-- MODULES LIST - ALL MODULES ALWAYS VISIBLE -->
                <div style="margin-top: 0.25rem; flex: 1;">
                    ${modules.map(module => {
                        const status = getModuleStatus(module);
                        
                        // CRITICAL: No conditional rendering - all modules always shown
                        return `
                            <button onclick="startModule('${module.id}')" 
                                    class="module-card ${status.cardClass}"
                                    aria-label="Start ${module.name} module">
                                <div class="module-icon">${module.icon}</div>
                                <div class="module-title">${module.name}</div>
                                <div class="module-tagline">${module.tagline}</div>
                                <div class="module-description">${module.description}</div>
                                
                                <div class="module-footer">
                                    <div class="module-duration">${module.duration}</div>
                                    <div class="status-badge status-${status.type}">
                                        ${status.text}
                                    </div>
                                </div>
                            </button>
                        `;
                    }).join('')}
                </div>
                
                <!-- BACK BUTTON -->
                <div style="margin-top: auto;">
                    <button onclick="window.location.href='app.html'" class="back-button">
                        ‚Üê Back to Main App
                    </button>
                </div>
            </div>
        `;
    }

    // ===== STATE MANAGEMENT =====
    function saveState() {
        localStorage.setItem('mindfulness_state', JSON.stringify(state));
        syncWithMainApp();
    }

    function loadState() {
        try {
            const saved = localStorage.getItem('mindfulness_state');
            if (saved) {
                const data = JSON.parse(saved);
                state.completedModules = data.completedModules || [];
                state.lastActivity = data.lastActivity;
            }
        } catch (e) {
            console.log('Starting fresh');
        }
    }

    // ===== INITIALIZATION =====
    function init() {
        // Prevent zoom on double-tap
        document.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
        
        loadState();
        loadFromMainApp();
        checkModuleCompletion();
        render();
        
        // Scroll to top on load
        setTimeout(() => {
            const mainContent = document.querySelector('.main-content');
            if (mainContent) mainContent.scrollTop = 0;
        }, 100);
    }

    // Start the app
    init();
</script>
```

</body>
</html>
